<!DOCTYPE html>
<html lang="rs">
<head>
    <title>11. Napredna objektno-relaciona preslikavanja | Programiranje baza podataka</title>
    <meta charset="utf-8">

    <link rel="stylesheet" type="text/css" href="/resources/semantic/semantic.min.css">
    <script src="/resources/jquery/jquery-3.5.1.min.js"></script>
    <script src="/resources/semantic/semantic.min.js"></script>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <script src="https://semantic-ui.com/javascript/library/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
        $(document).ready(() => {
            $("table").addClass('ui celled table');
        });
    </script>
</head>

<body>
    <div class="ui sticky black big launch right attached fixed button" id="pageSticky">
        <i class="content icon"></i>
        <span class="text">Prikaži sadržaj</span>
    </div>

    <div class="ui sidebar vertical menu" id="sideMenu">
        <div class="item">
            <h3>Sadržaj</h3>
        </div>
        <a class="item" href="/vezbe/predgovor">Predgovor</a>
        <a class="item" href="/vezbe/poglavlja/1">1. Uvod u programiranje baza podataka</a>
        <a class="item" href="/vezbe/poglavlja/2">2. Osnovni koncepti programiranja C/SQL aplikacija</a>
        <a class="item" href="/vezbe/poglavlja/3">3. Programiranje korišćenjem kursora</a>
        <a class="item" href="/vezbe/poglavlja/4">4. Aplikacije sa dinamičkim SQL naredbama</a>
        <a class="item" href="/vezbe/poglavlja/5">5. Implementiranje transakcija</a>
        <a class="item" href="/vezbe/poglavlja/6">6. Aplikacije u višekorisničkom okruženju</a>
        <a class="item" href="/vezbe/poglavlja/7">7. Povezivanje aplikacija na više baza podataka</a>
        <a class="item" href="/vezbe/poglavlja/8">8. Osnovni koncepti programiranja Java/SQL aplikacija sa
            dinamičkim SQL naredbama (JDBC)</a>
        <a class="item" href="/vezbe/poglavlja/9">9. Napredne tehnike razvijanja Java/SQL aplikacija</a>
        <a class="item" href="/vezbe/poglavlja/10">10. Uvod u razvojno okruženje Hibernate</a>
        <a class="item" href="/vezbe/poglavlja/11">11. Napredna objektno-relaciona preslikavanja</a>
        <a class="item" href="/vezbe/poglavlja/12">12. Napredno kreiranje upita pomoću JPA Criteria API</a>
        <a class="item" href="/vezbe/poglavlja/13">13. Programiranje SQL rutina</a>
        <a class="item" href="/vezbe/poglavlja/14">14. Korisnički-definisane funkcije</a>
        <a class="item" href="/vezbe/poglavlja/15">15. Ugrađene procedure</a>
        <a class="item" href="/vezbe/poglavlja/16">16. Okidači</a>
    </div>

    <div class="ui justified container">
        <img class="ui centered small image" src="/resources/matf-srb.png">
        <header class="ui center aligned block header">
            <h1><a href="/">Programiranje baza podataka</a></h1>
        </header>

        <div class="ui divider"></div>

        <div id="pageContent">
            <h2>11. Napredna objektno-relaciona preslikavanja</h2>


<div class="ui warning message">
    <div class="header">
        Ova stranica je pod konstrukcijom!
    </div>
    Ako pronađete grešku ili propust, molimo Vas da nam skrenete pažnju otvaranjem primedbe na <a href="https://github.com/MATF-PBP/matf-pbp.github.io"><i class="github icon"></i>zvaničnom GitHub repozitorijumu</a>.
</div>


<p>U prethodnom poglavlju smo se upoznali sa osnovama objektno-relacionih preslikavanja. Ovo poglavlje će biti posvećeno naprednijim konceptima. Upoznaćemo se sa jezikom HQL, koja predstavlja pandan jeziku SQL, samo u radu sa Java klasama i objektima. Dodatno, obratićemo veliku pažnju problemu objektno-relacionih preslikavanja stranih ključeva i načinima za njihovu implementaciju.</p>

<h2 id="111-rad-sa-skupovima-slogova">11.1 Rad sa skupovima slogova</h2>

<p>Za rad sa potencijalno većim brojem slogova u tabeli, na raspolaganju su nam stoji <em>HQL</em> (<em>Hibernate Query Language</em>). While most ORM tools and object databases offer an object query language, Hibernate’s HQL stands out as complete and easy to use. HQL was inspired by SQL and is a major inspiration for the Java Persistence Query Language (JPQL).</p>

<h3 id="1111-menjanje">11.1.1 Menjanje</h3>

<p><code class="language-plaintext highlighter-rouge">UPDATE</code> alters the details of existing objects in the database. In-memory entities, managed
or not, will not be updated to reflect changes resulting from issuing <code class="language-plaintext highlighter-rouge">UPDATE</code> statements.
Here’s the syntax of the <code class="language-plaintext highlighter-rouge">UPDATE</code> statement:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="p">[</span><span class="n">VERSIONED</span><span class="p">]</span>
    <span class="p">[</span><span class="k">FROM</span><span class="p">]</span> <span class="n">path</span> <span class="p">[[</span><span class="k">AS</span><span class="p">]</span> <span class="k">alias</span><span class="p">]</span> <span class="p">[,</span> <span class="p">...]</span>
    <span class="k">SET</span> <span class="n">property</span> <span class="o">=</span> <span class="n">value</span> <span class="p">[,</span> <span class="p">...]</span>
    <span class="p">[</span><span class="k">WHERE</span> <span class="n">logicalExpression</span><span class="p">]</span>
</code></pre></div></div>

<p>The fully qualified name of the entity or entities is <code class="language-plaintext highlighter-rouge">path</code>. The <code class="language-plaintext highlighter-rouge">alias</code> names may be used
to abbreviate references to specific entities or their properties, and must be used when
property names in the query would otherwise be ambiguous. <code class="language-plaintext highlighter-rouge">VERSIONED</code> means that the
update will update timestamps, if any, that are part of the entity being updated. The
<code class="language-plaintext highlighter-rouge">property</code> names are the names of properties of entities listed in the <code class="language-plaintext highlighter-rouge">FROM</code> path.</p>

<p>An example of the update in action might look like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
        <span class="s">"UPDATE Person SET creditscore = :score WHERE firstname = :name"</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setInteger</span><span class="o">(</span><span class="s">"score"</span><span class="o">,</span> <span class="mi">612</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="s">"John Q. Public"</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">modifications</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
</code></pre></div></div>

<h3 id="1112-brisanje">11.1.2 Brisanje</h3>

<p><code class="language-plaintext highlighter-rouge">DELETE</code> removes the details of existing objects from the database. In-memory entities will
not be updated to reflect changes resulting from <code class="language-plaintext highlighter-rouge">DELETE</code> statements. This also means
that Hibernate’s cascade rules will not be followed for deletions carried out using HQL.
However, if you have specified cascading deletes at the database level (either directly or
through Hibernate, using the <code class="language-plaintext highlighter-rouge">@OnDelete</code> annotation), the database will still remove the
child rows. This approach to deletion is commonly referred to as ”bulk deletion”, since it
is the most efficient way to remove large numbers of entities from the database. Here’s
the syntax of the <code class="language-plaintext highlighter-rouge">DELETE</code> statement:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELETE</span>
    <span class="p">[</span><span class="k">FROM</span><span class="p">]</span> <span class="n">path</span> <span class="p">[[</span><span class="k">AS</span><span class="p">]</span> <span class="k">alias</span><span class="p">]</span>
    <span class="p">[</span><span class="k">WHERE</span> <span class="n">logicalExpression</span><span class="p">]</span>
</code></pre></div></div>

<p>The fully qualified name of the entity or entities is <code class="language-plaintext highlighter-rouge">path</code>. The <code class="language-plaintext highlighter-rouge">alias</code> names may be used
to abbreviate references to specific entities or their properties, and must be used when
property names in the query would otherwise be ambiguous.</p>

<p>In practice, deletes might look like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
        <span class="s">"DELETE FROM Person WHERE accountstatus = :status"</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">"status"</span><span class="o">,</span> <span class="s">"purged"</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">rowsDeleted</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
</code></pre></div></div>

<h3 id="1113-unošenje">11.1.3 Unošenje</h3>

<p>A HQL <code class="language-plaintext highlighter-rouge">INSERT</code> cannot be used to directly insert arbitrary entities — it can only be used to
insert entities constructed from information obtained from <code class="language-plaintext highlighter-rouge">SELECT</code> queries (unlike ordinary
SQL, in which an <code class="language-plaintext highlighter-rouge">INSERT</code> command can be used to insert arbitrary data into a table, as
well as insert values selected from other tables). Here’s the syntax of the <code class="language-plaintext highlighter-rouge">INSERT</code> statement:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">INSERT</span>
    <span class="no">INTO</span> <span class="nf">path</span> <span class="o">(</span> <span class="n">property</span> <span class="o">[,</span> <span class="o">...])</span>
    <span class="n">select</span>
</code></pre></div></div>

<p>The name of an entity is <code class="language-plaintext highlighter-rouge">path</code>. The <code class="language-plaintext highlighter-rouge">property</code> names are the names of properties of entities
listed in the <code class="language-plaintext highlighter-rouge">FROM</code> path of the incorporated <code class="language-plaintext highlighter-rouge">SELECT</code> query. The select query is a HQL
<code class="language-plaintext highlighter-rouge">SELECT</code> query (as described in the next section). As this HQL statement can only use data
provided by a HQL select, its application can be limited. An example of copying users to
a purged table before actually purging them might look like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span>
        <span class="s">"INSERT INTO PURGED_USERS(id, name, status) "</span> <span class="o">+</span>
        <span class="s">"SELECT id, name, status FROM User WHERE status = :status"</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="s">"status"</span><span class="o">,</span> <span class="s">"purged"</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">rowsCopied</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
</code></pre></div></div>

<h3 id="1114-čitanje">11.1.4 Čitanje</h3>

<p>A HQL <code class="language-plaintext highlighter-rouge">SELECT</code> is used to query the database for classes and their properties. As noted
previously, this is very much a summary of the full expressive power of HQL <code class="language-plaintext highlighter-rouge">SELECT</code> queries;
however, for more complex joins and the like, you may find that using the Criteria API is
more appropriate. Here’s the syntax of the <code class="language-plaintext highlighter-rouge">SELECT</code> statement:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="k">SELECT</span> <span class="p">[</span><span class="k">DISTINCT</span><span class="p">]</span> <span class="n">property</span> <span class="p">[,</span> <span class="p">...]]</span>
    <span class="k">FROM</span> <span class="n">path</span> <span class="p">[[</span><span class="k">AS</span><span class="p">]</span> <span class="k">alias</span><span class="p">]</span> <span class="p">[,</span> <span class="p">...]</span> <span class="p">[</span><span class="k">FETCH</span> <span class="k">ALL</span> <span class="n">PROPERTIES</span><span class="p">]</span>
    <span class="k">WHERE</span> <span class="n">logicalExpression</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">property</span> <span class="p">[,</span> <span class="p">...]</span>
    <span class="k">HAVING</span> <span class="n">logicalExpression</span>
    <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">property</span> <span class="p">[</span><span class="k">ASC</span> <span class="o">|</span> <span class="k">DESC</span><span class="p">]</span> <span class="p">[,</span> <span class="p">...]</span>
</code></pre></div></div>

<p>The fully qualified name of the entity or entities is <code class="language-plaintext highlighter-rouge">path</code>. The <code class="language-plaintext highlighter-rouge">alias</code> names may be used
to abbreviate references to specific entities or their properties, and must be used when
property names in the query would otherwise be ambiguous. The property names are the
names of properties of entities listed in the <code class="language-plaintext highlighter-rouge">FROM</code> path.</p>

<p>If <code class="language-plaintext highlighter-rouge">FETCH ALL PROPERTIES</code> is used, then lazy loading semantics will be ignored, and all the
immediate properties of the retrieved object(s) will be actively loaded (this does not apply
recursively).</p>

<p>When the properties listed consist only of the names of aliases in the <code class="language-plaintext highlighter-rouge">FROM</code> clause, the
<code class="language-plaintext highlighter-rouge">SELECT</code> clause can be omitted in HQL.</p>

<h4 id="the-from-clause-and-aliases">The FROM Clause and Aliases</h4>

<p>We have already discussed the basics of the from clause in HQL. The most important
feature to note is the <em>alias</em>. Hibernate allows you to assign aliases to the classes in your
query with the as clause. Use the aliases to refer back to the class inside the query. For
instance, instead of a simple HQL query</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span> <span class="n">Supplier</span>
</code></pre></div></div>

<p>the example could be the following:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span> <span class="n">Product</span> <span class="k">AS</span> <span class="n">p</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">AS</code> keyword is optional — you can also specify the alias directly after the class name,
as follows:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span> <span class="n">Product</span> <span class="n">p</span>
</code></pre></div></div>

<p>If you need to fully qualify a class name in HQL, just specify the package and class name.
Hibernate will take care of most of this behind the scenes, so you really need this only
if you have classes with duplicate names in your application. If you have to do this in
Hibernate, use syntax such as the following:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span> <span class="n">businessapp</span><span class="p">.</span><span class="n">model</span><span class="p">.</span><span class="n">Product</span>
</code></pre></div></div>

<h4 id="the-select-clause-and-projection">The SELECT Clause and Projection</h4>

<p>The select clause provides more control over the result set than the from clause. If you
want to obtain the properties of objects in the result set, use the select clause. For instance,
we could run a projection query on the products in the database that only returned the
names, instead of loading the full object into memory, as follows:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">product</span><span class="p">.</span><span class="n">name</span> <span class="k">FROM</span> <span class="n">Product</span> <span class="n">product</span>
</code></pre></div></div>

<p>The result set for this query will contain a <code class="language-plaintext highlighter-rouge">List</code> of Java <code class="language-plaintext highlighter-rouge">String</code> objects. Additionally, we
can retrieve the prices and the names for each product in the database, like so:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">product</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">product</span><span class="p">.</span><span class="n">price</span> <span class="k">FROM</span> <span class="n">Product</span> <span class="n">product</span>
</code></pre></div></div>

<p>This result set contains a <code class="language-plaintext highlighter-rouge">List</code> of <code class="language-plaintext highlighter-rouge">Object</code> arrays (therefore, <code class="language-plaintext highlighter-rouge">List&lt;Object[]&gt;</code>) — each array
represents one tuple of properties (in this case, a pair that represents name and price).</p>

<p>If you’re only interested in a few properties, this approach can allow you to reduce network
traffic to the database server and save memory on the application’s machine.</p>

<h4 id="using-named-parameters">Using Named Parameters</h4>

<p>Hibernate supports named parameters in its HQL queries. The simplest example of named
parameters uses regular SQL types for the parameters:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">hql</span> <span class="o">=</span> <span class="s">"FROM Product WHERE price &gt; :price"</span><span class="o">;</span>
<span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">hql</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"price"</span><span class="o">,</span> <span class="mf">25.0</span><span class="o">);</span>
<span class="nc">List</span> <span class="n">results</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
</code></pre></div></div>

<p>Metod <code class="language-plaintext highlighter-rouge">setParameter()</code> uzima naziv parametarske oznake kao prvi argument i vrednost
kojom ona treba biti zamenjena kao drugi argument. Hibernate će automatski pokušati da dedukuje
tip na osnovu pozicije imenovane parametarske oznake u upitu. Alternativno, postoji preopterećenje
ovog metoda koje prihvata dodatni argument kojim se navodi tip te parametarske oznake.
Naredni kod navodimo tek radi kompletnosti, bez ulaženja u detalje. Jedino na šta ćemo
skrenuti pažnju jeste metod <code class="language-plaintext highlighter-rouge">getSingleResult</code> klase <code class="language-plaintext highlighter-rouge">org.hibernate.query.Query</code>
koji dohvata tačno jedan rezultat iz tabele koji zadovoljava HQL upit.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Dohvatamo model koji sadrzi meta-informacije.</span>
<span class="nc">MetamodelImplementor</span> <span class="n">metamodelImplementor</span> <span class="o">=</span> 
        <span class="o">(</span><span class="nc">MetamodelImplementor</span><span class="o">)</span> <span class="nc">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">getMetamodel</span><span class="o">();</span>

<span class="c1">// Izracunavamo tip atributa `caption` u klasi `Photo`.</span>
<span class="nc">Type</span> <span class="n">captionType</span> <span class="o">=</span> <span class="n">metamodelImplementor</span>
        <span class="o">.</span><span class="na">entityPersister</span><span class="o">(</span> <span class="nc">Photo</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">)</span>
        <span class="o">.</span><span class="na">getPropertyType</span><span class="o">(</span> <span class="s">"caption"</span> <span class="o">);</span>

<span class="c1">// HQL upit kojim dohvatamo sve slike koje imaju odgovarajuci naziv.</span>
<span class="nc">String</span> <span class="n">hql</span> <span class="o">=</span> 
        <span class="s">"select p "</span> <span class="o">+</span>
        <span class="s">"from Photo p "</span> <span class="o">+</span>
        <span class="s">"where upper(caption) = upper(:caption) "</span><span class="o">;</span>
<span class="c1">// Koristimo varijantu metoda `setParameter()` sa tri argumenta</span>
<span class="c1">// kako bismo nagovestili Hibernate-u koji je tip parametarske oznake sa nazivom "caption".</span>
<span class="nc">Photo</span> <span class="n">photo</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Photo</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">hql</span><span class="o">,</span> <span class="nc">Photo</span><span class="o">.</span><span class="na">class</span> <span class="o">)</span>
        <span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"caption"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Caption</span><span class="o">(</span><span class="s">"Moja prva fotografija u novoj godini"</span><span class="o">),</span> <span class="n">captionType</span><span class="o">)</span>
        <span class="o">.</span><span class="na">getSingleResult</span><span class="o">();</span>
</code></pre></div></div>

<p>Normally, you do not know the values that are to be substituted for the named parameters;
if you did, you would probably encode them directly into the query string. When the value
to be provided will be known only at run time, you can use some of HQL’s object-oriented
features to provide objects as values for named parameters. The Query interface has a
<code class="language-plaintext highlighter-rouge">setEntity()</code> method that takes the name of a parameter and an object.</p>

<p>Using this functionality, we could retrieve all the products that have a supplier whose
object we already have:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">supplierHQL</span> <span class="o">=</span> <span class="s">"FROM Supplier WHERE name = 'MegaInc'"</span><span class="o">;</span>
<span class="nc">Query</span> <span class="n">supplierQuery</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">supplierHQL</span><span class="o">);</span>
<span class="nc">Supplier</span> <span class="n">supplier</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Supplier</span><span class="o">)</span> <span class="n">supplierQuery</span><span class="o">.</span><span class="na">list</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

<span class="nc">String</span> <span class="n">hql</span> <span class="o">=</span> <span class="s">"FROM Product AS product WHERE product.supplier = :supplier"</span><span class="o">;</span>
<span class="nc">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">hql</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="s">"supplier"</span><span class="o">,</span> <span class="n">supplier</span><span class="o">);</span>
<span class="nc">List</span> <span class="n">results</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
</code></pre></div></div>

<h4 id="associations">Associations</h4>

<p>Associations allow you to use more than one class in HQL query, just as SQL allows you
to use joins between tables in a relational database. You add an association to a HQL
query with the <code class="language-plaintext highlighter-rouge">JOIN</code> clause.</p>

<p>Hibernate supports five different types of joins: <code class="language-plaintext highlighter-rouge">INNER JOIN</code>, <code class="language-plaintext highlighter-rouge">CROSS JOIN</code>, <code class="language-plaintext highlighter-rouge">LEFT OUTER JOIN</code>,
<code class="language-plaintext highlighter-rouge">RIGHT OUTER JOIN</code>, and <code class="language-plaintext highlighter-rouge">FULL OUTER JOIN</code>. If you use <code class="language-plaintext highlighter-rouge">CROSS JOIN</code>, just specify both classes
in the <code class="language-plaintext highlighter-rouge">FROM</code> clause (<code class="language-plaintext highlighter-rouge">FROM Product p, Supplier s</code>). For the other joins, use a <code class="language-plaintext highlighter-rouge">JOIN</code> clause
after the <code class="language-plaintext highlighter-rouge">FROM</code> clause. Specify the type of join, the object property to join on, and an alias
for the other class.</p>

<p>For example, you can use <code class="language-plaintext highlighter-rouge">INNER JOIN</code> to obtain the supplier for each product, and then retrieve the
supplier name, product name, and product price, as so:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">s</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">price</span> <span class="k">FROM</span> <span class="n">Product</span> <span class="n">p</span> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">p</span><span class="p">.</span><span class="n">supplier</span> <span class="k">AS</span> <span class="n">s</span>
</code></pre></div></div>

<p>You can retrieve the objects using similar syntax:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span> <span class="n">Product</span> <span class="n">p</span> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">p</span><span class="p">.</span><span class="n">supplier</span> <span class="k">AS</span> <span class="n">s</span>
</code></pre></div></div>

<p>Notice that Hibernate does not return <code class="language-plaintext highlighter-rouge">Object</code> objects in the result set; instead, Hibernate
returns <code class="language-plaintext highlighter-rouge">Object</code> arrays in the results. This join results in a projection, thus the use of
the <code class="language-plaintext highlighter-rouge">Object</code> arrays. You will have to access the contents of the <code class="language-plaintext highlighter-rouge">Object</code> arrays to get the
<code class="language-plaintext highlighter-rouge">Supplier</code> and the <code class="language-plaintext highlighter-rouge">Product</code> objects.</p>

<div class="ui stacked segment">
  <p><strong>Zadatak 11.1</strong>: Napisati Java aplikaciju koja korišćenjem biblioteke Hibernate ispisuje podatke o svim ispitnim rokovima.</p>
</div>

<p>Rešenje: Zahtev je implementiran u metodu <code class="language-plaintext highlighter-rouge">readispitniRokovi()</code> klase <code class="language-plaintext highlighter-rouge">Main.java</code>:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_11/src/zadatak_11_1/Main.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_11_1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Session</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.Transaction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.query.Query</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Pocetak rada...\n"</span><span class="o">);</span>
        
        <span class="n">readIspitniRokovi</span><span class="o">();</span>
        
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Zavrsetak rada.\n"</span><span class="o">);</span>
        <span class="nc">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">readIspitniRokovi</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="nc">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">openSession</span><span class="o">();</span>
        <span class="nc">Transaction</span> <span class="no">TR</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        
        <span class="k">try</span> <span class="o">{</span>
            <span class="no">TR</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
            
            <span class="c1">// HQL upit za izdvajanje svih entiteta tipa IspitniRok</span>
            <span class="nc">String</span> <span class="n">hql</span> <span class="o">=</span> <span class="s">"FROM IspitniRok"</span><span class="o">;</span>
            <span class="c1">// Kreiranje objekta koji sadrzi informacije o HQL upitu.</span>
            <span class="c1">// Obratiti paznju da se klasa Query nalazi u paketu org.hibernate.query!!!</span>
            <span class="c1">// Takodje, pored samog HQL upita, </span>
            <span class="c1">// metodu createQuery prosledjujemo klasu koja predstavlja entitet rezultata.</span>
            <span class="c1">// Drugim recima, kazemo Hibernate-u da zelimo da dohvatimo listu ispitnih rokova.</span>
            <span class="nc">Query</span><span class="o">&lt;</span><span class="nc">IspitniRok</span><span class="o">&gt;</span> <span class="n">upit</span> <span class="o">=</span> 
                    <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">hql</span><span class="o">,</span> <span class="nc">IspitniRok</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="c1">// Pozivom metoda list() dohvatamo zeljeni rezultat</span>
            <span class="nc">List</span><span class="o">&lt;</span><span class="nc">IspitniRok</span><span class="o">&gt;</span> <span class="n">ispitniRokovi</span> <span class="o">=</span> <span class="n">upit</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
            <span class="c1">// Iteriranje kroz listu</span>
            <span class="k">for</span><span class="o">(</span><span class="nc">IspitniRok</span> <span class="n">ir</span> <span class="o">:</span> <span class="n">ispitniRokovi</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ir</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="no">TR</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Postoji problem sa ispisivanjem ispitnih rokova! Ponistavanje transakcije!"</span><span class="o">);</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            
            <span class="k">if</span> <span class="o">(</span><span class="no">TR</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="no">TR</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<h2 id="112-asocijativne-veze-i-strani-ključevi">11.2 Asocijativne veze i strani ključevi</h2>

<p>Jedan od najznačajnijih elemenata relacionih baza podataka jesu tzv. <em>asocijativne veze</em> koje se ostvaruju između tabela. Na šta mislimo pod tim pojmom? Neka su nam date dve tabele <code class="language-plaintext highlighter-rouge">STUDENT</code> i <code class="language-plaintext highlighter-rouge">KNJIGA</code> čije su sheme date u nastavku:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">STUDENT</span> <span class="p">(</span>
    <span class="n">ID_STUDENTA</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">IME_PREZIME</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">NAZIV_SMERA</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID_STUDENTA</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">KNJIGA</span> <span class="p">(</span>
    <span class="n">ID_KNJIGE</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">NAZIV_KNJIGE</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">AUTOR</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID_KNJIGE</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Ove dve tabele trenutno nisu povezane, odnosno, slogovi iz tabele <code class="language-plaintext highlighter-rouge">STUDENT</code> i slogovi iz tabele <code class="language-plaintext highlighter-rouge">KNJIGA</code> “žive” potpuno odvojeno i bilo kakva izmena jedne tabele nikako ne utiče na drugu tabelu. Međutim, šta ukoliko je potrebno da čuvamo informaciju o tome koji student je pozajmio koju knjigu iz biblioteke? Implementiranje ovog zahteva će kreirati asocijativnu vezu između ovih tabela jer sada postoji zavisnost među podacima iz ovih tabela.</p>

<p>U zavisnosti od toga koja je semantika veze koja se ostvaruje podacima, razlikujemo nekoliko tipova veza. Da bismo odabrali ispravan tip veze, potrebno je da sebi postavimo naredna pitanja:</p>

<ul>
  <li><em>P1</em>: Može li jedna knjiga pripadati više studenata?</li>
  <li><em>P2</em>: Može li student imati više od jedne knjige?</li>
</ul>

<p>Odgovori na ova pitanja, koja su postavljena u poslovnom domenu, direktno utiču na tip asocijativne veze koja se formira. Tipovi veza, zajedno sa odgovorima, dati su u narednoj tabeli:</p>

<table>
  <thead>
    <tr>
      <th>Odgovor na <em>P1</em></th>
      <th>Odgovor na <em>P2</em></th>
      <th>Veza između <code class="language-plaintext highlighter-rouge">STUDENT</code> i <code class="language-plaintext highlighter-rouge">KNJIGA</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Ne</td>
      <td>Ne</td>
      <td>Jedan-ka-jedan</td>
    </tr>
    <tr>
      <td>Da</td>
      <td>Ne</td>
      <td>Više-ka-jedan</td>
    </tr>
    <tr>
      <td>Ne</td>
      <td>Da</td>
      <td>Jedan-ka-više</td>
    </tr>
    <tr>
      <td>Da</td>
      <td>Da</td>
      <td>Više-ka-više</td>
    </tr>
  </tbody>
</table>

<h3 id="1121-veza-jedan-ka-jedan">11.2.1 Veza jedan-ka-jedan</h3>

<p>Veza jedan-ka-jedan se može ostvariti na nekoliko načina. U najjednostavnijoj varijanti, svojstva obe klase se čuvaju u istoj tabeli:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">STUDENTKNJIGA</span> <span class="p">(</span>
    <span class="n">SKID</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">IME_PREZIME</span> <span class="p">...,</span>
    <span class="n">NAZIV_SMERA</span> <span class="p">...,</span>
    <span class="n">NAZIV_KNJIGE</span> <span class="p">...,</span>
    <span class="n">AUTOR</span> <span class="p">...,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">SKID</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>U Java domenu:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nc">Class</span> <span class="nc">StudentKnjiga</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">skid</span><span class="o">;</span>

    <span class="c1">// Ostala polja i get/set metodi</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Alternativno, trajni objekti se mogu čuvati u različitim tabelama, od kojih svaka ima svoj primarni ključ, ali za svakog studenta i svaku knjigu mora da važi naredno pravilo: student koji je vlasnik neke knjige i ta knjiga moraju imati isti primarni ključ.</p>

<p>Moguće je održavati strani ključ od jednog entiteta ka drugom, ali ne bismo smeli imali dvosmerni strani ključ u ovakvom odnosu jer bismo kreirali kružnu zavisnost. Naravno, možemo da ne kreiramo strani ključ i da ostavimo Hibernate-u da se stara o tome. U tom slučaju bi tabele izgledale:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">STUDENT</span> <span class="p">(</span>
    <span class="n">ID_STUDENTA</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">IME_PREZIME</span> <span class="p">...,</span>
    <span class="n">NAZIV_SMERA</span> <span class="p">...,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID_STUDENTA</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">KNJIGA</span> <span class="p">(</span>
    <span class="n">ID_KNJIGE</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">NAZIV_KNJIGE</span> <span class="p">...,</span>
    <span class="n">AUTOR</span> <span class="p">...,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID_KNJIGE</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Dok bi klase izgledale:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">class</span> <span class="nc">Student</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id_studenta</span><span class="o">;</span>
    
    <span class="c1">// ...</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">class</span> <span class="nc">Knjiga</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id_knjige</span><span class="o">;</span>

    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Poslednja opcija je da se održava odnos stranim ključem između dve tabele, pri čemu
se postavlja opcija unique nad kolonom koja predstavlja strani ključ. Ovaj pristup ima
prednost u tome što jednostavnim uklanjanjem opcije unique, od veze jedan-ka-jedan može
se ostvariti veza više-ka-jedan. U nastavku dajemo kako bi izgledale tabele u ovom
pristupu:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">STUDENT</span> <span class="p">(</span>
    <span class="n">ID_STUDENTA</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">IME_PREZIME</span> <span class="p">...,</span>
    <span class="n">NAZIV_SMERA</span> <span class="p">...,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID_STUDENTA</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">KNJIGA</span> <span class="p">(</span>
    <span class="n">ID_KNJIGE</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">NAZIV_KNJIGE</span> <span class="p">...,</span>
    <span class="n">AUTOR</span> <span class="p">...,</span>
    <span class="n">ID_STUDENTA</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID_KNJIGE</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID_STUDENTA</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">STUDENT</span><span class="p">,</span>
    <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">ID_STUDENTA</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Dok bi klase izgledale:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">class</span> <span class="nc">Student</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id_studenta</span><span class="o">;</span>

    <span class="nd">@OneToOne</span><span class="o">(</span><span class="n">mappedBy</span><span class="o">=</span><span class="s">"student"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Knjiga</span> <span class="n">knjiga</span><span class="o">;</span>
    
    <span class="c1">// Get/set metodi</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">class</span> <span class="nc">Knjiga</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id_knjige</span><span class="o">;</span>

    <span class="c1">// Ostala polja</span>

    <span class="nd">@OneToOne</span>
    <span class="kd">private</span> <span class="nc">Student</span> <span class="n">student</span><span class="o">;</span>

    <span class="c1">// Get/set metodi</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Ono što prvo primećujemo u kodu jeste da smo uveli novu anotaciju <code class="language-plaintext highlighter-rouge">@OneToOne</code>. Ova anotacija se koristi ukoliko jedna klasa sadrži referencu na objekat druge klase (na primer, <code class="language-plaintext highlighter-rouge">Knjiga</code> sadrži polje <code class="language-plaintext highlighter-rouge">student</code> koje čuva referencu na klasu <code class="language-plaintext highlighter-rouge">Student</code>) i ukoliko želimo da kažemo Hibernate-u da je veza koja se ostvaruje jedan-ka-jedan.</p>

<p>Da klasa <code class="language-plaintext highlighter-rouge">Student</code> ne čuva referencu ka klasi <code class="language-plaintext highlighter-rouge">Knjiga</code> (kroz polje <code class="language-plaintext highlighter-rouge">knjiga</code>), time bi ovaj odnos bio rešen. Međutim, ukoliko nam je potrebno da obe klase čuvaju referencu jedna ka drugoj, onda dobijamo situaciju kao u prethodnom Java kodu. Ovakav pristup dovodi do toga da je veza koja se ostvaruje <em>bidirekciona</em>, odnosno, za datog studenta možemo dobiti referencu na knjigu čiji je on vlasnik, ali takođe, za datu knjigu, možemo dobiti referencu na studenta koji je njen vlasnik. U tom slučaju, potrebno je da obe reference (polja <code class="language-plaintext highlighter-rouge">knjiga</code> i <code class="language-plaintext highlighter-rouge">student</code>) u obe klase (<code class="language-plaintext highlighter-rouge">Student</code> i <code class="language-plaintext highlighter-rouge">Knjiga</code>, redom) budu dekorisana anotacijom <code class="language-plaintext highlighter-rouge">@OneToOne</code>.</p>

<p>Međutim, ovim i dalje nije rešen problem jer kako Hibernate da zna da li se ova bidirekciona veza održava u tabeli <code class="language-plaintext highlighter-rouge">STUDENT</code> ili u tabeli <code class="language-plaintext highlighter-rouge">KNJIGA</code>? I drugi tipovi veze mogu dovesti do ovakve situacije i rešenje se sastoji u postavljanju opcije <code class="language-plaintext highlighter-rouge">mappedBy</code> u odgovarajućoj anotaciji (u ovom primeru <code class="language-plaintext highlighter-rouge">@OneToOne</code>) kojom se navodi koje polje u <strong>drugoj klasi</strong> ostvaruje vezu stranog ključa. U ovom slučaju, želimo da postoji strani ključ nad kolonom <code class="language-plaintext highlighter-rouge">ID_STUDENTA</code> u tabeli <code class="language-plaintext highlighter-rouge">KNJIGA</code>, pa zato <strong>u klasi <code class="language-plaintext highlighter-rouge">Student</code> navodimo da je
veza ostvarena kroz polje <code class="language-plaintext highlighter-rouge">student</code> u klasi <code class="language-plaintext highlighter-rouge">Knjiga</code></strong>. Vrlo je važno obratiti pažnju na to gde se ova opcija postavlja kako bismo ispravno implementirali ovakvu zavisnost!</p>

<h3 id="1122-veza-jedan-ka-viševiše-ka-jedan">11.2.2 Veza jedan-ka-više/više-ka-jedan</h3>

<p>Ova dva tipa veze u suštini predstavljaju jedan tip veze, zato što, ako je iz ugla tabele <code class="language-plaintext highlighter-rouge">A</code> ostvarena veza jedan-ka-više ka tabeli <code class="language-plaintext highlighter-rouge">B</code>, onda je posledično iz ugla tabele <code class="language-plaintext highlighter-rouge">B</code> ostvarena veza više-ka-jedan ka tabeli <code class="language-plaintext highlighter-rouge">A</code>. Važi i obratno. Veza jedan-ka-više (ili iz perspektive druge klase, više-ka-jedan) može biti jednostavno reprezentovana stranim ključem ka primarnom ključu tabele koja se nalazi na “jedan” kraju ove veze u tabeli koja se nalazi na “više” kraju ove veze, bez dodatnih ograničenja.</p>

<p>Pretpostavimo da jedan student može imati više knjiga i da jedna knjiga može pripadati tačno jednom studentu. U tom slučaju, ostvaruje se veza jedan-ka-više od tabele <code class="language-plaintext highlighter-rouge">STUDENT</code> ka tabeli <code class="language-plaintext highlighter-rouge">KNJIGA</code> (odnosno, veza više-ka-jedan od tabele <code class="language-plaintext highlighter-rouge">KNJIGA</code> ka tabeli <code class="language-plaintext highlighter-rouge">STUDENT</code>). Shema tabela bi izgledala:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">STUDENT</span> <span class="p">(</span>
    <span class="n">ID_STUDENTA</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">IME_PREZIME</span> <span class="p">...,</span>
    <span class="n">NAZIV_SMERA</span> <span class="p">...,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID_STUDENTA</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">KNJIGA</span> <span class="p">(</span>
    <span class="n">ID_KNJIGE</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">NAZIV_KNJIGE</span> <span class="p">...,</span>
    <span class="n">AUTOR</span> <span class="p">...,</span>
    <span class="n">ID_STUDENTA</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID_KNJIGE</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID_STUDENTA</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">STUDENT</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Implementacija klasa u Java domenu izgleda:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">class</span> <span class="nc">Student</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id_studenta</span><span class="o">;</span>

    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span><span class="o">=</span><span class="s">"student"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Knjiga</span><span class="o">&gt;</span> <span class="n">knjige</span><span class="o">;</span>
    
    <span class="c1">// Get/set metodi</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">class</span> <span class="nc">Knjiga</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id_knjige</span><span class="o">;</span>
    
    <span class="c1">// Ostala polja</span>
    
    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"id_studenta"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Student</span> <span class="n">student</span><span class="o">;</span>
    
    <span class="c1">// Get/set metodi</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Ono što bi trebalo da primetimo iz prethodnog koda je sledeće:</p>

<ol>
  <li>Koristimo anotacije <code class="language-plaintext highlighter-rouge">@OneToMany</code> i <code class="language-plaintext highlighter-rouge">@ManyToOne</code> da definišemo odgovarajući tip veze između ovih klasa. U klasi koja predstavlja “jedan” stranu veze (<code class="language-plaintext highlighter-rouge">Student</code>) koristimo <code class="language-plaintext highlighter-rouge">@OneToMany</code>, a u klasi koja predstavlja “više” stranu te iste veze (<code class="language-plaintext highlighter-rouge">Knjiga</code>) koristimo <code class="language-plaintext highlighter-rouge">@ManyToOne</code>.</li>
  <li>U klasi <code class="language-plaintext highlighter-rouge">Student</code> više nema smisla čuvati referencu na jednu knjigu, pošto jedan student može da poseduje više knjiga. Zbog toga, potrebno je da čuvamo kolekciju referenci na knjige. Možemo koristiti razne vrste kolekcija, kao što su <code class="language-plaintext highlighter-rouge">java.util.List&lt;T&gt;</code>, <code class="language-plaintext highlighter-rouge">java.util.Set&lt;T&gt;</code>, <code class="language-plaintext highlighter-rouge">java.util.Map&lt;K, V&gt;</code>, itd.</li>
  <li>Možemo koristiti anotaciju <code class="language-plaintext highlighter-rouge">@JoinColumn</code> da specifikujemo naziv kolone koja učestvuje u stranom ključu koji se kreira u ovoj vezi. Ovo je posebno korisno ukoliko se kolone koje učestvuju u stranom ključu ne zovu isto.</li>
</ol>

<p>Alternativno, veza jedan-ka-više/više-ka-jedan može se održavati postojanjem treće tabele koja se naziva <em>spojna tabela</em> (engl. <em>link table</em>). U našem primeru, ovakva tabela bi održavala strane ključeve ka tabelama <code class="language-plaintext highlighter-rouge">STUDENT</code> i <code class="language-plaintext highlighter-rouge">KNJIGA</code>, a te kolone bi učestvovale u primarnom ključu spojne tabele. Dodatno, mora biti postavljeno ograničenje jedinstvenosti nad jednom stranom odnosa — inače, spojna tabela može predstavljati sve moguće kombinacije, čime bi se ostvarila veza više-ka-više. Dajmo primer sheme spojne tabele:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">STUDENTKNJIGALINK</span> <span class="p">(</span>
    <span class="n">ID_STUDENTA</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">ID_KNJIGE</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID_STUDENTA</span><span class="p">,</span> <span class="n">ID_KNJIGE</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID_STUDENTA</span><span class="p">)</span>
    <span class="k">REFERENCES</span> <span class="n">STUDENT</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID_KNJIGE</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">KNJIGA</span><span class="p">,</span>
    <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">ID_KNJIGE</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Korišćenje spojne tabele se ostvaruje korišćenjem anotacije <code class="language-plaintext highlighter-rouge">@JoinTable</code>, o kojoj će biti reči u nastavku.</p>

<h3 id="1123-veza-više-ka-više">11.2.3 Veza više-ka-više</h3>

<p>Kao što smo napomenuli na kraju prethodne podsekcije, ako se ograničenje jedinstvenosti ne primeni na “jedan” kraju bidirekcione asocijativne veze prilikom korišćenja spojne tabele, ta veza postaje više-ka-više veza. Sve moguće varijante parova <code class="language-plaintext highlighter-rouge">(ID_STUDENTA, ID_KNJIGE)</code> mogu biti reprezentovane, ali nije moguće da jedan student ima više puta istu knjigu, s obzirom da bi u takvoj situaciji došlo do dupliciranja složenog primarnog ključa te spojne tabele.</p>

<p>Ukoliko umesto tog pristupa dodelimo spojnoj tabeli svoj primarni ključ, koji ne sadrži kolone koje ulaze kao deo stranih ključeva ka drugim tabelama, onda time možemo reprezentovati punu više-ka-više vezu, naravno, ukoliko to odgovara domenskom problemu. U tom slučaju, shema spojne tabele bi mogla izgledati kao u narednom kodu:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">STUDENTKNJIGALINK</span> <span class="p">(</span>
    <span class="n">SUROGAT_ID</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">ID_STUDENTA</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">ID_KNJIGE</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">SUROGAT_ID</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID_STUDENTA</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">STUDENT</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID_KNJIGE</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">KNJIGA</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Bez obzira na pristup u SQL domenu, u Java domenu se koristi anotacija <code class="language-plaintext highlighter-rouge">@ManyToMany</code> i ona se navodi u obe klase. Kao i do sada, ukoliko je veza bidirekciona, potrebno je navesti <code class="language-plaintext highlighter-rouge">mappedBy</code> opciju u odgovarajućoj anotaciji. Ako jedna klasa navede ovu opciju, onda je druga strana vlasnik asocijacije i vrednost opcije mora biti polje te druge klase. Dajemo primer korišćenja kroz klase <code class="language-plaintext highlighter-rouge">Student</code> i <code class="language-plaintext highlighter-rouge">Knjiga</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="kd">class</span> <span class="nc">Student</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id_studenta</span><span class="o">;</span>

    <span class="nd">@ManyToMany</span><span class="o">(</span><span class="n">mappedBy</span><span class="o">=</span><span class="s">"studenti"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Knjiga</span><span class="o">&gt;</span> <span class="n">knjige</span><span class="o">;</span>
    
    <span class="c1">// Get/set metodi</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">class</span> <span class="nc">Knjiga</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id_knjige</span><span class="o">;</span>
    
    <span class="nd">@ManyToMany</span>
    <span class="nd">@JoinTable</span><span class="o">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">"STUDENTKNJIGALINK"</span><span class="o">,</span> 
        <span class="n">joinColumns</span> <span class="o">=</span> <span class="o">{</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ID_KNJIGE"</span><span class="o">)</span> <span class="o">},</span> 
        <span class="n">inverseJoinColumns</span> <span class="o">=</span> <span class="o">{</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ID_STUDENTA"</span><span class="o">)</span> <span class="o">}</span>
    <span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Student</span><span class="o">&gt;</span> <span class="n">studenti</span><span class="o">;</span>
    
    <span class="c1">// Get/set metodi</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Anotacija <code class="language-plaintext highlighter-rouge">@JoinTable</code> u prethodnom fragmentu koda ukazuje na to da ce biti kreirana spojna tabela pod nazivom <code class="language-plaintext highlighter-rouge">STUDENTKNJIGALINK</code>. Atributom <code class="language-plaintext highlighter-rouge">joinColumns</code> anotacije <code class="language-plaintext highlighter-rouge">@JoinTable</code> se postavljaju kolone stranog kljuca spojne tabele koje referišu na primarni ključ entiteta koji je odgovoran za odrzavanje asocijacije (ovde je to <code class="language-plaintext highlighter-rouge">Knjiga</code>). Nasuprot tome, atributom <code class="language-plaintext highlighter-rouge">inverseJoinColumns</code> se postavljaju kolone stranog ključa spojne tabele koje referišu na primarni ključ <em>onog drugog</em> entiteta (ovde je to <code class="language-plaintext highlighter-rouge">Student</code>).</p>

<h3 id="1124-strani-ključevi-u-složenim-primarnim-ključevima">11.2.4 Strani ključevi u složenim primarnim ključevima</h3>

<p>Pretpostavimo da imamo tabelu <code class="language-plaintext highlighter-rouge">KORISNIK</code> čiji se složeni primarni ključ sastoji od kolona <code class="language-plaintext highlighter-rouge">KORISNICKO_IME</code> i <code class="language-plaintext highlighter-rouge">ID_ODELJENJA</code>, kao i da imamo tabelu <code class="language-plaintext highlighter-rouge">ODELJENJE</code> koja sadrži primarni ključ <code class="language-plaintext highlighter-rouge">ID_ODELJENJE</code>. Takođe, postoji ograničenje stranog ključa <code class="language-plaintext highlighter-rouge">FK1</code> koji postavlja ograničenje na kolonu <code class="language-plaintext highlighter-rouge">ID_ODELJENJA</code> iz tabele <code class="language-plaintext highlighter-rouge">KORISNIK</code> u odnosu na kolonu <code class="language-plaintext highlighter-rouge">ID_ODELJENJE</code> iz tabele <code class="language-plaintext highlighter-rouge">ODELJENJE</code> i koji predstavlja odnos više-ka-jedan (jedno odeljenje može imati više korisnika, a jedan korisnik može pripadati samo jednom odeljenju). Ova situacija je ilustrovana na narednoj slici.</p>

<p><img src="/vezbe/poglavlja/11/Slike/strani1.png" alt="Strani ključevi u složenim primarnim ključevima" /></p>

<p>Problem koji se ovde javlja jeste da postoji strani ključ ka vrednosti iz druge tabele (<code class="language-plaintext highlighter-rouge">ODELJENJE</code>) kao deo složenog primarnog ključa u prvoj tabeli (<code class="language-plaintext highlighter-rouge">KORISNIK</code>). Ovo je očigledno problem dupliciranih podataka i prilikom trajnog čuvanja podataka, Hibernate mora da zna koju će vrednost smatrati za “ispravnu”. Klasu koja sadrži ovakvu specijalnu situaciju potrebno je anotirani anotacijom <code class="language-plaintext highlighter-rouge">@MapsId</code>. Njena vrednost je naziv polja u složenom primarnom ključu te tabele koja čuva informaciju o stranom ključu ka drugoj tabeli. Pogledajmo kako bismo razrešili ovaj problem na prethodno opisanoj situaciji:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">KorisnikId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="nc">String</span> <span class="n">korisnicko_ime</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="nc">Long</span> <span class="n">id_odeljenja</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Korisnik</span> <span class="o">{</span>
    <span class="nd">@EmbeddedId</span>
    <span class="kd">protected</span> <span class="nc">KorisnikId</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@MapsId</span><span class="o">(</span><span class="s">"id_odeljenja"</span><span class="o">)</span>
    <span class="kd">protected</span> <span class="nc">Odeljenje</span> <span class="n">odeljenje</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Korisnik</span><span class="o">(</span><span class="nc">KorisnikId</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Anotacija <code class="language-plaintext highlighter-rouge">@MapsId</code> kaže Hibernate razvojnom okruženju da ignoriše vrednost polja <code class="language-plaintext highlighter-rouge">KorisnikId.id_odeljenja</code> prilikom čuvanja instance klase <code class="language-plaintext highlighter-rouge">Korisnik</code>. Hibernate će umesto toga koristiti identifikator iz klase <code class="language-plaintext highlighter-rouge">Odeljenje</code> dodeljen polju <code class="language-plaintext highlighter-rouge">Korisnik.odeljenje</code> prilikom čuvanja sloga u tabeli <code class="language-plaintext highlighter-rouge">KORISNIK</code>.</p>

<p>Alternativni pristup ovom preslikavanju jeste da se umesto anotacije <code class="language-plaintext highlighter-rouge">@MapsId</code> koristi anotacija <code class="language-plaintext highlighter-rouge">@JoinColumn</code> kojom se navodi nazivi kolona koje učestvuju u formiranju stranog ključa. U toj situaciji je neophodno navesti i vrednost <code class="language-plaintext highlighter-rouge">false</code> za opcije <code class="language-plaintext highlighter-rouge">insertable</code> i <code class="language-plaintext highlighter-rouge">updatable</code> ove anotacije sa narednim značenjem:</p>

<ul>
  <li>
    <p>Svojstvo <code class="language-plaintext highlighter-rouge">insertable</code> uzima podrazumevano vrednost <code class="language-plaintext highlighter-rouge">true</code>, a ukoliko se postavi na <code class="language-plaintext highlighter-rouge">false</code>, onda anotirano polje se neće nalaziti u <code class="language-plaintext highlighter-rouge">INSERT</code> naredbama generisanim od strane Hibernate alata (drugim rečima, neće biti trajno upisano u bazu podataka).</p>
  </li>
  <li>
    <p>Svojstvo <code class="language-plaintext highlighter-rouge">updatable</code> uzima podrazumevano vrednost <code class="language-plaintext highlighter-rouge">true</code>, a ukoliko se postavi na <code class="language-plaintext highlighter-rouge">false</code>, onda anotirano polje se neće nalaziti u <code class="language-plaintext highlighter-rouge">UPDATE</code> naredbama generisanim od strane Hibernate alata (drugim rečima, neće biti promenjeno jednom kada se trajno upiše u bazu podataka).</p>
  </li>
</ul>

<p>Korišćenje ovog pristupa dovodi do narednog koda:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">KorisnikId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="nc">String</span> <span class="n">korisnicko_ime</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="nc">Long</span> <span class="n">id_odeljenja</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Korisnik</span> <span class="o">{</span>
    <span class="nd">@EmbeddedId</span>
    <span class="kd">protected</span> <span class="nc">KorisnikId</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"id_odeljenja"</span><span class="o">,</span>
                <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"id_odeljenja"</span><span class="o">,</span>
                <span class="n">insertable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span>
                <span class="n">updatable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">))</span>
    <span class="kd">protected</span> <span class="nc">Odeljenje</span> <span class="n">odeljenje</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Korisnik</span><span class="o">(</span><span class="nc">KorisnikId</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Jednostavnije rečeno, ne želimo da menjamo podatke u tabeli <code class="language-plaintext highlighter-rouge">ODELJENJE</code> menjanjem polja <code class="language-plaintext highlighter-rouge">id_odeljenja</code> iz klase <code class="language-plaintext highlighter-rouge">KorisnikId</code> (čime ga obeležavamo da je <em>samo za čitanje</em> (engl. <em>readonly</em>)).</p>

<p>Napomenimo još i da, ukoliko tabela ima više stranih ključeva, onda je korišćenje anotacije <code class="language-plaintext highlighter-rouge">@JoinColumn</code> neophodno da bi se navelo koje kolone učestvuju u formiranju ograničenja stranog ključa. Naravno, ukoliko se <code class="language-plaintext highlighter-rouge">@JoinColumn</code> koristi u kombinaciji sa <code class="language-plaintext highlighter-rouge">@MapsId</code>, onda nije neophodno navesti opcije <code class="language-plaintext highlighter-rouge">insertable</code> i <code class="language-plaintext highlighter-rouge">updatable</code>.</p>

<p>Ova anotacija se još koristi i kada se zbog bidirekcione veze duplicira strani ključ. U tom slučaju se navode sve četiri opcije.</p>

<div class="ui stacked segment">
  <p><strong>Zadatak 11.2</strong>: Napisati Java aplikaciju koja korišćenjem biblioteke Hibernate za sve studente, koji su rođeni u mestu koje se unosi sa standardnog ulaza i upisali su studijski program obima epsb koji se unosi sa standardnog ulaza, ispisuje ime, prezime i naziv studijskog programa.</p>
</div>

<p>Rešenje: Tabelu <code class="language-plaintext highlighter-rouge">DOSIJE</code> do sad nismo koristili pa je potrebno da kreiramo odgovarajuću klasu i definišemo preslikavanje u tabelu <code class="language-plaintext highlighter-rouge">DOSIJE</code>, a onda i vezu sa klasom <code class="language-plaintext highlighter-rouge">StudijskiProgram</code>. Vezu definišemo koa više-ka-jedan u klasi <code class="language-plaintext highlighter-rouge">Student</code> jer više studenata mogu upisati isti studijski program. Pošto tabela <code class="language-plaintext highlighter-rouge">DOSIJE</code> sadrži polje <code class="language-plaintext highlighter-rouge">IDPROGRAMA</code>, a dodavanjem ove veze dupliciramo podatke (polje <code class="language-plaintext highlighter-rouge">StudijskiProgram studijskiProgram</code>  takođe sadrži informaciju o identifikatoru) potrebno je dodati i anotaciju <code class="language-plaintext highlighter-rouge">@JoinColumn</code> za polje <code class="language-plaintext highlighter-rouge">studijskiProgram</code>:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_11/src/zadatak_11_2/Student.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_11_2</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DA.DOSIJE"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Student</span> <span class="o">{</span>
    <span class="c1">// Primarni kljuc</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">indeks</span><span class="o">;</span>

    <span class="c1">// Kolone od znacaja</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"IME"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">ime</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PREZIME"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">prezime</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"MESTORODJENJA"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">mesto</span><span class="o">;</span>


    <span class="c1">// Kreiramo dvosmernu asocijativnu vezu izmedju klasa StudijskiProgram i Student.</span>
    <span class="c1">// Posto tabela Dosije sadrzi strani kljuc idprograma koji referise na StudijskiProgram</span>
    <span class="c1">// potrebno je da se u klasi StudijskiProgram definise vrednost za opciju mappedBy.</span>
    <span class="c1">// Dodatno, zbog stranog kljuca moramo dodati anotaciju @JoinColumn kako</span>
    <span class="c1">// bismo ogranicili koriscenje ove reference na citanje.</span>
    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"IDPROGRAMA"</span><span class="o">,</span> <span class="n">referencedColumnName</span><span class="o">=</span><span class="s">"ID"</span><span class="o">,</span> <span class="n">insertable</span><span class="o">=</span><span class="kc">false</span><span class="o">,</span> <span class="n">updatable</span><span class="o">=</span><span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">StudijskiProgram</span> <span class="n">studijskiProgram</span><span class="o">;</span>

    <span class="c1">// Get/set metodi</span>

    <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">getIndeks</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">indeks</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIndeks</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">indeks</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">indeks</span> <span class="o">=</span> <span class="n">indeks</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getIme</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ime</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIme</span><span class="o">(</span><span class="nc">String</span> <span class="n">ime</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">ime</span> <span class="o">=</span> <span class="n">ime</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getPrezime</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">prezime</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPrezime</span><span class="o">(</span><span class="nc">String</span> <span class="n">prezime</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">prezime</span> <span class="o">=</span> <span class="n">prezime</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">StudijskiProgram</span> <span class="nf">getStudijskiProgram</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">studijskiProgram</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStudijskiProgram</span><span class="o">(</span><span class="nc">StudijskiProgram</span> <span class="n">studijskiProgram</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">studijskiProgram</span> <span class="o">=</span> <span class="n">studijskiProgram</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>Ova veza je definisana u klasi <code class="language-plaintext highlighter-rouge">StudijskiProgram</code> kao jedan-ka-više, s obzirom da jedan studijski program može sadržati više studenata:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_11/src/zadatak_11_2/StudijskiProgram.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_11_2</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToMany</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DA.STUDIJSKIPROGRAM"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">StudijskiProgram</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"OZNAKA"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="nc">Oznaka</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"NAZIV"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="nc">Naziv</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"OBIMESPB"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="nc">Espb</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"IDNIVOA"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="nc">Nivo</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"ZVANJE"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="nc">Zvanje</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"OPIS"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="nc">Opis</span><span class="o">;</span>
    
    <span class="c1">// Kreiramo dvosmernu asocijativnu vezu izmedju klasa StudijskiProgram i Student.</span>
    <span class="c1">// Posto tabela Dosije sadrzi strani kljuc id_smera koji referise na StudijskiProgram</span>
    <span class="c1">// potrebno je da se u klasi StudijskiProgram postavljamo opciju mappedBy na naziv polja</span>
    <span class="c1">// tipa StudijskiProgram u klasi Student.</span>
    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span><span class="o">=</span><span class="s">"studijskiProgram"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Student</span><span class="o">&gt;</span> <span class="n">studenti</span><span class="o">;</span>


    <span class="kd">public</span> <span class="nf">StudijskiProgram</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="nf">StudijskiProgram</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">oznaka</span><span class="o">,</span> <span class="nc">String</span> <span class="n">naziv</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">espb</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">nivo</span><span class="o">,</span>
            <span class="nc">String</span> <span class="n">zvanje</span><span class="o">,</span> <span class="nc">String</span> <span class="n">opis</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
        <span class="nc">Oznaka</span> <span class="o">=</span> <span class="n">oznaka</span><span class="o">;</span>
        <span class="nc">Naziv</span> <span class="o">=</span> <span class="n">naziv</span><span class="o">;</span>
        <span class="nc">Espb</span> <span class="o">=</span> <span class="n">espb</span><span class="o">;</span>
        <span class="nc">Nivo</span> <span class="o">=</span> <span class="n">nivo</span><span class="o">;</span>
        <span class="nc">Zvanje</span> <span class="o">=</span> <span class="n">zvanje</span><span class="o">;</span>
        <span class="nc">Opis</span> <span class="o">=</span> <span class="n">opis</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getOznaka</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Oznaka</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOznaka</span><span class="o">(</span><span class="nc">String</span> <span class="n">oznaka</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Oznaka</span> <span class="o">=</span> <span class="n">oznaka</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getNaziv</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Naziv</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNaziv</span><span class="o">(</span><span class="nc">String</span> <span class="n">naziv</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Naziv</span> <span class="o">=</span> <span class="n">naziv</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">getEspb</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Espb</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEspb</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">espb</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Espb</span> <span class="o">=</span> <span class="n">espb</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">getNivo</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Nivo</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNivo</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">nivo</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Nivo</span> <span class="o">=</span> <span class="n">nivo</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getZvanje</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Zvanje</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setZvanje</span><span class="o">(</span><span class="nc">String</span> <span class="n">zvanje</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Zvanje</span> <span class="o">=</span> <span class="n">zvanje</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getOpis</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Opis</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOpis</span><span class="o">(</span><span class="nc">String</span> <span class="n">opis</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Opis</span> <span class="o">=</span> <span class="n">opis</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Student</span><span class="o">&gt;</span> <span class="nf">getStudenti</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">studenti</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStudenti</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Student</span><span class="o">&gt;</span> <span class="n">studenti</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">studenti</span> <span class="o">=</span> <span class="n">studenti</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"Studijski program [id="</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">", Oznaka="</span> <span class="o">+</span> <span class="nc">Oznaka</span> <span class="o">+</span> <span class="s">", Naziv="</span> <span class="o">+</span> <span class="nc">Naziv</span>
                <span class="o">+</span> <span class="s">", Espb="</span> <span class="o">+</span> <span class="nc">Espb</span> <span class="o">+</span> <span class="s">", Nivo="</span> <span class="o">+</span> <span class="nc">Nivo</span> <span class="o">+</span> <span class="s">", Zvanje="</span> <span class="o">+</span> <span class="nc">Zvanje</span> <span class="o">+</span> <span class="s">", Opis="</span> <span class="o">+</span> <span class="nc">Opis</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>Zahtev je implementiran u metodu <code class="language-plaintext highlighter-rouge">readStudenti()</code> klase <code class="language-plaintext highlighter-rouge">Main.java</code>:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_11/src/zadatak_11_2/Main.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_11_2</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Session</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.Transaction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.query.Query</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Pocetak rada...\n"</span><span class="o">);</span>

        <span class="n">readStudenti</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Zavrsetak rada.\n"</span><span class="o">);</span>
        <span class="nc">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">readStudenti</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="nc">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">openSession</span><span class="o">();</span>
        <span class="nc">Transaction</span> <span class="no">TR</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">Scanner</span> <span class="n">ulaz</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">))</span> <span class="o">{</span>
            <span class="no">TR</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Unesite mesto rodjenja:"</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">mesto</span> <span class="o">=</span> <span class="n">ulaz</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Unesite broj ESPB bodova:"</span><span class="o">);</span>
            <span class="nc">Integer</span> <span class="n">espb</span> <span class="o">=</span> <span class="n">ulaz</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>

            <span class="c1">// HQL upit za izdvajanje podataka o studentima</span>
            <span class="c1">// sa odredjenim mestom rodjenja i brojem bodova.</span>
            <span class="c1">// Kao sto se u FROM klauzi navodi naziv KLASE, a ne TABELE,</span>
            <span class="c1">// tako se u WHERE klauzi navode ATRIBUTI, a ne KOLONE.</span>
            <span class="nc">String</span> <span class="n">hql</span> <span class="o">=</span> <span class="s">"SELECT s.ime, s.prezime, sp.Naziv "</span> <span class="o">+</span> 
                        <span class="s">"FROM Student s INNER JOIN s.studijskiProgram AS sp "</span> <span class="o">+</span>
                        <span class="s">"WHERE s.mesto = :mesto AND "</span> <span class="o">+</span> 
                        <span class="s">"sp.Espb = :espb"</span><span class="o">;</span>
            <span class="c1">// Pripremanje upita</span>
            <span class="c1">// Zbog projekcije rezultat ce biti tipa Object[]</span>
            <span class="nc">Query</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">upit</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">hql</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[].</span><span class="na">class</span><span class="o">);</span>
            
            <span class="c1">// Postavljanje vrednosti za imenovane parametarske oznake</span>
            <span class="n">upit</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"mesto"</span><span class="o">,</span> <span class="n">mesto</span><span class="o">);</span>
            <span class="n">upit</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"espb"</span><span class="o">,</span> <span class="n">espb</span><span class="o">);</span>

            <span class="c1">// Izvrsavanje upita i listanje podataka</span>
            <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Object</span><span class="o">[]&gt;</span> <span class="n">studenti</span> <span class="o">=</span> <span class="n">upit</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>

            <span class="c1">// Ispis rezultata</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">studenti</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="nc">Object</span><span class="o">[]</span> <span class="n">student</span> <span class="o">:</span> <span class="n">studenti</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">student</span><span class="o">));</span>
                <span class="o">}</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Nema rezultata za zadate vrednosti!"</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="no">TR</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Postoji problem sa ispisivanjem podataka o studentima! Ponistavanje transakcije!"</span><span class="o">);</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="no">TR</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="no">TR</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<h3 id="1125-strani-ključevi-ka-složenim-ključevima">11.2.5 Strani ključevi ka složenim ključevima</h3>

<p>Slična situacija se javlja kada je potrebno mapirati asocijativnu vezu složenog stranog ključa. Pogledajmo DDL za naredne dve tabele:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">KORISNIK</span> <span class="p">(</span>
    <span class="n">KORISNICKO_IME</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">ID_ODELJENJA</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>

    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">KORISNICKO_IME</span><span class="p">,</span> <span class="n">ID_ODELJENJA</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">ARTIKAL</span> <span class="p">(</span>
    <span class="n">ID</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">KORISNICKO_IME_PRODAVCA</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">ID_ODELJENJA_PRODAVCA</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID</span><span class="p">),</span>
    
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span>
        <span class="n">KORISNICKO_IME_PRODAVCA</span><span class="p">,</span>
        <span class="n">ID_ODELJENJA_PRODAVCA</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">KORISNIK</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Zgodno je ilustrovati ovu situaciju crtežom:</p>

<p><img src="/vezbe/poglavlja/11/Slike/strani2.png" alt="Strani ključevi ka složenim ključevima" /></p>

<p>U ovoj shemi, prodavac artikla je predstavljen složenim stranim ključem u tabeli <code class="language-plaintext highlighter-rouge">ARTIKAL</code>. Ova veza predstavlja odnos jedan-ka-više (jedan korisnik je vlasnik više artikala, a jedan artikal pripada samo jednom korisniku). U domenskom modelu, ovo preslikavanje se može rešiti na sledeći način:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">///////////////////////////////////</span>
<span class="c1">// BEGIN Korisnik.java</span>

<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KorisnikId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="nc">Integer</span> <span class="n">korisnicko_ime</span><span class="o">;</span>
    <span class="nc">Integer</span> <span class="n">id_odeljenja</span><span class="o">;</span>
    
    <span class="c1">// ...</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Korisnik</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nc">KorisnikId</span> <span class="n">id</span><span class="o">;</span>
    
    <span class="c1">// ...</span>
<span class="o">}</span>

<span class="c1">// END Korisnik.java</span>

<span class="c1">///////////////////////////////////</span>
<span class="c1">// BEGIN Artikal.java</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Artikal</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="nc">Integer</span> <span class="n">id_artikla</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumns</span><span class="o">({</span>
        <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"korisnicko_ime_prodavca"</span><span class="o">,</span>
                    <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"korisnicko_ime"</span><span class="o">),</span>
        <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id_odeljenja_prodavca"</span><span class="o">,</span>
                    <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"id_odeljenja"</span><span class="o">)</span>
    <span class="o">})</span>
    <span class="nc">Korisnik</span> <span class="n">prodavac</span><span class="o">;</span>
    <span class="c1">// ...</span>
<span class="o">}</span>

<span class="c1">// END Artikal.java</span>
</code></pre></div></div>

<p>Anotacija <code class="language-plaintext highlighter-rouge">@JoinColumns</code> predstavlja listu kolona u složenom stranom ključu koje učestvuju u ovoj asocijativnoj vezi. Svaka kolona se ostvaruje navođenjem jedne <code class="language-plaintext highlighter-rouge">@JoinColumn</code> anotacije. Napomenimo da ne bi trebalo zaboraviti postavljanje vrednosti opcije <code class="language-plaintext highlighter-rouge">referencedColumnName</code> u <code class="language-plaintext highlighter-rouge">@JoinColumn</code> anotacijama, čime se ostvaruje veza između izvora i cilja stranog ključa. Hibernate nas, nažalost, neće upozoriti ukoliko ovo zaboravimo, a može dovesti do problema usled pogrešnog redosleda kolona u generisanoj shemi.</p>

<h3 id="1126-složeni-strani-ključevi-kao-delovi-složenih-primarnih-ključeva">11.2.6 Složeni strani ključevi kao delovi složenih primarnih ključeva</h3>

<p>Najkomplikovaniji slučaj se može pojaviti ukoliko se izmeni shema tabele <code class="language-plaintext highlighter-rouge">ARTIKAL</code> tako da kolone stranog ključa učestvuju u složenom primarnom ključu, kao u narednoj shemi:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">ARTIKAL</span> <span class="p">(</span>
    <span class="n">ID</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">KORISNICKO_IME_PRODAVCA</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">ID_ODELJENJA_PRODAVCA</span> <span class="nb">INTEGER</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>

    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID</span><span class="p">,</span>
        <span class="n">KORISNICKO_IME_PRODAVCA</span><span class="p">,</span>
        <span class="n">ID_ODELJENJA_PRODAVCA</span><span class="p">),</span>
    
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span>
        <span class="n">KORISNICKO_IME_PRODAVCA</span><span class="p">,</span>
        <span class="n">ID_ODELJENJA_PRODAVCA</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">KORISNIK</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Naredna slika nam može pomoći u analiziranju ove situacije:</p>

<p><img src="/vezbe/poglavlja/11/Slike/strani3.png" alt="Složeni strani ključevi kao delovi složenih primarnih ključeva" /></p>

<p>Zapravo, ako malo bolje pogledamo, možemo primetiti da ovaj slučaj nastaje kombinacijom prethodna dva slučaja — sa jedne strane imamo situaciju da strani ključ predstavlja deo složenog primarnog ključa, a takođe imamo situaciju da je strani ključ složen. Dakle, sve što je potrebno da uradimo jeste da kombinujemo rešenja oba problema, tj. da iskoristimo anotacije <code class="language-plaintext highlighter-rouge">@MapsId</code> i <code class="language-plaintext highlighter-rouge">@JoinColumns</code>, zajedno sa odgovarajućom anotacijom za tip veze, kao u narednom kodu:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArtikalId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>
    <span class="nc">KorisnikId</span> <span class="n">id_korisnika</span><span class="o">;</span>
    
    <span class="c1">// ...</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Artikal</span> <span class="o">{</span>
    <span class="nd">@EmbeddedId</span>
    <span class="nc">ArtikalId</span> <span class="n">id_artikla</span><span class="o">;</span>

    <span class="c1">// Naredne anotacije se vezuju za polje `Korisnik prodavac` ispod.</span>
    <span class="c1">// Odvojene su radi lakseg analiziranja i komentarisanja.</span>
    <span class="c1">// 1. Vezujemo `ArtikalId.id_korisnika` za identifikator klase `Korisnik`</span>
    <span class="nd">@MapsId</span><span class="o">(</span><span class="s">"id_korisnika"</span><span class="o">)</span>

    <span class="c1">// 2. Definisemo po cemu se vrsi spajanje za slozeni strani kljuc</span>
    <span class="c1">// koji postoji izmedju klasa `Artikal` i `Korisnik`</span>
    <span class="nd">@JoinColumns</span><span class="o">({</span>
        <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"korisnicko_ime_prodavca"</span><span class="o">,</span>
                    <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"korisnicko_ime"</span><span class="o">),</span>
        <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id_odeljenja_prodavca"</span><span class="o">,</span>
                    <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"id_odeljenja"</span><span class="o">)</span>
    <span class="o">})</span>

    <span class="c1">// 3. Definisemo tip veze izmedju `Artikal` i `Korisnik`</span>
    <span class="nd">@ManyToOne</span>

    <span class="nc">Korisnik</span> <span class="n">prodavac</span><span class="o">;</span>

    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="ui stacked segment">
  <p><strong>Zadatak 11.3</strong>: Napisati Java aplikaciju koja korišćenjem biblioteke Hibernate ispisuje nazive svih studijskih programa. Nakon svakog naziva studijskog programa, ispisuju se indeks, ime, prezime i prosek svih studenata na tom studijskom programu.</p>
</div>

<p>Ovaj zahtev je do sada najsloženiji jer uvodi dosta novih klasa i preslikavanja. Za početak, s obzirom da su nam potrebni podaci iz tabele <code class="language-plaintext highlighter-rouge">ISPIT</code> koju do sada nismo koristili, potrebno je da kreiramo klasu <code class="language-plaintext highlighter-rouge">Ispit</code>, i definišemo preslikavanja između njih i odgovarajućih tabela, kao i između samih klasa. Za početak, dajmo njenu celu definiciju, pa ćemo obratiti pažnju na neke detalje:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_11/src/zadatak_11_3/Ispit.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_11_3</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumns</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.MapsId</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DA.ISPIT"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Ispit</span> <span class="o">{</span>
    <span class="c1">// Primarni kljuc</span>
    <span class="c1">// U ovom slucaju cemo koristiti drugi pristup kreiranju primarnog kljuca,</span>
    <span class="c1">// tj. koriscenjem @EmbeddedId anotacije.</span>
    <span class="c1">// Pogledati skriptu za vise detalja.</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">IspitId</span> <span class="n">idIspita</span><span class="o">;</span>

    <span class="c1">// Ostale kolone</span>

    <span class="nd">@Column</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">ocena</span><span class="o">;</span>

    <span class="nd">@Column</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">status</span><span class="o">;</span>

    <span class="c1">// Resavanje asocijativnih veza izmedju klasa</span>

    <span class="c1">// Kreiranje veze izmedju Ispit i Student</span>
    <span class="c1">// Posto tabela Ispit sadrzi vise od jednog stranog kljuca</span>
    <span class="c1">// moramo da navedemo anotaciju @JoinColumn i da definisemo</span>
    <span class="c1">// vrednosti za sve opcije ili kombinaciju @MapsId i @JoinColumn</span>
    <span class="c1">// s tim da onda mozemo izostaviti opcije insertable i updatable</span>
    <span class="nd">@ManyToOne</span>
    <span class="nd">@MapsId</span><span class="o">(</span><span class="s">"indeks"</span><span class="o">)</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"INDEKS"</span><span class="o">,</span> <span class="n">referencedColumnName</span><span class="o">=</span><span class="s">"INDEKS"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Student</span> <span class="n">student</span><span class="o">;</span>

    <span class="c1">// Problem je sto se u primarnom kljucu javlja "potkljuc" IspitniRokId,</span>
    <span class="c1">// koji ima kolone "godina" i "oznaka".</span>
    <span class="c1">// A u primarnom kljucu tabele "ispit",</span>
    <span class="c1">// te kolone se nazivaju "godina_roka" i "oznaka_roka", redom.</span>
    <span class="c1">// Tako da je potrebno to resiti.</span>

    <span class="c1">// IspitniRok se spaja sa Ispit preko IspitniRokId,</span>
    <span class="c1">// koji je u IspitId stavljen kao polje "id_roka"</span>
    <span class="c1">// Zato koristimo @MapsId anotaciju, koja prihvata naziv polja</span>
    <span class="c1">// u @EmbeddedId klasi IspitniRokId</span>
    <span class="nd">@MapsId</span><span class="o">(</span><span class="s">"idRoka"</span><span class="o">)</span>
    <span class="c1">// Sada specifikujemo kako se tacno vrsi "spajanje",</span>
    <span class="c1">// tj. kako se formira ogranicenje stranog kljuca.</span>
    <span class="c1">// Za to koristimo JoinColums, posto se spajanje vrsi po dve kolone,</span>
    <span class="c1">// odnosno koriscenjem dva polja iz klase</span>
    <span class="nd">@JoinColumns</span><span class="o">({</span> <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"skgodina"</span><span class="o">,</span> <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"skgodina"</span><span class="o">),</span>
            <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"oznakaroka"</span><span class="o">,</span> <span class="n">referencedColumnName</span> <span class="o">=</span> <span class="s">"oznakaroka"</span><span class="o">)</span> <span class="o">})</span>
    <span class="c1">// Na kraju, specifikujemo tip veze</span>
    <span class="nd">@ManyToOne</span>
    <span class="kd">private</span> <span class="nc">IspitniRok</span> <span class="n">ispitniRok</span><span class="o">;</span>

    <span class="c1">// Get/set metodi</span>

    <span class="kd">public</span> <span class="nc">IspitId</span> <span class="nf">getIdIspita</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">idIspita</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId_ispita</span><span class="o">(</span><span class="nc">IspitId</span> <span class="n">idIspita</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">idIspita</span> <span class="o">=</span> <span class="n">idIspita</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">getOcena</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ocena</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOcena</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">ocena</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">ocena</span> <span class="o">=</span> <span class="n">ocena</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getStatus</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">status</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStatus</span><span class="o">(</span><span class="nc">String</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">status</span> <span class="o">=</span> <span class="n">status</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Student</span> <span class="nf">getStudent</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">student</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStudent</span><span class="o">(</span><span class="nc">Student</span> <span class="n">student</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">student</span> <span class="o">=</span> <span class="n">student</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<p>Prvo što vidimo jeste da klasa Ispit sadrži složeni ključ <code class="language-plaintext highlighter-rouge">IspitId</code>. Dajmo i definiciju ove klase:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_11/src/zadatak_11_3/IspitId.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_11_3</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Objects</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Embeddable</span><span class="o">;</span>

<span class="c1">// Klasa predstavlja slozeni kljuc za Ispit.</span>
<span class="c1">// Anotiralmo je anotacijom @Embeddable</span>
<span class="nd">@Embeddable</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IspitId</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="c1">// Slozeni kljuc tabele "ispit" sadrzi primarni kljuc tabele "ispitni_rok",</span>
    <span class="c1">// kao i kolone "indeks" i "id_predmeta"</span>

    <span class="kd">private</span> <span class="nc">IspitniRokId</span> <span class="n">idRoka</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"INDEKS"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">indeks</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"IDPREDMETA"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">idPredmeta</span><span class="o">;</span>

    <span class="c1">// Podrazumevani konstruktor za Serializable</span>
    <span class="kd">public</span> <span class="nf">IspitId</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">IspitId</span><span class="o">(</span><span class="nc">IspitniRokId</span> <span class="n">idRoka</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">indeks</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">idPredmeta</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">idRoka</span> <span class="o">=</span> <span class="n">idRoka</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">indeks</span> <span class="o">=</span> <span class="n">indeks</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">idPredmeta</span> <span class="o">=</span> <span class="n">idPredmeta</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Get/set metodi</span>

    <span class="kd">public</span> <span class="nc">IspitniRokId</span> <span class="nf">getIdRoka</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">idRoka</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId_roka</span><span class="o">(</span><span class="nc">IspitniRokId</span> <span class="n">idRoka</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">idRoka</span> <span class="o">=</span> <span class="n">idRoka</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">getIndeks</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">indeks</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIndeks</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">indeks</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">indeks</span> <span class="o">=</span> <span class="n">indeks</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">getIdPredmeta</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">idPredmeta</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId_predmeta</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">idPredmeta</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">idPredmeta</span> <span class="o">=</span> <span class="n">idPredmeta</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Prevazilazenje metoda za odredjivanje jednakosti kljuceva</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">IspitId</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nc">IspitId</span> <span class="n">other</span> <span class="o">=</span> <span class="o">(</span><span class="nc">IspitId</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>

        <span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getIdRoka</span><span class="o">(),</span> <span class="n">other</span><span class="o">.</span><span class="na">getIdRoka</span><span class="o">())</span>
                <span class="o">&amp;&amp;</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getIndeks</span><span class="o">(),</span> <span class="n">other</span><span class="o">.</span><span class="na">getIndeks</span><span class="o">())</span>
                <span class="o">&amp;&amp;</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getIdPredmeta</span><span class="o">(),</span> <span class="n">other</span><span class="o">.</span><span class="na">getIdPredmeta</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getIdRoka</span><span class="o">(),</span> <span class="k">this</span><span class="o">.</span><span class="na">getIndeks</span><span class="o">(),</span> <span class="k">this</span><span class="o">.</span><span class="na">getIdPredmeta</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>Ono što primećujemo jeste da u okviru ovog primarnog ključa se nalazi drugi primarni ključ i to za klasu <code class="language-plaintext highlighter-rouge">IspitniRok</code>, odnosno, klasa <code class="language-plaintext highlighter-rouge">IspitniRokId</code>. Ovde vidimo da možemo klase koje predstavljaju primarne ključeve nekih klasa (kao što je <code class="language-plaintext highlighter-rouge">IspitniRokId</code>) koristiti u klasama koje predstavljaju primarne ključeve drugih klasa (kao što je <code class="language-plaintext highlighter-rouge">IspitId</code>), ali samo ako su oni kreirane prvim pristupom kreiranja stranih ključeva — pomoću anotacija <code class="language-plaintext highlighter-rouge">@Id</code> i <code class="language-plaintext highlighter-rouge">@Embeddable</code>. Sad nam je jasno zašto smo upravo taj pristup koristili za <code class="language-plaintext highlighter-rouge">IspitniRokId</code>. Štaviše, preslikavanje na ovaj način je obavezno ukoliko želimo da sačuvamo sva ograničenja u poslovnom domenu. Alternativni pristup, u kojem bi se kolone <code class="language-plaintext highlighter-rouge">SKGODINA</code> i <code class="language-plaintext highlighter-rouge">OZNAKAROKA</code> iz tabele <code class="language-plaintext highlighter-rouge">ISPIT</code> preslikavala pomoću dva polja u klasi <code class="language-plaintext highlighter-rouge">IspitId</code>, ne bi očuvao organičenje da obe kolone predstavljaju složeni strani ključ ka tabeli <code class="language-plaintext highlighter-rouge">ISPITNIROK</code>. Zbog toga, klasa <code class="language-plaintext highlighter-rouge">IspitId</code> mora imati polje tipa <code class="language-plaintext highlighter-rouge">IspitniRokId</code> kao u kodu iznad.</p>

<p>Vratimo se nazad na klasu <code class="language-plaintext highlighter-rouge">Ispit</code>. Nakon deklarisanja polja <code class="language-plaintext highlighter-rouge">ocena</code> i <code class="language-plaintext highlighter-rouge">status</code>, potrebno je rešiti asocijativne veze ka klasama <code class="language-plaintext highlighter-rouge">Student</code> i <code class="language-plaintext highlighter-rouge">IspitniRok</code>.</p>

<p>Veza ka klasi <code class="language-plaintext highlighter-rouge">Student</code> je dovoljno jednostavna — jedan ispit pripada tačno jednom studentu, dok jedan student može imati više ispita, dakle, veza je više-ka-jedan, odnosno, koristimo anotaciju <code class="language-plaintext highlighter-rouge">@ManyToOne</code> (ovaj zaključak je donesen iz ugla klase <code class="language-plaintext highlighter-rouge">Ispit</code>). Dodatno, potrebno je da postavimo anotaciju <code class="language-plaintext highlighter-rouge">@MapsId</code> kako bismo ignorisali vrednost iz primarnog ključa <code class="language-plaintext highlighter-rouge">IspitId</code> pri čuvanju ovog podatka — umesto njega, biće korišćena vrednost polja <code class="language-plaintext highlighter-rouge">indeks</code> iz klase <code class="language-plaintext highlighter-rouge">Student</code>. Takođe, s obzirom da ova tabela ima više stranih ključeva, potrebno je da koristimo anotaciju <code class="language-plaintext highlighter-rouge">@JoinColumn</code> da specifikujemo precizno koje kolone učestvuju u ograničenju ovog stranog ključa. Alternativno, možemo ga postaviti samo za čitanje, kao što smo diskutovali u podsekciji <a href="#1124-strani-ključevi-u-složenim-primarnim-ključevima">11.2.4</a>.</p>

<p>Druga veza je prema klasi <code class="language-plaintext highlighter-rouge">IspitniRok</code>. Ukoliko pogledamo kako je sve do sada postavljeno, videćemo da je ovo instanca problema prikazana u podsekciji <a href="#1126-složeni-strani-ključevi-kao-delovi-složenih-primarnih-ključeva">11.2.6</a>. Da se podsetimo, problem je u tome što se u tabeli <code class="language-plaintext highlighter-rouge">ISPIT</code> nalazi složeni strani ključ ka tabeli <code class="language-plaintext highlighter-rouge">ISPITNIROK</code>, pri čemu kolone složenog stranog ključa učestvuju kao deo primarnog ključa. Rešenje je u kreiranju polja klase <code class="language-plaintext highlighter-rouge">IspitniRok</code> i odgovarajućim anotiranjem:</p>

<ul>
  <li>
    <p>Koristimo anotaciju <code class="language-plaintext highlighter-rouge">@MapsId</code> da ignorišemo kolone zadate poljem <code class="language-plaintext highlighter-rouge">idRoka</code> iz primarnog ključa klase <code class="language-plaintext highlighter-rouge">IspitId</code>. Umesto toga, koristićemo polja iz objekta klase <code class="language-plaintext highlighter-rouge">IspitniRok</code> koji anotiramo.</p>
  </li>
  <li>
    <p>Koristimo anotaciju <code class="language-plaintext highlighter-rouge">@JoinColumns</code> da definišemo po kojim kolonama se vrši odgovarajuće preslikavanje za složeni strani ključ. Vrednost ove anotacije je lista <code class="language-plaintext highlighter-rouge">@JoinColumn</code> anotacija, za svaku kolonu u složenom stranom ključu.</p>
  </li>
  <li>
    <p>Koristimo anotaciju <code class="language-plaintext highlighter-rouge">@ManyToOne</code> da definišemo tip preslikavanja. S obzirom da više ispita pripada jednom ispitnom roku, a da jedan ispitni rok sadrži više ispita, veza je više-ka-jedan (opet, posmatrano iz ugla klase <code class="language-plaintext highlighter-rouge">Ispit</code> koju trenutno analiziramo).</p>
  </li>
</ul>

<p>Naravno, ovo podrazumeva izmenu i u klasi <code class="language-plaintext highlighter-rouge">IspitniRok</code>, gde sada definišemo vezu između ispitnih rokova i ispita — jedan ispitni rok ima više ispita, te koristimo anotaciju <code class="language-plaintext highlighter-rouge">@OneToMany</code> za polje tipa <code class="language-plaintext highlighter-rouge">java.util.List&lt;Ispit&gt;</code>. S obzirom da je ova veza dvosmerna, moramo reći koja klasa je odgovorna za održavanje takve veze (tj. za održavanje referencijalnog integriteta stranim ključem). S obzirom da klasa <code class="language-plaintext highlighter-rouge">Ispit</code> održava tu vezu, onda u klasi <code class="language-plaintext highlighter-rouge">IspitniRok</code> postavljamo opciju <code class="language-plaintext highlighter-rouge">mappedBy</code>, kao što je i urađeno u klasi <code class="language-plaintext highlighter-rouge">IspitniRok</code>:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_11/src/zadatak_11_3/IspitniRok.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_11_3</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToMany</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DA.ISPITNIROK"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">IspitniRok</span> <span class="o">{</span>
    <span class="c1">// Primarni kljuc</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">IspitniRokId</span> <span class="n">id</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="c1">// Ostale kolone</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"NAZIV"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="nc">Naziv</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DATPOCETKA"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="nc">Pocetak</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DATKRAJA"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="nc">Kraj</span><span class="o">;</span>

    <span class="c1">// Kreiranje veze izmedju IspitniRok i Ispit.</span>
    <span class="c1">// S obzirom da je veza izmedju ovih klasa dvosmerna,</span>
    <span class="c1">// onda samo jedna klasa moze biti odgovorna za vezu,</span>
    <span class="c1">// sto se postize navodjenjem opcije mappedBy</span>
    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"ispitniRok"</span><span class="o">)</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Ispit</span><span class="o">&gt;</span> <span class="n">ispiti</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="c1">// Autogenerisani Get/Set metodi</span>

    <span class="kd">public</span> <span class="nc">IspitniRokId</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="nc">IspitniRokId</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getNaziv</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Naziv</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNaziv</span><span class="o">(</span><span class="nc">String</span> <span class="n">naziv</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Naziv</span> <span class="o">=</span> <span class="n">naziv</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getPocetak</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Pocetak</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPocetak</span><span class="o">(</span><span class="nc">String</span> <span class="n">pocetak</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Pocetak</span> <span class="o">=</span> <span class="n">pocetak</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getKraj</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Kraj</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setKraj</span><span class="o">(</span><span class="nc">String</span> <span class="n">kraj</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Kraj</span> <span class="o">=</span> <span class="n">kraj</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Ispit</span><span class="o">&gt;</span> <span class="nf">getIspiti</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ispiti</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIspiti</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Ispit</span><span class="o">&gt;</span> <span class="n">ispiti</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">ispiti</span> <span class="o">=</span> <span class="n">ispiti</span><span class="o">;</span>
    <span class="o">}</span>

    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"IspitniRok ["</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">", Naziv="</span> <span class="o">+</span> <span class="nc">Naziv</span> <span class="o">+</span> <span class="s">", Pocetak="</span> <span class="o">+</span> <span class="nc">Pocetak</span> <span class="o">+</span> <span class="s">", Kraj="</span> <span class="o">+</span> <span class="nc">Kraj</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>Dopunimo i klasu <code class="language-plaintext highlighter-rouge">Student</code>:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_11/src/zadatak_11_3/Student.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_11_3</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.OneToMany</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"DA.DOSIJE"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Student</span> <span class="o">{</span>
    <span class="c1">// Primarni kljuc</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">indeks</span><span class="o">;</span>

    <span class="c1">// Kolone od znacaja</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"IME"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">ime</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"PREZIME"</span><span class="o">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">prezime</span><span class="o">;</span>

    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"MESTORODJENJA"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">mesto</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"IDPROGRAMA"</span><span class="o">,</span> <span class="n">referencedColumnName</span><span class="o">=</span><span class="s">"ID"</span><span class="o">,</span> <span class="n">insertable</span><span class="o">=</span><span class="kc">false</span><span class="o">,</span> <span class="n">updatable</span><span class="o">=</span><span class="kc">false</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">StudijskiProgram</span> <span class="n">studijskiProgram</span><span class="o">;</span>

    <span class="c1">// Da bismo izracunali prosek polozenih predmeta za studenta,</span>
    <span class="c1">// potrebno nam je da dohvatimo informacije o njegovim ispitima.</span>
    <span class="c1">// Zbog toga definisemo listu ispita,</span>
    <span class="c1">// i dekorisemo je anotacijom veze izmedju tabela "dosije" i "ispit".</span>
    <span class="c1">// S obzirom da tabela "ispit" treba da odrzava strani kljuc,</span>
    <span class="c1">// onda koristimo mappedBy da bismo specifikovali</span>
    <span class="c1">// da je ta tabela odgovorna za bidirekcionu vezu.</span>
    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"student"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Ispit</span><span class="o">&gt;</span> <span class="n">ispiti</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

 <span class="c1">// Get/set metodi</span>

    <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">getIndeks</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">indeks</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIndeks</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">indeks</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">indeks</span> <span class="o">=</span> <span class="n">indeks</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getIme</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ime</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIme</span><span class="o">(</span><span class="nc">String</span> <span class="n">ime</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">ime</span> <span class="o">=</span> <span class="n">ime</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getPrezime</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">prezime</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPrezime</span><span class="o">(</span><span class="nc">String</span> <span class="n">prezime</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">prezime</span> <span class="o">=</span> <span class="n">prezime</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">StudijskiProgram</span> <span class="nf">getStudijskiProgram</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">studijskiProgram</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStudijskiProgram</span><span class="o">(</span><span class="nc">StudijskiProgram</span> <span class="n">studijskiProgram</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">studijskiProgram</span> <span class="o">=</span> <span class="n">studijskiProgram</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Ispit</span><span class="o">&gt;</span> <span class="nf">getIspiti</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ispiti</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIspiti</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Ispit</span><span class="o">&gt;</span> <span class="n">ispiti</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">ispiti</span> <span class="o">=</span> <span class="n">ispiti</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Metod koji racuna prosek studenta</span>
    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">prosek</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">double</span> <span class="n">ukupno</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">broj_polozenih</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="c1">// Pozivom getIspiti() vrsi se citanje podataka o ispitima </span>
        <span class="c1">// iz baze i njihovo smestanje u listu.</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Ispit</span><span class="o">&gt;</span> <span class="n">ispiti</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">getIspiti</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Ispit</span> <span class="n">ispit</span> <span class="o">:</span> <span class="n">ispiti</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Izdvajamo informacije samo o polozenim ispitima</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">ispit</span><span class="o">.</span><span class="na">getStatus</span><span class="o">().</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"o"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">ispit</span><span class="o">.</span><span class="na">getOcena</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">ukupno</span> <span class="o">+=</span> <span class="n">ispit</span><span class="o">.</span><span class="na">getOcena</span><span class="o">();</span>
                <span class="n">broj_polozenih</span><span class="o">++;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">broj_polozenih</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">ukupno</span> <span class="o">/</span> <span class="n">broj_polozenih</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<p>S obzirom da je potrebno da izračunamo prosek položenih predmeta za datog studenta, definišemo metod <code class="language-plaintext highlighter-rouge">prosek()</code> koji koristi listu svih ispita studenta. Za listu ispita smo morali da napravimo odgovarajuće preslikavanje između klasa <code class="language-plaintext highlighter-rouge">Student</code> i <code class="language-plaintext highlighter-rouge">Ispit</code>. S obzirom da jedan student može imati više ispita, koristimo vezu jedan-ka-više. Dodatno, moramo da navedemo po čemu se vrši “spajanje” između klasa, i to je u ovom slučaju, po koloni <code class="language-plaintext highlighter-rouge">indeks</code>.</p>

<p>Konačno, da bismo završili implementaciju, potrebno je da registrujemo anotirane klase u klasi <code class="language-plaintext highlighter-rouge">HibernateUtil</code> i kreiramo metod u klasi <code class="language-plaintext highlighter-rouge">Main</code> koji testira implementirane klase i metode:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_11/src/zadatak_11_3/HibernateUtil.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_11_3</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.SessionFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.boot.MetadataSources</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.boot.registry.StandardServiceRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.boot.registry.StandardServiceRegistryBuilder</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">HibernateUtil</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">SessionFactory</span> <span class="n">sessionFactory</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">StandardServiceRegistry</span> <span class="n">registry</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StandardServiceRegistryBuilder</span><span class="o">().</span><span class="na">configure</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
            <span class="n">sessionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MetadataSources</span><span class="o">(</span><span class="n">registry</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="nc">StudijskiProgram</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="nc">IspitniRok</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="nc">Student</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">addAnnotatedClass</span><span class="o">(</span><span class="nc">Ispit</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">buildMetadata</span><span class="o">().</span><span class="na">buildSessionFactory</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Session factory error"</span><span class="o">);</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="nc">SessionFactory</span> <span class="nf">getSessionFactory</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">sessionFactory</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>
<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_11/src/zadatak_11_3/Main.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_11_3</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.Session</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.Transaction</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.query.Query</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Pocetak rada...\n"</span><span class="o">);</span>

        <span class="n">readStudijskiProgramoviIStudenti</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Zavrsetak rada.\n"</span><span class="o">);</span>
        <span class="nc">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">readStudijskiProgramoviIStudenti</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="nc">HibernateUtil</span><span class="o">.</span><span class="na">getSessionFactory</span><span class="o">().</span><span class="na">openSession</span><span class="o">();</span>
        <span class="nc">Transaction</span> <span class="no">TR</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="no">TR</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>

            <span class="c1">// Kreiramo HQL upit koji izdvaja sve studijske programe</span>
            <span class="nc">String</span> <span class="n">hql</span> <span class="o">=</span> <span class="s">"from StudijskiProgram"</span><span class="o">;</span>
            <span class="nc">Query</span><span class="o">&lt;</span><span class="nc">StudijskiProgram</span><span class="o">&gt;</span> <span class="n">upit</span> <span class="o">=</span> 
                    <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">hql</span><span class="o">,</span> <span class="nc">StudijskiProgram</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="c1">// Dohvatamo rezultat u listu studijskiProgrami,</span>
            <span class="c1">// i proveravamo da li su svi elementi objekti klase StudijskiProgram</span>
            <span class="nc">List</span><span class="o">&lt;</span><span class="nc">StudijskiProgram</span><span class="o">&gt;</span> <span class="n">studijskiProgrami</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">checkedList</span><span class="o">(</span><span class="n">upit</span><span class="o">.</span><span class="na">list</span><span class="o">(),</span> <span class="nc">StudijskiProgram</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

            <span class="c1">// Kreiramo HQL upit koji izdvaja sve studente</span>
            <span class="c1">// na studijskom programu ciji ce identifikator biti postavljen</span>
            <span class="c1">// na mesto imenovane parametarske oznake "id".</span>
            <span class="c1">// S obzirom da ovo radimo za svaki studijski program,</span>
            <span class="c1">// dohvatanje rezultata moramo da ugnezdimo unutar petlje</span>
            <span class="c1">// koja prolazi studijskim programima.</span>
            <span class="c1">// Drugim recima, koristimo ugnezdjene kursore.</span>
            <span class="n">hql</span> <span class="o">=</span> <span class="s">"from Student where idprograma = :id"</span><span class="o">;</span>
            <span class="nc">Query</span><span class="o">&lt;</span><span class="nc">Student</span><span class="o">&gt;</span> <span class="n">upit2</span> <span class="o">=</span> 
                    <span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="n">hql</span><span class="o">,</span> <span class="nc">Student</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

            <span class="c1">// Spoljasnja petlja: ispisivanje studijskih programa</span>
            <span class="k">for</span> <span class="o">(</span><span class="nc">StudijskiProgram</span> <span class="n">studijskiProgram</span> <span class="o">:</span> <span class="n">studijskiProgrami</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">String</span> <span class="n">naziv</span> <span class="o">=</span> <span class="n">studijskiProgram</span><span class="o">.</span><span class="na">getNaziv</span><span class="o">().</span><span class="na">trim</span><span class="o">();</span>
                <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">studijskiProgram</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>

                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\n\nSTUDISJKI PROGRAM: "</span> <span class="o">+</span> <span class="n">naziv</span><span class="o">);</span>

                <span class="c1">// Postavljanje vrednosti parametarske oznake za unutrasnju</span>
                <span class="c1">// petlju</span>
                <span class="n">upit2</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
                <span class="n">upit2</span><span class="o">.</span><span class="na">setMaxResults</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span> <span class="c1">// Da dohvatimo najvise 5 studenata</span>

                <span class="c1">// Dohvatanje studenata za tekuci studijski program</span>
                <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Student</span><span class="o">&gt;</span> <span class="n">studenti</span> <span class="o">=</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">checkedList</span><span class="o">(</span><span class="n">upit2</span><span class="o">.</span><span class="na">list</span><span class="o">(),</span> <span class="nc">Student</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

                <span class="c1">// Unutrasnja petlja: ispisivanje studenata na studijskom programu</span>
                <span class="k">for</span> <span class="o">(</span><span class="nc">Student</span> <span class="n">student</span> <span class="o">:</span> <span class="n">studenti</span><span class="o">)</span> <span class="o">{</span>
                    <span class="kt">int</span> <span class="n">indeks</span> <span class="o">=</span> <span class="n">student</span><span class="o">.</span><span class="na">getIndeks</span><span class="o">();</span>
                    <span class="nc">String</span> <span class="n">ime</span> <span class="o">=</span> <span class="n">student</span><span class="o">.</span><span class="na">getIme</span><span class="o">().</span><span class="na">trim</span><span class="o">();</span>
                    <span class="nc">String</span> <span class="n">prezime</span> <span class="o">=</span> <span class="n">student</span><span class="o">.</span><span class="na">getPrezime</span><span class="o">().</span><span class="na">trim</span><span class="o">();</span>
                    <span class="kt">double</span> <span class="n">prosek</span> <span class="o">=</span> <span class="n">student</span><span class="o">.</span><span class="na">prosek</span><span class="o">();</span>

                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Student: "</span> <span class="o">+</span> <span class="n">indeks</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">ime</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">prezime</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">prosek</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="no">TR</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Postoji problem sa izlistavanjem studenata na studijskim programima! Ponistavanje transakcije!"</span><span class="o">);</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="k">if</span> <span class="o">(</span><span class="no">TR</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="no">TR</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="c1">// Za vezbu: razmisliti kako je moguce uraditi ovaj zadatak</span>
        <span class="c1">// bez koriscenja ugnezdjenih kursora</span>
        <span class="c1">// (tj. bez koriscenja upita koji pronalazi studente za zadati id studijskog programa)</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<h2 id="113-zadaci-za-vežbu">11.3 Zadaci za vežbu</h2>

<div class="ui stacked segment">
  <p><strong>Zadatak 11.4</strong>: Napisati Java aplikaciju koja korišćenjem biblioteke Hibernate za svaki studijski program na osnovnim akademskim studijama izdvaja listu obaveznih predmeta. Prvo ispisati sve podatke o studijskom programu, a zatim oznaku, naziv i broj ESPB bodova svih obaveznih predmeta za taj studijski program.</p>
</div>

<div class="ui stacked segment">
  <p><strong>Zadatak 11.5</strong>: Napisati Java aplikaciju koja korišćenjem biblioteke Hibernate za svaki predmet ispisuje oznaku  i naziv, a zatim i spisak studenata koji su upisali taj predmet u školskoj godini koja se unosi sa standardnog ulaza. Rezultat urediti prema prezimenu i imenu studenta rastuće.</p>
</div>

<div class="ui stacked segment">
  <p><strong>Zadatak 11.6</strong>: Napisati Java aplikaciju koja korišćenjem biblioteke Hibernate za svaki studijski program koji je u poslednjih 10 godina upisalo više od 30 studenata izdvajaju podaci o najmlađem studentu koji je upisao taj studijski program. Za najmlađeg studenta po studijskom programu izdvojiti naziv studijskog programa koji studira, indeks, ime i prezime studenta, datum upisa na fakultet, broj položenih predmeta i prosečnu ocenu zaokruženu na 2 decimale. Rezultat urediti prema nazivu studijskog programa.</p>
</div>

        </div>
    </div>

    <script>
        $('#pageSticky').sticky({
            context: '#pageContent'
        });

        $('#pageSticky').click(function () {
            $('#sideMenu').sidebar('toggle');
        });
    </script>
</body>

</html>