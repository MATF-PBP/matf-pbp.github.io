<!DOCTYPE html>
<html lang="rs">
<head>
    <title>8. Osnovni koncepti programiranja Java/SQL aplikacija sa dinamičkim SQL naredbama (JDBC) | Programiranje baza podataka</title>
    <meta charset="utf-8">

    <link rel="stylesheet" type="text/css" href="/resources/semantic/semantic.min.css">
    <script src="/resources/jquery/jquery-3.5.1.min.js"></script>
    <script src="/resources/semantic/semantic.min.js"></script>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <script src="https://semantic-ui.com/javascript/library/highlight.min.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
        $(document).ready(() => {
            $("table").addClass('ui celled table');
        });
    </script>
</head>

<body>
    <div class="ui sticky black big launch right attached fixed button" id="pageSticky">
        <i class="content icon"></i>
        <span class="text">Prikaži sadržaj</span>
    </div>

    <div class="ui sidebar vertical menu" id="sideMenu">
        <div class="item">
            <h3>Sadržaj</h3>
        </div>
        <a class="item" href="/vezbe/predgovor">Predgovor</a>
        <a class="item" href="/vezbe/poglavlja/1">1. Uvod u programiranje baza podataka</a>
        <a class="item" href="/vezbe/poglavlja/2">2. Osnovni koncepti programiranja C/SQL aplikacija</a>
        <a class="item" href="/vezbe/poglavlja/3">3. Programiranje korišćenjem kursora</a>
        <a class="item" href="/vezbe/poglavlja/4">4. Aplikacije sa dinamičkim SQL naredbama</a>
        <a class="item" href="/vezbe/poglavlja/5">5. Implementiranje transakcija</a>
        <a class="item" href="/vezbe/poglavlja/6">6. Aplikacije u višekorisničkom okruženju</a>
        <a class="item" href="/vezbe/poglavlja/7">7. Povezivanje aplikacija na više baza podataka</a>
        <a class="item" href="/vezbe/poglavlja/8">8. Osnovni koncepti programiranja Java/SQL aplikacija sa
            dinamičkim SQL naredbama (JDBC)</a>
        <a class="item" href="/vezbe/poglavlja/9">9. Napredne tehnike razvijanja Java/SQL aplikacija</a>
        <a class="item" href="/vezbe/poglavlja/10">10. Uvod u razvojno okruženje Hibernate</a>
        <a class="item" href="/vezbe/poglavlja/11">11. Napredna objektno-relaciona preslikavanja</a>
        <a class="item" href="/vezbe/poglavlja/12">12. Napredno kreiranje upita pomoću JPA Criteria API</a>
        <a class="item" href="/vezbe/poglavlja/13">13. Programiranje SQL rutina</a>
        <a class="item" href="/vezbe/poglavlja/14">14. Korisnički-definisane funkcije</a>
        <a class="item" href="/vezbe/poglavlja/15">15. Ugrađene procedure</a>
        <a class="item" href="/vezbe/poglavlja/16">16. Okidači</a>
    </div>

    <div class="ui justified container">
        <img class="ui centered small image" src="/resources/matf-srb.png">
        <header class="ui center aligned block header">
            <h1><a href="/">Programiranje baza podataka</a></h1>
        </header>

        <div class="ui divider"></div>

        <div id="pageContent">
            <h2>8. Osnovni koncepti programiranja Java/SQL aplikacija sa dinamičkim SQL naredbama (JDBC)</h2>


<div class="ui warning message">
    <div class="header">
        Ova stranica je pod konstrukcijom!
    </div>
    Ako pronađete grešku ili propust, molimo Vas da nam skrenete pažnju otvaranjem primedbe na <a href="https://github.com/MATF-PBP/matf-pbp.github.io"><i class="github icon"></i>zvaničnom GitHub repozitorijumu</a>.
</div>


<p>Java Database Connectivity (JDBC) predstavlja Java interfejs za programiranje aplikacija (API) koji standardizuje
načine za pristup i upravljanje bazama podataka. JDBC kod je jednostavno portabilizan između nekoliko
RSUBP proizvođača. Jedina promena u kodu koja se očekuje kada se JDBC kod portuje za neki drugi RSUBP
u odnosu na onaj za koji je prvobitno napisan jeste koji JDBC drajver se učitava i niska za konekciju na bazu 
podataka. JDBC koristi isključivo dinamičko izvršavanje SQL naredbi i veoma je popularan u praksi.</p>

<p>Pre nego što se izvršavaju SQL naredbe u bilo kom JDBC programu, aplikacija se mora povezati na bazu podataka.</p>

<p><img src="/vezbe/poglavlja/8/Slike/jdbc.png" alt="" /></p>

<p>Iako postoji nekoliko tipova JDBC drajvera kao što su tipovi 1, 2, 3 i 4, tipovi 1 i 3 nisu često korišćeni,
i Db2 podrška za ove tipove je uklonjena iz novijih verzija ovog SUBP. Za tip 2 postoje dva drajvera, kao što ćemo videti,
ali jedan od njih je takođe zastareo, te bi ga trebalo izbegavati.</p>

<p>Kao što je vidljivo iz naredne tabele, tipovi 2 i 4 JDBC drajvera su podržani Db2 SUBP. Tip 2 drajver zahteva 
instalaciju Db2 klijenta, s obzirom da se on koristi kako bi drajver kreirao komunikacioni kanal ka bazi podataka.
Sa druge strane, tip 4 je čist Java klijent, te nije potrebno instalirati Db2 klijent, ali sam drajver mora biti
instaliran na mašini gde se JDBC aplikacija pokreče.</p>

<table>
  <thead>
    <tr>
      <th>Tip drajvera</th>
      <th>Ime drajvera</th>
      <th>Datoteka</th>
      <th>Podržava</th>
      <th>Najmanja verzija Java SDK</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Tip 2</td>
      <td>DB2 JDBC Type 2 Driver for Linux, UNIX® and Windows (Deprecated)</td>
      <td><code class="language-plaintext highlighter-rouge">db2java.zip</code></td>
      <td>JDBC 1.2, JDBC 2.0</td>
      <td>1.4.2</td>
    </tr>
    <tr>
      <td>Tip 2, Tip 4</td>
      <td>IBM Data Server Driver for JDBC and SQLJ</td>
      <td><code class="language-plaintext highlighter-rouge">db2jcc.jar</code> i <code class="language-plaintext highlighter-rouge">sqlj.zip</code></td>
      <td>JDBC 3.0 saglasni</td>
      <td>1.4.2</td>
    </tr>
    <tr>
      <td>Tip 2, Tip 4</td>
      <td>IBM Data Server Driver for JDBC and SQLJ</td>
      <td><code class="language-plaintext highlighter-rouge">db2jcc4.jar</code> i <code class="language-plaintext highlighter-rouge">sqlj4.zip</code></td>
      <td>JDBC 4.0 i ranije</td>
      <td>6</td>
    </tr>
  </tbody>
</table>

<p>Kao što je pomenuto ranije, a takođe je prikazano u tabeli iznad, JDBC drajver tipa 2 je dostupan u dva različita
drajvera. Ipak, Db2 JDBC Type 2 Driver for Linux, UNIX and Windows, čija je implementacija data datotekom <code class="language-plaintext highlighter-rouge">db2java.zip</code> je zastareo.</p>

<p>Kada se instalira Db2 server, Db2 klijent ili IBM Data Server Driver za JDBC i SQLJ, tj. datoteke <code class="language-plaintext highlighter-rouge">db2jcc.jar</code> i <code class="language-plaintext highlighter-rouge">sqlj.zip</code> 
koje su saglasne sa JDBC 3.0 automatski su dodate u “classpath”.</p>

<h2 id="81-kreiranje-konekcije">8.1 Kreiranje konekcije</h2>

<p>Kolekcija ka bazi podataka se može dobiti korišćenjem klase <code class="language-plaintext highlighter-rouge">DriverManager</code> iz <code class="language-plaintext highlighter-rouge">java.sql</code> paketa.</p>

<p>Paket <code class="language-plaintext highlighter-rouge">java.sql</code> definiše klase i interfejse koji su neophodni kako bi JDBC program pristupio
podacima koji su skladišteni u relacionim bazama podataka. Ovaj API se može koristiti za 
povezivanje na relacionu bazu podataka i upravljanje podacima (čitanje, unos, ažuriranje, brisanje i dr.)
koji su skladišteni u formi tabela prema SQL standardu. Interfejsi koji su definisani u ovom paketu
implementirani su u klasa odgovarajućih drajvera i njihova definicija se može razlikovati između
proizvođaca.</p>

<p>Pre ostvarivanja konekcije, potrebno je učitati klase iz drajvera i registrovati ih za upotrebu korišćenjem klase
<code class="language-plaintext highlighter-rouge">DriverManager</code>. Proizvoljan broj drajvera se može učitati u registrovati klasom <code class="language-plaintext highlighter-rouge">DriverManager</code> korišćenjem metoda <code class="language-plaintext highlighter-rouge">forName</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">ProgramName</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.ibm.db2.jcc.DB2Driver"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Java podržava poseban blok, nazvan statički blok (koji se takođe naziva statička klauzula) 
koji se može koristiti za statičke inicijalizacije klase. Ovaj kod unutar statičkog bloka 
se izvršava samo jednom: prvi put kada napravite objekat te klase ili prvi put kada 
pristupite statičkom članu te klase (čak i ako nikada ne napravite objekat te klase). 
Koristićemo statičke blokove u našim programima za učitavanje i registraciju DB2 JDBC drajvera, 
kao što je prikazano u gornjem primeru koda.</p>

<p>Metod <code class="language-plaintext highlighter-rouge">forName</code> kao argument očekuje nisku čija vrednost je naziv paketa koji implementira
interfejse definisane paketom <code class="language-plaintext highlighter-rouge">java.sql</code>.</p>

<p>Konekcija ka bazi podataka se može ostvariti pozivom metoda <code class="language-plaintext highlighter-rouge">getConnection</code> klase <code class="language-plaintext highlighter-rouge">DriverManager</code>. 
Ovaj metod prihvata nisku (URL) kao ulaz, koji sadrži informacije potrebne za povezivanje sa bazom podataka. 
Metod vraca objekat interfejsa <code class="language-plaintext highlighter-rouge">Connection</code>, koji se može koristiti za upravljanje konekcijom ka bazi podataka. 
Tipičan format URL-a za drajver tipa 4 je:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jdbc:db2://&lt;naziv servera&gt;:&lt;broj porta&gt;/&lt;ime baze podataka&gt;
</code></pre></div></div>

<p>Konekcija ka bazi podataka se raskida pozivom metoda <code class="language-plaintext highlighter-rouge">close</code> nad objektom interfejsa <code class="language-plaintext highlighter-rouge">Connection</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argv</span><span class="o">[])</span> <span class="o">{</span>
    <span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:db2://localhost:50000/stud2020"</span><span class="o">;</span>
    
    <span class="c1">// Povezivanje na bazu podataka</span>
    <span class="n">con</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">"student"</span><span class="o">,</span> <span class="s">"abcdef"</span><span class="o">);</span>

    <span class="c1">// Kod programa...</span>

    <span class="c1">// Raskidanje konekcije sa bazom podataka</span>
    <span class="n">con</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="82-obrada-sql-grešaka">8.2 Obrada SQL grešaka</h2>

<p>Kao što znamo iz ranijih poglavlja, naredbe za povezivanje i raskidanje konekcije
(kao i druge SQL naredbe), mogu proizvesti SQL greške. U JDBC aplikacijama,
kao i u svim drugim Java aplikacijama, obrada grešaka se vrši pomoću izuzetaka i
<code class="language-plaintext highlighter-rouge">try-catch</code> blokovima. JDBC aplikacija ispaljuje objekat klase <code class="language-plaintext highlighter-rouge">SQLException</code> svaki put
kada dođe do SQL greške ili <code class="language-plaintext highlighter-rouge">SQLWarning</code> svaki put kada dođe do SQL upozorenja
prilikom izvršavanja SQL naredbi. Takođe, svi metodi JDBC API-ja koji mogu dovesti
do SQL grešaka u svom potpisu sadrže klauzulu <code class="language-plaintext highlighter-rouge">throws SQLException</code>, što znači
da je pozive ovakvih metoda neophodno obuhvatiti nekim <code class="language-plaintext highlighter-rouge">try-catch</code> blokom u programu.</p>

<p>Objekat klase <code class="language-plaintext highlighter-rouge">SQLException</code> sadrži razne korisne informacije o SQL grešci koja je
podignuta u SUBP, a neke od njih su navedene u narednoj tabeli:</p>

<table>
  <thead>
    <tr>
      <th>Informacija</th>
      <th>Opis</th>
      <th>Metod koji se koristi za dohvatanje informacije</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Poruka</td>
      <td>Tekstualna reprezentacija SQL greške.</td>
      <td><code class="language-plaintext highlighter-rouge">getMessage</code></td>
    </tr>
    <tr>
      <td>SQLSTATE</td>
      <td>SQLState niska.</td>
      <td><code class="language-plaintext highlighter-rouge">getSQLState</code></td>
    </tr>
    <tr>
      <td>SQLCODE</td>
      <td>Celobrojna vrednost koja indikuje vrstu greške koja je podignuta u SUBP.</td>
      <td><code class="language-plaintext highlighter-rouge">getErrorCode</code></td>
    </tr>
  </tbody>
</table>

<p>Pored navedenih informacija, Db2 JCC drajver pruža dodatni interfejs <code class="language-plaintext highlighter-rouge">com.ibm.db2.jcc.DB2Diagnosable</code>. 
Ovaj interfejs daje više informacija u vezi sa greškom koja se dogodila prilikom pristupanja Db2 bazi podataka.</p>

<p>Primer obrade <code class="language-plaintext highlighter-rouge">SQLExpection</code> izuzetaka dat je narednim kodom:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

<span class="k">try</span> <span class="o">{</span>
    <span class="c1">// Povezivanje na bazu podataka</span>
    <span class="n">con</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">"student"</span><span class="o">,</span> <span class="s">"abcdef"</span><span class="o">);</span>

    <span class="c1">// Kod programa...</span>

    <span class="c1">// Raskidanje konekcije sa bazom podataka</span>
    <span class="n">con</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
        <span class="s">"SQLCODE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span>
        <span class="s">"SQLSTATE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getSQLState</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span>
        <span class="s">"PORUKA: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>

    <span class="c1">// Treba da zatvorimo konekciju ka bazi podataka i u slučaju greške.</span>
    <span class="c1">// S obzirom da metod close takođe može ispaliti SQLException,</span>
    <span class="c1">// potrebno ga je uhvatiti, ali biramo da ga ne obrađujemo dalje.</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">con</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">con</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e2</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

    <span class="c1">// Isto kao u catch bloku iznad.</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">con</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">con</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e2</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>S obzirom da objekti interfejsa <code class="language-plaintext highlighter-rouge">Connection</code> implementiraju interfejs <code class="language-plaintext highlighter-rouge">AutoCloseable</code>, možemo koristiti i <code class="language-plaintext highlighter-rouge">try-with-resources</code> naredbu u okviru koje ćemo otvoriti konekciju. Naredba se stara o otvorenim resursima i na kraju ih automatski zatvara.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argv</span><span class="o">[])</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:db2://localhost:50000/stud2020"</span><span class="o">;</span>

    <span class="k">try</span> <span class="o">(</span>
        <span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">"student"</span><span class="o">,</span> <span class="s">"abcdef"</span><span class="o">);</span>
    <span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Kod programa...</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
            <span class="s">"SQLCODE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span>
            <span class="s">"SQLSTATE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getSQLState</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span>
            <span class="s">"PORUKA: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>U slučaju da se više izuzetaka tipa <code class="language-plaintext highlighter-rouge">SQLExceptions</code> ispali, oni su ulančani.
Informacija o narednom izuzetku se može dobiti pozivom metoda <code class="language-plaintext highlighter-rouge">getNextException</code> nad
trenutnim <code class="language-plaintext highlighter-rouge">SQLException</code> objektom koji se obrađuje. Ovaj metod vraća <code class="language-plaintext highlighter-rouge">null</code> ako je
tekući <code class="language-plaintext highlighter-rouge">SQLException</code> objekat poslednji u lancu izuzetaka. Zbog toga se može
koristiti <code class="language-plaintext highlighter-rouge">while</code> petlja u <code class="language-plaintext highlighter-rouge">catch</code> bloku programa kako bi se obradili <code class="language-plaintext highlighter-rouge">SQLException</code> objekti
jedan-po-jedan.</p>

<h2 id="83-upravljanje-podacima">8.3 Upravljanje podacima</h2>

<p>Nakon ostvarivanja konekcije ka bazi podataka, podaci se mogu dohvatiti, unositi, ažurirati
ili obrisati iz relacionih tabela korišćenjem SQL naredbi. JDBC drajver implementira dva 
interfejsa, <code class="language-plaintext highlighter-rouge">Statement</code> i <code class="language-plaintext highlighter-rouge">PreparedStatement</code> za ove potrebe. Objekti jednog od ova dva interfejsa
su neophodni kako bi se SQL naredbe izvršile nad bazom podataka. U nastavku govorimo o 
slučajevima upotrebe ovih interfejsa, ali pre toga ćemo reći nešto o tipovima podataka.</p>

<h3 id="831-tipovi-podataka">8.3.1 Tipovi podataka</h3>

<p>Da bismo napisali efikasne JDBC programe, potrebno je da koristimo najbolja preslikavanja između 
Java tipova podataka i tipova kolona tabela.</p>

<p>Naredna tabela sumira mapiranja Db2 tipova podataka u Java tipove podataka za familiju metoda 
<code class="language-plaintext highlighter-rouge">ResultSet.getXXX</code> u JDBC programima. Ova tabela ne navodi tipove Java numeričkih omotača, 
koji se dohvataju pomoću metoda <code class="language-plaintext highlighter-rouge">ResultSet.getObject</code>.</p>

<table>
  <thead>
    <tr>
      <th>SQL tip podataka</th>
      <th>Preporučeni Java tip podataka</th>
      <th>Drugi podržani Java tipovi podataka</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>SMALLINT</td>
      <td>short</td>
      <td>byte, int, long, float, double, java.math.BigDecimal, boolean, java.lang.String</td>
    </tr>
    <tr>
      <td>INTEGER</td>
      <td>int</td>
      <td>short, byte, long, float, double, java.math.BigDecimal, boolean, java.lang.String</td>
    </tr>
    <tr>
      <td>BIGINT</td>
      <td>long</td>
      <td>int, short, byte, float, double, java.math.BigDecimal, boolean, java.lang.String</td>
    </tr>
    <tr>
      <td>DECIMAL(p,s) or NUMERIC(p,s)</td>
      <td>java.math.BigDecimal</td>
      <td>long, int, short, byte, float, double, boolean, java.lang.String</td>
    </tr>
    <tr>
      <td>DECFLOAT(n)</td>
      <td>java.math.BigDecimal</td>
      <td>long, int, short, byte, float, double, java.math.BigDecimal, boolean, java.lang.String</td>
    </tr>
    <tr>
      <td>REAL</td>
      <td>float</td>
      <td>long, int, short, byte, double, java.math.BigDecimal, boolean, java.lang.String</td>
    </tr>
    <tr>
      <td>DOUBLE</td>
      <td>double</td>
      <td>long, int, short, byte, float, java.math.BigDecimal, boolean, java.lang.String</td>
    </tr>
    <tr>
      <td>CHAR(n)</td>
      <td>java.lang.String</td>
      <td>long, int, short, byte, float, double, java.math.BigDecimal, boolean, java.sql.Date, java.sql.Time, java.sql.Timestamp, java.io.InputStream, java.io.Reader</td>
    </tr>
    <tr>
      <td>VARCHAR(n)</td>
      <td>java.lang.String</td>
      <td>long, int, short, byte, float, double, java.math.BigDecimal, boolean, java.sql.Date, java.sql.Time, java.sql.Timestamp, java.io.InputStream, java.io.Reader</td>
    </tr>
    <tr>
      <td>DATE</td>
      <td>java.sql.Date</td>
      <td>java.sql.String, java.sql.Timestamp</td>
    </tr>
    <tr>
      <td>TIME</td>
      <td>java.sql.Time</td>
      <td>java.sql.String, java.sql.Timestamp</td>
    </tr>
    <tr>
      <td>TIMESTAMP, TIMESTAMP(p), TIMESTAMP WITH TIME ZONE, TIMESTAMP(p) WITH TIME ZONE</td>
      <td>java.sql.Timestamp</td>
      <td>java.sql.String, java.sql.Date, java.sql.Time, java.sql.Timestamp</td>
    </tr>
  </tbody>
</table>

<p>Naredna tabela sumira preslikavanja Java tipova podataka u Db2 tipove podataka za familije metoda <code class="language-plaintext highlighter-rouge">PreparedStatement.setXXX</code> i <code class="language-plaintext highlighter-rouge">ResultSet.updateXXX</code> u JDBC programima. Kada je navedeno više od jednog Java tipa podataka, prvi tip podataka je preporučeni tip podataka.</p>

<table>
  <thead>
    <tr>
      <th>Java tip podataka</th>
      <th>Db2 tip podataka</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>short, java.lang.Short</td>
      <td>SMALLINT</td>
    </tr>
    <tr>
      <td>boolean, byte, java.lang.Boolean, java.lang.Byte</td>
      <td>SMALLINT</td>
    </tr>
    <tr>
      <td>int, java.lang.Integer</td>
      <td>INTEGER</td>
    </tr>
    <tr>
      <td>long, java.lang.Long</td>
      <td>BIGINT</td>
    </tr>
    <tr>
      <td>java.math.BigInteger</td>
      <td>BIGINT</td>
    </tr>
    <tr>
      <td>java.math.BigInteger</td>
      <td>CHAR(n)</td>
    </tr>
    <tr>
      <td>float, java.lang.Float</td>
      <td>REAL</td>
    </tr>
    <tr>
      <td>double, java.lang.Double</td>
      <td>DOUBLE</td>
    </tr>
    <tr>
      <td>java.math.BigDecimal</td>
      <td>DECIMAL(p,s)</td>
    </tr>
    <tr>
      <td>java.math.BigDecimal</td>
      <td>DECFLOAT(n)</td>
    </tr>
    <tr>
      <td>java.lang.String</td>
      <td>CHAR(n)</td>
    </tr>
    <tr>
      <td>java.lang.String</td>
      <td>VARCHAR(n)</td>
    </tr>
    <tr>
      <td>java.sql.Date</td>
      <td>DATE</td>
    </tr>
    <tr>
      <td>java.sql.Time</td>
      <td>TIME</td>
    </tr>
    <tr>
      <td>java.sql.Timestamp</td>
      <td>TIMESTAMP, TIMESTAMP(p), TIMESTAMP WITH TIME ZONE, TIMESTAMP(p) WITH TIME ZONE</td>
    </tr>
    <tr>
      <td>java.util.Date</td>
      <td>CHAR(n)</td>
    </tr>
    <tr>
      <td>java.util.Date</td>
      <td>VARCHAR(n)</td>
    </tr>
    <tr>
      <td>java.util.Date</td>
      <td>DATE</td>
    </tr>
    <tr>
      <td>java.util.Date</td>
      <td>TIME</td>
    </tr>
    <tr>
      <td>java.util.Date</td>
      <td>TIMESTAMP, TIMESTAMP(p), TIMESTAMP WITH TIME ZONE, TIMESTAMP(p) WITH TIME ZONE</td>
    </tr>
  </tbody>
</table>

<h3 id="832-interfejs-statement">8.3.2 Interfejs <code class="language-plaintext highlighter-rouge">Statement</code></h3>

<p>Objekti interfejsa <code class="language-plaintext highlighter-rouge">Statement</code> mogu se iskoristiti za izvršavanje SQL naredbi koji ne 
sadrže parametarske oznake. Ovi objekti se kreiraju pozivom metoda <code class="language-plaintext highlighter-rouge">createStatement</code> nad 
objektima interfejsa <code class="language-plaintext highlighter-rouge">Connection</code>. Moguće je kreirati proizvoljan broj objekata <code class="language-plaintext highlighter-rouge">Statement</code>
nad jednim objektom <code class="language-plaintext highlighter-rouge">Connection</code> i svi ti objekti će biti vezani za konekciju koja je
opisana istim objektom <code class="language-plaintext highlighter-rouge">Connection</code> (drugim rečima, sve te SQL naredbe će biti izvršene
nad istom bazom podataka).</p>

<p>Interfejs <code class="language-plaintext highlighter-rouge">Statement</code> definiše dve vrste metoda za izvršavanje SQL naredbi. Oba metoda 
kao prvi parametar očekuju nisku koja sadrži validnu SQL naredbu. U zavisnosti od vrste 
SQL naredbe, koriste se naredni metodi:</p>

<ul>
  <li>Metod <code class="language-plaintext highlighter-rouge">executeQuery</code> se koristi kada se kao rezultat izvršavanja SQL naredbe očekuje kursor (na primer, prilikom izvršavanja naredbe <code class="language-plaintext highlighter-rouge">SELECT</code>). Metod <code class="language-plaintext highlighter-rouge">executeQuery</code> vraća objekat interfejsa <code class="language-plaintext highlighter-rouge">ResultSet</code>, koji predstavlja skup rezultata koji se vraća naredbom <code class="language-plaintext highlighter-rouge">SELECT</code>. Objekti interfejsa <code class="language-plaintext highlighter-rouge">ResultSet</code> mogu se koristiti za prolazak kroz redove rezultujuće tabele.</li>
  <li>Metod <code class="language-plaintext highlighter-rouge">executeUpdate</code> se koristi za ažuriranje podataka (na primer, <code class="language-plaintext highlighter-rouge">INSERT</code>, <code class="language-plaintext highlighter-rouge">UPDATE</code>, <code class="language-plaintext highlighter-rouge">DELETE</code> i <code class="language-plaintext highlighter-rouge">MERGE</code> naredbama). Metod <code class="language-plaintext highlighter-rouge">executeUpdate</code> vraća celobrojnu vrednost, koja indikuje broj redova koji je unet, ažuriran ili obrisan u bazi podataka, u zavisnosti od tipa SQL naredbi. Ovaj metod se koristi i u slučaju izvršavanja DDL naredbi, kao što su <code class="language-plaintext highlighter-rouge">CREATE</code>, <code class="language-plaintext highlighter-rouge">ALTER</code>, <code class="language-plaintext highlighter-rouge">DROP</code>, <code class="language-plaintext highlighter-rouge">GRANT</code>, <code class="language-plaintext highlighter-rouge">REVOKE</code> i dr.</li>
</ul>

<p>U nastavku dajemo dve procedure koje opisuju upotrebu opisanih metoda.</p>

<div class="ui piled purple segment">
  <h4 class="ui header">Procedura: Obrada kursora u JDBC aplikacijama (slučaj bez parametarskih oznaka)</h4>

  <p>Da bismo iterirali kroz rezultujuću tabelu naredbe <code class="language-plaintext highlighter-rouge">SELECT</code> koja ne sadrži parametarske oznake, potrebno je da ispratimo naredne korake:</p>

  <ol>
    <li>Napisati SQL naredbu kao nisku.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"SELECT ..."</span><span class="o">;</span>
</code></pre></div>      </div>
    </li>
    <li>Kreirati objekat interfejsa <code class="language-plaintext highlighter-rouge">Statement</code> pozivom metoda <code class="language-plaintext highlighter-rouge">Connection.createStatement()</code>.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>
</code></pre></div>      </div>
    </li>
    <li>Kreirati objekat interfejsa <code class="language-plaintext highlighter-rouge">ResultSet</code> pozivom metoda <code class="language-plaintext highlighter-rouge">Statement.executeQuery(String sql)</code>.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ResultSet</span> <span class="n">kursor</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
</code></pre></div>      </div>
    </li>
    <li>Pozicionirati se na red koji je potrebno pročitati metodima za prolazak kroz kursor. Na primer:
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="o">(</span><span class="n">kursor</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
 <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div>      </div>
    </li>
    <li>Pozvati odgovarajući metod nad objektom interfejsa <code class="language-plaintext highlighter-rouge">ResultSet</code> iz familije metoda <code class="language-plaintext highlighter-rouge">ResultSet.getXXX(int columnIndex)</code> za dohvatanje vrednosti iz kolone rezultujuće tabele sa indeksom <code class="language-plaintext highlighter-rouge">columnIndex</code>. Na primer:
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="o">(</span><span class="n">kursor</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
 <span class="kt">int</span> <span class="n">indeks</span> <span class="o">=</span> <span class="n">kursor</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
 <span class="nc">String</span> <span class="n">ime</span> <span class="o">=</span> <span class="n">kursor</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
 <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div>      </div>
      <ol>
        <li>Eventualno proveriti da li je dohvaćena <code class="language-plaintext highlighter-rouge">NULL</code> vrednost (videti <a href="#834-rukovanje-nedostajućim-vrednostima">sekciju o nedostajućim vrednostima</a>).</li>
      </ol>
    </li>
    <li>Nakon svih iteracija, pozvati metod <code class="language-plaintext highlighter-rouge">kursor.close()</code> radi zatvaranja kursora.</li>
    <li>Nakon zatvaranja kursora, pozvati metod <code class="language-plaintext highlighter-rouge">stmt.close()</code> radi zatvaranja objekta naredbe.</li>
  </ol>

</div>

<div class="ui piled purple segment">
  <h4 class="ui header">Procedura: Obrada ažurirajućih SQL naredbi u JDBC aplikacijama (slučaj bez parametarskih oznaka)</h4>

  <p>Da bismo izmenili podatke u bazi podataka nekom SQL naredbom bez parametarskih oznaka, potrebno je da ispratimo naredne korake:</p>

  <ol>
    <li>Napisati SQL naredbu kao nisku.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"DELETE ..."</span><span class="o">;</span>
</code></pre></div>      </div>
    </li>
    <li>Kreirati objekat interfejsa <code class="language-plaintext highlighter-rouge">Statement</code> pozivom metoda <code class="language-plaintext highlighter-rouge">Connection.createStatement()</code>.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>
</code></pre></div>      </div>
    </li>
    <li>Pozvati metod <code class="language-plaintext highlighter-rouge">stmt.executeUpdate(String sql)</code>.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">brojRedova</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
</code></pre></div>      </div>
    </li>
    <li>Pozvati metod <code class="language-plaintext highlighter-rouge">stmt.close()</code> radi zatvaranja objekta naredbe.</li>
  </ol>

</div>

<p>Naredni zadaci ilustruju opisane procedure na konkretnim primerima.</p>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.1</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički koji izlistava oznake i nazive svih predmeta koji imaju više od 20 ESPB bodova.</p>
</div>

<p>Rešenje:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_8/src/zadatak_8_1/Main.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_8_1</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.sql.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="c1">// Staticki blok koji sluzi za ucitavanje JDBC DB2 drajvera.</span>
    <span class="c1">// Izvrsava se kada se prvi put instancira objekat ove klase,</span>
    <span class="c1">// ili kada se prvi put pozove staticki metod.</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.ibm.db2.jcc.DB2Driver"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argv</span><span class="o">[])</span> <span class="o">{</span>
        <span class="c1">// URL za JDBC konekciju tipa 4</span>
        <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:db2://localhost:50000/stud2020"</span><span class="o">;</span>

        <span class="c1">// Objekat koji ce sadrzati konekciju</span>
        <span class="c1">// Kreiramo konekciju na bazi podataka zadatoj u promenljivoj url,</span>
        <span class="c1">// koriscenjem metoda DriverManager.getConnection.</span>
        <span class="c1">// Argumenti za korisnicko ime i lozinku su obavezni!</span>
        <span class="c1">// try-with-resources vodi racuna o otvorenim resursima</span>
        <span class="c1">// i zatvara ih na kraju try-catch bloka</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">"student"</span><span class="o">,</span> <span class="s">"abcdef"</span><span class="o">))</span> <span class="o">{</span>
            <span class="c1">// Kreiramo objekat naredbe (Statement)</span>
            <span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>

            <span class="c1">// SQL upit ili naredbu koju zelimo da izvrsimo</span>
            <span class="c1">// zapisujemo kao nisku &lt;-&gt; DINAMICKI SQL</span>
            <span class="nc">String</span> <span class="n">queryStr</span> <span class="o">=</span> 
                <span class="s">"SELECT OZNAKA, "</span> <span class="o">+</span> 
                <span class="s">"       NAZIV "</span> <span class="o">+</span> 
                <span class="s">"FROM   DA.PREDMET "</span> <span class="o">+</span> 
                <span class="s">"WHERE  ESPB &gt; 20"</span><span class="o">;</span>
            <span class="c1">// Za izvrsavanje upita koristimo Statement.executeQuery metod.</span>
            <span class="c1">// Ovaj metod vraca objekat klase ResultSet,</span>
            <span class="c1">// koji sadrzi rezultate upita (kursor).</span>
            <span class="nc">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">queryStr</span><span class="o">);</span>

            <span class="c1">// Ispisujemo zaglavlje</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"%-15s %-50S\n\n"</span><span class="o">,</span> <span class="s">"OZNAKA"</span><span class="o">,</span> <span class="s">"NAZIV"</span><span class="o">);</span>

            <span class="c1">// Metodom ResultSet.next pozicioniramo kursor na naredni red.</span>
            <span class="c1">// Ako vise nema redova, metod ce vratiti vrednost false.</span>
            <span class="c1">// Inace, vratice true, pa mozemo da ga koristimo kao uslov u petlji</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
                <span class="c1">// Izdvajamo podatke koriscenjem familije metoda</span>
                <span class="c1">// ResultSet.getXXX,</span>
                <span class="c1">// gde je XXX neki tip podataka,</span>
                <span class="c1">// a argument je broj kolone koja se dohvata iz projekcije</span>
                <span class="c1">// upita.</span>
                <span class="nc">String</span> <span class="n">oznaka</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
                <span class="nc">String</span> <span class="n">naziv</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>

                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"%-15s %-50S\n"</span><span class="o">,</span> <span class="n">oznaka</span><span class="o">.</span><span class="na">trim</span><span class="o">(),</span> <span class="n">naziv</span><span class="o">.</span><span class="na">trim</span><span class="o">());</span>
            <span class="o">}</span>

            <span class="c1">// Zatvaramo kursor</span>
            <span class="n">rs</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="c1">// Zatvaramo naredbu</span>
            <span class="n">stmt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="c1">// Obrada SQL gresaka</span>
        <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Ispisujemo sve informacije na standardni izlaz</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"SQLCODE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="s">"SQLSTATE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getSQLState</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span>
                    <span class="o">+</span> <span class="s">"PORUKA: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>

            <span class="c1">// Signaliziramo neuspesan zavrsetak programa</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="c1">// Obrada drugih gresaka</span>
        <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            
            <span class="c1">// Signaliziramo neuspesan zavrsetak programa</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.2</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički koji u tabelu <code class="language-plaintext highlighter-rouge">PREDMET</code> unosi podatak o predmetu čiji je identifikator 2001, oznaka Pred1, naziv Predmet 1 i nosi <code class="language-plaintext highlighter-rouge">5</code> ESPB bodova.</p>
</div>

<p>Rešenje:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_8/src/zadatak_8_2/Main.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_8_2</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.sql.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.ibm.db2.jcc.DB2Driver"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argv</span><span class="o">[])</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:db2://localhost:50000/stud2020"</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">"student"</span><span class="o">,</span> <span class="s">"abcdef"</span><span class="o">))</span> <span class="o">{</span>
            <span class="c1">// Zelimo da izvrsimo INSERT naredbu</span>
            <span class="c1">// u kojoj su sve informacije poznate.</span>
            <span class="c1">// To znaci da mozemo koristiti kombinaciju</span>
            <span class="c1">// interfejsa Statement i metoda executeUpdate().</span>
            <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> 
                <span class="s">"INSERT INTO DA.PREDMET "</span> <span class="o">+</span>
                <span class="s">"VALUES (2001, 'Pred1', 'Predmet 1', 5)"</span><span class="o">;</span>

            <span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Unosim podatke u tabelu PREDMET..."</span><span class="o">);</span>

            <span class="c1">// Metod executeUpdate() se koristi ne samo za azuriranje,</span>
            <span class="c1">// vec i za unos, brisanje, i slicne naredbe.</span>
            <span class="kt">int</span> <span class="n">insertCount</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Broj unetih redova: "</span> <span class="o">+</span> <span class="n">insertCount</span><span class="o">);</span>

            <span class="n">stmt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"SQLCODE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="s">"SQLSTATE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getSQLState</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span>
                    <span class="o">+</span> <span class="s">"PORUKA: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="833-interfejs-preparedstatement">8.3.3 Interfejs <code class="language-plaintext highlighter-rouge">PreparedStatement</code></h3>

<p>Objekti interfejsa <code class="language-plaintext highlighter-rouge">PreparedStatement</code> obavezno se koriste u slučaju kada SQL naredbe sadrže
parametarske oznake. <code class="language-plaintext highlighter-rouge">PreparedStatement</code> objekti se kreiraju pozivom metoda <code class="language-plaintext highlighter-rouge">prepareStatement</code> nad objektima <code class="language-plaintext highlighter-rouge">Connection</code>.
Za razliku od metoda <code class="language-plaintext highlighter-rouge">createStatement</code>, metod <code class="language-plaintext highlighter-rouge">prepareStatement</code> očekuje jedan parametar,
a to je niska koja predstavlja SQL naredbu sa parametarskim oznakama, za koju će biti izvršena priprema.
Pun potpis ovog metoda je:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">PreparedStatement</span> <span class="nf">prepareStatement</span><span class="o">(</span><span class="nc">String</span> <span class="n">sql</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span>
</code></pre></div></div>

<p>Postavljanje vrednosti parametarskim oznakama se vrši pozivom nekog metoda iz familije
<code class="language-plaintext highlighter-rouge">PreparedStatement.setXXX</code>, gde <code class="language-plaintext highlighter-rouge">XXX</code> označava tip parametarske oznake koja se postavlja.
Neki od primera <code class="language-plaintext highlighter-rouge">setXXX</code> metoda su:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">setInt</code>,</li>
  <li><code class="language-plaintext highlighter-rouge">setString</code>,</li>
  <li><code class="language-plaintext highlighter-rouge">setDouble</code>,</li>
  <li><code class="language-plaintext highlighter-rouge">setBytes</code>,</li>
  <li><code class="language-plaintext highlighter-rouge">setClob</code>,</li>
  <li><code class="language-plaintext highlighter-rouge">setBlob</code></li>
  <li>…</li>
</ul>

<p>Nakon postavljanja vrednosti parametara, SQL naredba se može izvršiti pozivom nekog
od već opisanih metoda <code class="language-plaintext highlighter-rouge">executeQuery</code> ili <code class="language-plaintext highlighter-rouge">executeUpdate</code>, zavisno od vrste SQL naredbe.
Za razliku od istoimenih metoda interfejsa <code class="language-plaintext highlighter-rouge">Statement</code>, ovi metodi se pozivaju bez prosleđivanja
SQL naredbe (s obzirom da smo naredbu već prosledili prilikom konstrukcije <code class="language-plaintext highlighter-rouge">PreparedStatement</code> objekta).</p>

<p>Naredne procedure opisuju korake neophodne za korišćenje interfejsa <code class="language-plaintext highlighter-rouge">PreparedStatement</code>.</p>

<div class="ui piled purple segment">
  <h4 class="ui header">Procedura: Obrada kursora u JDBC aplikacijama (slučaj sa parametarskim oznakama)</h4>

  <p>Da bismo iterirali kroz rezultujuću tabelu naredbe <code class="language-plaintext highlighter-rouge">SELECT</code> koja sadrži parametarske oznake, potrebno je da ispratimo naredne korake:</p>

  <ol>
    <li>Napisati SQL naredbu kao nisku.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"SELECT ... WHERE INDEKS = ? AND IME = ? ..."</span><span class="o">;</span>
</code></pre></div>      </div>
    </li>
    <li>Kreirati objekat interfejsa <code class="language-plaintext highlighter-rouge">PreparedStatement</code> pozivom metoda <code class="language-plaintext highlighter-rouge">Connection.prepareStatement(String sql)</code>.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">PreparedStatement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
</code></pre></div>      </div>
    </li>
    <li>Pozvati odgovarajući metod iz familije metoda <code class="language-plaintext highlighter-rouge">PreparedStatement.setXXX(int parameterIndex, XXX x)</code> 
za postavljanje vrednosti parametarske oznake u naredbi. Na primer:
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stmt</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">20200134</span><span class="o">);</span>
<span class="n">stmt</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="s">"Ivana"</span><span class="o">);</span>
</code></pre></div>      </div>
    </li>
    <li>Kreirati objekat interfejsa <code class="language-plaintext highlighter-rouge">ResultSet</code> pozivom metoda <code class="language-plaintext highlighter-rouge">PreparedStatement.executeQuery()</code>.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ResultSet</span> <span class="n">kursor</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
</code></pre></div>      </div>
    </li>
    <li>Pozicionirati se na red koji je potrebno pročitati metodima za prolazak kroz kursor. Na primer:
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="o">(</span><span class="n">kursor</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
 <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div>      </div>
    </li>
    <li>Pozvati odgovarajući metod iz familije metoda <code class="language-plaintext highlighter-rouge">ResultSet.getXXX(int columnIndex)</code> za dohvatanje vrednosti 
iz kolone rezultujuće tabele sa indeksom <code class="language-plaintext highlighter-rouge">columnIndex</code>. Na primer:
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="o">(</span><span class="n">kursor</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
 <span class="kt">int</span> <span class="n">indeks</span> <span class="o">=</span> <span class="n">kursor</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
 <span class="nc">String</span> <span class="n">ime</span> <span class="o">=</span> <span class="n">kursor</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
 <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div>      </div>
      <ol>
        <li>Eventualno proveriti da li je dohvaćena <code class="language-plaintext highlighter-rouge">NULL</code> vrednost (videti <a href="#834-rukovanje-nedostajućim-vrednostima">sekciju o nedostajućim vrednostima</a>).</li>
      </ol>
    </li>
    <li>Nakon svih iteracija, pozvati metod <code class="language-plaintext highlighter-rouge">kursor.close()</code> radi zatvaranja kursora.</li>
    <li>Nakon zatvaranja kursora, pozvati metod <code class="language-plaintext highlighter-rouge">stmt.close()</code> radi zatvaranja objekta naredbe.</li>
  </ol>

</div>

<div class="ui piled purple segment">
  <h4 class="ui header">Procedura: Obrada ažurirajućih SQL naredbi u JDBC aplikacijama (slučaj sa parametarskim oznakama)</h4>

  <p>Da bismo izmenili podatke u bazi podataka nekom SQL naredbom sa parametarskim oznakama, potrebno je da ispratimo naredne korake:</p>

  <ol>
    <li>Napisati SQL naredbu kao nisku.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"DELETE ... WHERE INDEKS = ? ..."</span><span class="o">;</span>
</code></pre></div>      </div>
    </li>
    <li>Kreirati objekat interfejsa <code class="language-plaintext highlighter-rouge">PreparedStatement</code> pozivom metoda <code class="language-plaintext highlighter-rouge">Connection.prepareStatement(String sql)</code>.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">PreparedStatement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
</code></pre></div>      </div>
    </li>
    <li>Pozvati odgovarajući metod iz familije metoda <code class="language-plaintext highlighter-rouge">PreparedStatement.setXXX(int parameterIndex, XXX x)</code> 
za postavljanje vrednosti parametarske oznake u naredbi. Na primer:
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stmt</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">20200134</span><span class="o">);</span>
</code></pre></div>      </div>
    </li>
    <li>Pozvati metod <code class="language-plaintext highlighter-rouge">stmt.executeUpdate()</code>.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">brojRedova</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
</code></pre></div>      </div>
    </li>
    <li>Pozvati metod <code class="language-plaintext highlighter-rouge">stmt.close()</code> radi zatvaranja objekta naredbe.</li>
  </ol>

</div>

<p>Naredni zadaci demonstriraju upotrebu interfejsa <code class="language-plaintext highlighter-rouge">PreparedStatement</code>.</p>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.3</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički koji učitava dva cela broja, X i Y, a zatim svim predmetima koji imaju X ESPB bodova, postavlja broj bodova na Y. Nakon toga ispisati broj ažuriranih redova.</p>
</div>

<p>Rešenje:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_8/src/zadatak_8_3/Main.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_8_3</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.sql.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.ibm.db2.jcc.DB2Driver"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argv</span><span class="o">[])</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:db2://localhost:50000/stud2020"</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">(</span>
                <span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">"student"</span><span class="o">,</span> <span class="s">"abcdef"</span><span class="o">);</span>
                <span class="nc">Scanner</span> <span class="n">ulaz</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">);</span>
            <span class="o">)</span> <span class="o">{</span>
            <span class="c1">// JDBC koristi iskljucivo dinamicke SQL naredbe,</span>
            <span class="c1">// tako da se u JDBC ne koriste maticne promenljive.</span>
            <span class="c1">// S obzirom da su vrednosti za bodove u klauzama SET i WHERE</span>
            <span class="c1">// nepoznate do faze izvrsavanja,</span>
            <span class="c1">// potrebno je da koristimo parametarske oznake na tim mestima.</span>
            <span class="nc">String</span> <span class="n">updateStr</span> <span class="o">=</span> 
                <span class="s">"UPDATE DA.PREDMET "</span> <span class="o">+</span> 
                <span class="s">"SET    ESPB = ? "</span> <span class="o">+</span> 
                <span class="s">"WHERE  ESPB = ?"</span><span class="o">;</span>
            <span class="c1">// Zbog toga moramo da koristimo interfejs PreparedStatement,</span>
            <span class="c1">// jer interfejs Statement ne radi sa parametarskim oznakama.</span>
            <span class="nc">PreparedStatement</span> <span class="n">pUpd</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">updateStr</span><span class="o">);</span>

            <span class="c1">// Postavljamo odgovarajuce vrednosti za parametarske oznake</span>
            <span class="c1">// na osnovu procitanih vrednosti sa standardnog ulaza.</span>
            <span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">;</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Unesite X:"</span><span class="o">);</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">ulaz</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Unesite Y:"</span><span class="o">);</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">ulaz</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
            
            <span class="c1">// Prvu parametarsku oznaku menjamo celim brojem y.</span>
            <span class="n">pUpd</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>

            <span class="c1">// Drugu parametarsku oznaku menjamo celim brojem x.</span>
            <span class="n">pUpd</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">x</span><span class="o">);</span>

            <span class="c1">// Izvrsavamo naredbu metodom executeUpdate() </span>
            <span class="c1">// koji vraca broj azuriranih redova.</span>
            <span class="kt">int</span> <span class="n">numRows</span> <span class="o">=</span> <span class="n">pUpd</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Broj azuriranih redova: "</span> <span class="o">+</span> <span class="n">numRows</span><span class="o">);</span>

            <span class="n">pUpd</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"SQLCODE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="s">"SQLSTATE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getSQLState</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span>
                    <span class="o">+</span> <span class="s">"PORUKA: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.4</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički koji sa standardnog ulaza učitava ceo broj N i izdvaja indeks, ime,
prezime i naziv studijskog programa svih studenata koji su položili tačno N predmeta, kao i spisak tih
predmeta (naziv i ocena).</p>
</div>

<p>Rešenje: S obzirom da je SQL upit koji se koristi u ovom zadatku nešto složeniji, da ga ne bismo zapisivali u Java kodu kao nisku, taj upit ćemo začuvati u datoteci <code class="language-plaintext highlighter-rouge">upit.sql</code> u istom direktorijumu (paketu) kao i <code class="language-plaintext highlighter-rouge">Main.java</code> datoteku koja sadrži rešenje ovog zadatka. Dodatno, u Java kodu ćemo pronaći ovu datoteku na sistemu datoteka i učitati njen sadržaj kao nisku da bismo je zatim izvršili. Posebno treba obratiti pažnju na parametarsku oznaku u samom upitu, koja će biti zamenjena odgovarajućom vrednošću u fazi izvršavanja programa.</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_8/src/zadatak_8_4/upit.sql</code></strong>:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WITH</span> <span class="n">BROJ_POLOZENIH_ISPITA</span> <span class="k">AS</span> <span class="p">(</span>
    <span class="k">SELECT</span>      <span class="n">INDEKS</span>
    <span class="k">FROM</span>        <span class="n">DA</span><span class="p">.</span><span class="n">ISPIT</span> 
    <span class="k">WHERE</span>       <span class="n">OCENA</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="k">AND</span> 
                <span class="n">STATUS</span> <span class="o">=</span> <span class="s1">'o'</span>
    <span class="k">GROUP</span> <span class="k">BY</span>    <span class="n">INDEKS</span>
    <span class="k">HAVING</span>      <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">=</span> <span class="o">?</span>
<span class="p">)</span>
<span class="k">SELECT</span>      <span class="n">D</span><span class="p">.</span><span class="n">INDEKS</span><span class="p">,</span> 
            <span class="n">IME</span><span class="p">,</span> 
            <span class="n">PREZIME</span><span class="p">,</span> 
            <span class="n">S</span><span class="p">.</span><span class="n">NAZIV</span><span class="p">,</span> 
            <span class="n">P</span><span class="p">.</span><span class="n">NAZIV</span><span class="p">,</span> 
            <span class="n">I</span><span class="p">.</span><span class="n">OCENA</span>
<span class="k">FROM</span>        <span class="n">DA</span><span class="p">.</span><span class="n">DOSIJE</span> <span class="n">D</span> <span class="k">JOIN</span> 
            <span class="n">BROJ_POLOZENIH_ISPITA</span> <span class="n">BPI</span> <span class="k">ON</span> <span class="n">D</span><span class="p">.</span><span class="n">INDEKS</span> <span class="o">=</span> <span class="n">BPI</span><span class="p">.</span><span class="n">INDEKS</span> <span class="k">JOIN</span>
            <span class="n">DA</span><span class="p">.</span><span class="n">STUDIJSKIPROGRAM</span> <span class="n">S</span> <span class="k">ON</span> <span class="n">D</span><span class="p">.</span><span class="n">IDPROGRAMA</span> <span class="o">=</span> <span class="n">S</span><span class="p">.</span><span class="n">ID</span> <span class="k">JOIN</span>
            <span class="n">DA</span><span class="p">.</span><span class="n">ISPIT</span> <span class="n">I</span> <span class="k">ON</span> <span class="n">D</span><span class="p">.</span><span class="n">INDEKS</span> <span class="o">=</span> <span class="n">I</span><span class="p">.</span><span class="n">INDEKS</span> <span class="k">JOIN</span>
            <span class="n">DA</span><span class="p">.</span><span class="n">PREDMET</span> <span class="n">P</span> <span class="k">ON</span> <span class="n">I</span><span class="p">.</span><span class="n">IDPREDMETA</span> <span class="o">=</span> <span class="n">P</span><span class="p">.</span><span class="n">ID</span>
<span class="k">WHERE</span>       <span class="n">I</span><span class="p">.</span><span class="n">OCENA</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="k">AND</span>
            <span class="n">I</span><span class="p">.</span><span class="n">STATUS</span> <span class="o">=</span> <span class="s1">'o'</span>
<span class="k">ORDER</span> <span class="k">BY</span>    <span class="n">D</span><span class="p">.</span><span class="n">INDEKS</span><span class="p">,</span>
            <span class="n">IME</span><span class="p">,</span>
            <span class="n">PREZIME</span><span class="p">,</span>
            <span class="n">S</span><span class="p">.</span><span class="n">NAZIV</span><span class="p">,</span>
            <span class="n">P</span><span class="p">.</span><span class="n">NAZIV</span>
</code></pre></div></div>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_8/src/zadatak_8_4/Main.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_8_4</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileNotFoundException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.ibm.db2.jcc.DB2Driver"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argv</span><span class="o">[])</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:db2://localhost:50000/stud2020"</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">"student"</span><span class="o">,</span> <span class="s">"abcdef"</span><span class="o">))</span> <span class="o">{</span>
            
            <span class="n">ispitiStudenteIIspite</span><span class="o">(</span><span class="n">con</span><span class="o">);</span>
            
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"SQLCODE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="s">"SQLSTATE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getSQLState</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span>
                    <span class="o">+</span> <span class="s">"PORUKA: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">ispitiStudenteIIspite</span><span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">FileNotFoundException</span><span class="o">,</span> <span class="nc">SQLException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="n">ucitajSqlIzDatoteke</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">brojPredmeta</span> <span class="o">=</span> <span class="n">ucitajBrojPredmeta</span><span class="o">();</span>

        <span class="nc">PreparedStatement</span> <span class="n">pstmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="n">pstmt</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">brojPredmeta</span><span class="o">);</span>

        <span class="nc">ResultSet</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">brojRedova</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

        <span class="kt">int</span> <span class="n">indeks</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        
        <span class="k">while</span> <span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// Ispisujemo informacije o studentu</span>
            <span class="c1">// samo kad naidjemo na novog studenta</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">indeks</span> <span class="o">!=</span> <span class="n">result</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">))</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">indeks</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"\n\n\n"</span><span class="o">);</span>
                <span class="o">}</span>

                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Indeks: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="s">"Ime: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="na">trim</span><span class="o">()</span>
                        <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="s">"Prezime: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">3</span><span class="o">).</span><span class="na">trim</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="s">"Studijski program: "</span>
                        <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">4</span><span class="o">).</span><span class="na">trim</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>

                <span class="n">brojRedova</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="c1">// Ispisujemo informacije o i-tom predmetu</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">brojRedova</span> <span class="o">+</span> <span class="s">". predmet: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">5</span><span class="o">).</span><span class="na">trim</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n\t"</span> <span class="o">+</span> <span class="s">"ocena: "</span>
                    <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">6</span><span class="o">));</span>

            <span class="c1">// Uvecavamo broj reda</span>
            <span class="o">++</span><span class="n">brojRedova</span><span class="o">;</span>
            <span class="c1">// Pamtimo tekuci indeks za narednu iteraciju</span>
            <span class="n">indeks</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">pstmt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">ucitajBrojPredmeta</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">brojPredmeta</span><span class="o">;</span>
        
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Unesite broj predmeta:"</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">(</span><span class="nc">Scanner</span> <span class="n">ulaz</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">brojPredmeta</span> <span class="o">=</span> <span class="n">ulaz</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">brojPredmeta</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">ucitajSqlIzDatoteke</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">FileNotFoundException</span> <span class="o">{</span>
        <span class="c1">// Eclipse aplikacije se pokrecu iz direktorijuma projekta,</span>
        <span class="c1">// dakle, u podrazumevanom slucaju,</span>
        <span class="c1">// ~/IBM/rationalsdp/workspace/poglavlje_8/.</span>
        <span class="c1">// Mozemo koristiti sistemsko svojstvo</span>
        <span class="c1">// System.getProperty("user.dir")</span>
        <span class="c1">// da dohvatimo putanju u kojoj se pokrece aplikacija.</span>
        <span class="c1">// Takodje, prilikom kompiliranja .java datoteka u .class datoteke,</span>
        <span class="c1">// Eclipse alat ce kopirati sve druge datoteke iz src/ direktorijuma u bin/ direktorijum.</span>
        <span class="nc">String</span> <span class="n">putanja</span> <span class="o">=</span> <span class="s">"./bin/zadatak_8_4/upit.sql"</span><span class="o">;</span>
        <span class="nc">StringBuilder</span> <span class="n">sql</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">linija</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        
        <span class="k">try</span> <span class="o">(</span><span class="nc">Scanner</span> <span class="n">skenerFajla</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">putanja</span><span class="o">),</span> <span class="s">"utf-8"</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">skenerFajla</span><span class="o">.</span><span class="na">hasNextLine</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">linija</span> <span class="o">=</span> <span class="n">skenerFajla</span><span class="o">.</span><span class="na">nextLine</span><span class="o">();</span>
                <span class="n">sql</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">linija</span><span class="o">);</span>
                <span class="n">sql</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="834-rukovanje-nedostajućim-vrednostima">8.3.4 Rukovanje nedostajućim vrednostima</h3>

<p>Što se tiče rada sa podacima koji su potencijalno nedostajući, na raspolaganju nam
je metod <code class="language-plaintext highlighter-rouge">ResultSet.wasNull</code>, koji je potrebno pozvati odmah nakon pozivanja metoda dohvatača za neku kolonu. Ukoliko je vrednost za tu kolonu bila <code class="language-plaintext highlighter-rouge">NULL</code>, onda će metod
<code class="language-plaintext highlighter-rouge">wasNull</code> vratiti vrednost <code class="language-plaintext highlighter-rouge">true</code>, a inače će vratiti <code class="language-plaintext highlighter-rouge">false</code>. Napomenimo da se poziv <code class="language-plaintext highlighter-rouge">wasNull</code>
metoda vezuje samo za poslednji poziv metoda <code class="language-plaintext highlighter-rouge">getXXX</code>, te samim tim i na poslednju dohvaćenu kolonu. Zbog toga je potrebno više puta pozivati ovaj metod ukoliko ima više
potencijalno nedostajućih kolona:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ResultSet</span> <span class="n">res</span> <span class="o">=</span> <span class="o">...</span>

<span class="k">while</span> <span class="o">(</span><span class="n">res</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
    <span class="c1">// Vrednosti u ovoj koloni ne mogu biti NULL,</span>
    <span class="c1">// pa nemamo ni proveru za nju.</span>
    <span class="kt">int</span> <span class="n">kolona1_notnull</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

    <span class="c1">// Vrednosti u ovoj koloni mogu biti NULL,</span>
    <span class="c1">// pa zato odmah nakon dohvatanja vrednosti,</span>
    <span class="c1">// pozivamo metod wasNull() da proverimo da li je NULL.</span>
    <span class="kt">int</span> <span class="n">kolona2_nullable</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
    <span class="kt">boolean</span> <span class="n">kol2IsNull</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="na">wasNull</span><span class="o">();</span>

    <span class="c1">// Vrednosti u ovoj koloni mogu biti NULL,</span>
    <span class="c1">// pa zato odmah nakon dohvatanja vrednosti,</span>
    <span class="c1">// pozivamo metod wasNull() da proverimo da li je NULL.</span>
    <span class="c1">// Ovaj poziv metoda wasNull() se odnosi na kolonu 3, a ne na 2.</span>
    <span class="nc">Date</span> <span class="n">kolona3_nullable</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="na">getDate</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
    <span class="kt">boolean</span> <span class="n">kol3IsNull</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="na">wasNull</span><span class="o">();</span>
    
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.5</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički koji izdvaja ime, prezime i datum diplomiranja za sve studentkinje (pol = ‘z’) programa čiji je identifikator 202 iz tabele <code class="language-plaintext highlighter-rouge">DOSIJE</code>. Ukoliko datum diplomiranja nije poznat, ispisati <code class="language-plaintext highlighter-rouge">Nije diplomirala</code>.</p>
</div>

<p>Rešenje:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_8/src/zadatak_8_5/Main.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_8_5</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.sql.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.ibm.db2.jcc.DB2Driver"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argv</span><span class="o">[])</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:db2://localhost:50000/stud2020"</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">"student"</span><span class="o">,</span> <span class="s">"abcdef"</span><span class="o">))</span> <span class="o">{</span>
            
            <span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">queryStr</span> <span class="o">=</span> 
                <span class="s">"SELECT IME, "</span> <span class="o">+</span> 
                <span class="s">"       PREZIME, "</span> <span class="o">+</span> 
                <span class="s">"       DATDIPLOMIRANJA "</span> <span class="o">+</span> 
                <span class="s">"FROM   DA.DOSIJE "</span> <span class="o">+</span> 
                <span class="s">"WHERE  POL = 'z' AND "</span> <span class="o">+</span> 
                <span class="s">"       IDPROGRAMA=202"</span><span class="o">;</span>
            <span class="nc">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">queryStr</span><span class="o">);</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"%-25s %-25s %-15s \n\n"</span><span class="o">,</span> <span class="s">"IME"</span><span class="o">,</span> <span class="s">"PREZIME"</span><span class="o">,</span> <span class="s">"DATUM DIPLOMIRANJA"</span><span class="o">);</span>

            <span class="k">while</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
                <span class="nc">String</span> <span class="n">ime</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">trim</span><span class="o">();</span>
                <span class="nc">String</span> <span class="n">prezime</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="na">trim</span><span class="o">();</span>
                <span class="nc">String</span> <span class="n">datum</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
                <span class="c1">// Ukoliko je u tekucem redu kursora datum bio NULL,</span>
                <span class="c1">// onda ce rs.wasNull() biti true</span>
                <span class="kt">boolean</span> <span class="n">datumIsNull</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">wasNull</span><span class="o">();</span>

                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"%-25s %-25s %-15s \n"</span><span class="o">,</span> <span class="n">ime</span><span class="o">,</span> <span class="n">prezime</span><span class="o">,</span> <span class="o">(</span><span class="n">datumIsNull</span><span class="o">)</span> <span class="o">?</span> <span class="s">"Nije diplomirala"</span> <span class="o">:</span> <span class="n">datum</span><span class="o">.</span><span class="na">trim</span><span class="o">());</span>
            <span class="o">}</span>

            <span class="n">rs</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">stmt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"SQLCODE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="s">"SQLSTATE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getSQLState</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span>
                    <span class="o">+</span> <span class="s">"PORUKA: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="835-podešavanje-kursora">8.3.5 Podešavanje kursora</h3>

<p>Objekat interfejsa <code class="language-plaintext highlighter-rouge">ResultSet</code> održava kursor koji pokazuje na red u rezultujućoj tabeli. Moguće je pomerati kursor na specifičan red kako bismo dohvatili podatke o tom redu ili izmenili vrednosti kolona. Kursor može da pokazuje na tačno jedan red u nekom trenutku. Red na koji kursor pokazuje se naziva <em>tekući red</em> kursora. U zavisnosti od podešavanja kursora, moguće je pomerati kursor na različite načine.</p>

<p>Pre nego što se upustimo u konkretne primere, važno je da prodiskutujemo o narednim svojstvima svakog kursora:</p>

<ul>
  <li>Usmerenost (eng. <em>scrollability</em>)</li>
  <li>Tipiziranost (eng. <em>concurrency</em>)</li>
  <li>Zadrživost (eng. <em>holdability</em>)</li>
</ul>

<h4 id="usmerenost-kursora">Usmerenost kursora</h4>

<p>Usmerenost definiše operacije kojima kursor prolazi kroz redove. Podrazumevano, kursor je usmeren samo unapred, odnosno, kursorom je moguće prolaziti samo od prvog do poslednjeg reda. Kada dođemo do poslednjeg reda, onda se ne možemo vratiti unazad, već je potrebno ponovo da otvorimo kursor. Ipak, moguće je definisati kursor koji je usmeren unapred i unazad, odnosno, moguće je kretati se proizvoljno kroz redove rezultujuće tabele. Ovakav kursor se često naziva <em>dvosmerni kursor</em>.</p>

<p>Dvosmerni kursor ima još jedno svojstvo koje se naziva <em>osetljivost na izmene</em> (eng. update sensitivity). Ovim svojstvom se definiše da li će se izmene u bazi podataka odraziti na redove rezultujuće tabele kroz koji se prolazi (otvorenim) dvosmernim kursorom. Kursor koji je osetljiv na izmene će prikazati izmene napravljene u bazi podataka, dok kursor koji nije osetljiv na izmene neće prikazati takve izmene. Naredne tri konstante interfejsa <code class="language-plaintext highlighter-rouge">ResultSet</code> se koriste za definisanje usmerenosti kursora:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ResultSet.TYPE_FORWARD_ONLY</code>: Dozvoljava kursoru da prolazi samo unapred kroz redove.</li>
  <li><code class="language-plaintext highlighter-rouge">ResultSet.TYPE_SCROLL_SENSITIVE</code>: Kreira dvosmerni kursor koji je osetljiv na izmene.</li>
  <li><code class="language-plaintext highlighter-rouge">ResultSet.TYPE_SCROLL_INSENSITIVE</code>: Kreira dvosmerni kursor koji nije osetljiv na izmene. Kada se kursor otvori, skup redova rezultujuće tabele neće biti promenjen dok ovakav kursor prolazi kroz te redove. Ako želimo da dohvatimo izmenjen skup redova, potrebno je da ponovo izvršimo upit (tj. da ponovo otvorimo kursor).</li>
</ul>

<h4 id="tipiziranost-kursora">Tipiziranost kursora</h4>

<p>Tipiziranost se odnosi na sposobnost kursora da ažurira podatke kroz koje prolazi. Podrazumevano, kursor koji se napravi je ograničen samo za čitanje i ne dozvoljava nam da ažuriramo redove rezultujuće tabele. Ako želimo da koristimo kursor da ažuriramo podatke nad bazom podataka, potrebno je da upit koji je pridružen kursoru vrati skup podataka koji se može ažurirati od strane JDBC drajvera. Naredne dve konstante interfejsa <code class="language-plaintext highlighter-rouge">ResultSet</code> se koriste za definisanje tipiziranosti kursora.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ResultSet.CONCUR_READ_ONLY</code>: Ograničava kursor samo za čitanje.</li>
  <li><code class="language-plaintext highlighter-rouge">ResultSet.CONCUR_UPDATABLE</code>: Omogućava da kursor ažurira podatke.</li>
</ul>

<p>Važno je napomenuti da, ako pokušamo da napravimo kursor koji je ažurirajući, ali nije osetljiv na izmene (tj. koristimo kombinaciju konstanti <code class="language-plaintext highlighter-rouge">ResultSet.TYPE_SCROLL_INSENSITIVE</code> i <code class="language-plaintext highlighter-rouge">ResultSet.CONCUR_UPDATABLE</code>), JDBC drajver će implicitno ograničiti takav kursor samo za čitanje, tako da neće podržavati operacije unosa, brisanja i izmene. Pokušaj da se ovakve operacije izvrše nad takvim kursorom rezultovaće ispaljivanjem <code class="language-plaintext highlighter-rouge">SQLException</code> izuzetka.</p>

<h4 id="zadrživost-kursora">Zadrživost kursora</h4>

<p>Zadrživost kursora se odnosi na stanje kursora nakon potvrđivanja izmena transakcije u kojoj je taj kursor otvoren. Kursor se može ili zatvoriti ili otvoriti u trenutku potvrđivanja izmena transakcije. Podrazumevano ponašanje zavisi od JDBC drajvera i može se proveriti pozivom metoda <code class="language-plaintext highlighter-rouge">getHoldability()</code> nad objektom interfejsa <code class="language-plaintext highlighter-rouge">Connection</code>. Metod vraća jednu od naredne dve konstante, koje se takođe mogu koristiti i za eksplicitno definisanje zadrživosti na nivou pojedinačnih kursora:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ResultSet.HOLD_CURSORS_OVER_COMMIT</code>: Ostavlja kursor u otvorenom stanju nakon što se izmene potvrde u transakciji.</li>
  <li><code class="language-plaintext highlighter-rouge">ResultSet.CLOSE_CURSORS_AT_COMMIT</code>: Zatvara kursor nakon što se izmene potvrde u transakciji.</li>
</ul>

<h4 id="definisanje-svojstava-kursora">Definisanje svojstava kursora</h4>

<p>Da bismo definisali ponašanje <code class="language-plaintext highlighter-rouge">ResultSet</code> objekta, potrebno je da prosledimo odgovarajuće opcije metodima <code class="language-plaintext highlighter-rouge">createStatement</code>, odnosno, <code class="language-plaintext highlighter-rouge">prepareStatement</code>, koji su definisani nad objektom interfejsa <code class="language-plaintext highlighter-rouge">Connection</code>, u zavisnosti od toga da li želimo da naredbu izvršimo kroz interfejse <code class="language-plaintext highlighter-rouge">Statement</code> ili <code class="language-plaintext highlighter-rouge">PreparedStatement</code>, redom.</p>

<p>U slučaju kreiranja objekta <code class="language-plaintext highlighter-rouge">Statement</code>, na raspolaganju su nam naredna dva preopterećenja metoda <code class="language-plaintext highlighter-rouge">createStatement</code>:</p>

<ul>
  <li>Metod sa dva argumenta:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">int resultSetType</code> — Usmerenost kursora.</li>
      <li><code class="language-plaintext highlighter-rouge">int resultSetConcurrency</code> — Tipiziranost kursora.</li>
    </ul>
  </li>
  <li>Metod sa tri argumenta:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">int resultSetType</code> — Usmerenost kursora.</li>
      <li><code class="language-plaintext highlighter-rouge">int resultSetConcurrency</code> — Tipiziranost kursora.</li>
      <li><code class="language-plaintext highlighter-rouge">int resultSetHoldability</code> — Zadrživost kursora.</li>
    </ul>
  </li>
</ul>

<p>U slučaju kreiranja objekta <code class="language-plaintext highlighter-rouge">PreparedStatement</code>, na raspolaganju su nam naredna dva preopterećenja metoda <code class="language-plaintext highlighter-rouge">prepareStatement</code>, sa istim značenjima parametara kao i u slučaju metoda <code class="language-plaintext highlighter-rouge">createStatement</code>:</p>

<ul>
  <li>Metod sa tri argumenta:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">String sql</code> — Niska koja sadrži tekstualni oblik SQL naredbe. Može sadržati nula ili više parametarskih oznaka.</li>
      <li><code class="language-plaintext highlighter-rouge">int resultSetType</code></li>
      <li><code class="language-plaintext highlighter-rouge">int resultSetConcurrency</code></li>
    </ul>
  </li>
  <li>Metod sa četiri argumenta:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">String sql</code></li>
      <li><code class="language-plaintext highlighter-rouge">int resultSetType</code></li>
      <li><code class="language-plaintext highlighter-rouge">int resultSetConcurrency</code></li>
      <li><code class="language-plaintext highlighter-rouge">int resultSetHoldability</code></li>
    </ul>
  </li>
</ul>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.6</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički koji ispisuje podatke o ispitnim rokovima koristeći kursor kome je omogućeno kretanje i unazad kroz podatke. Podatke urediti po nazivu rastuće, ali ih ispisivati opadajuće.</p>
</div>

<p>Rešenje:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_8/src/zadatak_8_6/Main.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_8_6</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.sql.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.ibm.db2.jcc.DB2Driver"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argv</span><span class="o">[])</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:db2://localhost:50000/stud2020"</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">"student"</span><span class="o">,</span> <span class="s">"abcdef"</span><span class="o">))</span> <span class="o">{</span>
            
            <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> 
                <span class="s">"SELECT     * "</span> <span class="o">+</span> 
                <span class="s">"FROM       DA.ISPITNIROK "</span> <span class="o">+</span> 
                <span class="s">"ORDER BY   NAZIV"</span><span class="o">;</span>
            <span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">(</span>
                <span class="c1">// Podesavamo da je kursor bidirekcioni i nesenzitivni,</span>
                <span class="c1">// sto znaci da moze da se krece kroz njega u oba smera,</span>
                <span class="c1">// i da izmene u bazi podataka nece biti vidljive tokom</span>
                <span class="c1">// prolazenja kroz kursora</span>
                <span class="nc">ResultSet</span><span class="o">.</span><span class="na">TYPE_SCROLL_INSENSITIVE</span><span class="o">,</span>
                <span class="c1">// Podesavamo da se kursor koristi samo za citanje</span>
                <span class="nc">ResultSet</span><span class="o">.</span><span class="na">CONCUR_READ_ONLY</span><span class="o">);</span>
            <span class="nc">ResultSet</span> <span class="n">res</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"%-10s %-15s %-20s %-20s %-20s\n\n"</span><span class="o">,</span> 
                <span class="s">"GODINA"</span><span class="o">,</span> <span class="s">"OZNAKA"</span><span class="o">,</span> <span class="s">"NAZIV"</span><span class="o">,</span> <span class="s">"DATUM POCETKA"</span><span class="o">,</span> <span class="s">"DATUM KRAJA"</span><span class="o">);</span>

            <span class="c1">// Pozicioniranje na kraj kursora</span>
            <span class="n">res</span><span class="o">.</span><span class="na">afterLast</span><span class="o">();</span>

            <span class="c1">// Citanje unazad</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">res</span><span class="o">.</span><span class="na">previous</span><span class="o">())</span> <span class="o">{</span>
                <span class="kt">int</span> <span class="n">godina</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
                <span class="nc">String</span> <span class="n">oznaka</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="na">trim</span><span class="o">();</span>
                <span class="nc">String</span> <span class="n">naziv</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">3</span><span class="o">).</span><span class="na">trim</span><span class="o">();</span>
                <span class="nc">Date</span> <span class="n">datumPocetka</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="na">getDate</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>
                <span class="nc">Date</span> <span class="n">datumKraja</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="na">getDate</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span>

                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"%-10d %-15s %-20s %-20s %-20s\n"</span><span class="o">,</span> 
                    <span class="n">godina</span><span class="o">,</span> <span class="n">oznaka</span><span class="o">,</span> <span class="n">naziv</span><span class="o">,</span> <span class="n">datumPocetka</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="n">datumKraja</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="o">}</span>

            <span class="n">res</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">stmt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"SQLCODE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="s">"SQLSTATE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getSQLState</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span>
                    <span class="o">+</span> <span class="s">"PORUKA: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="836-ažuriranje-redova-korišćenjem-resultset-kursora">8.3.6 Ažuriranje redova korišćenjem ResultSet kursora</h3>

<p>Postoje dve procedure za ažuriranje informacija u bazi podataka na osnovu <code class="language-plaintext highlighter-rouge">ResultSet</code> kursora:</p>

<ul>
  <li>Korišćenjem pozicionirajuće <code class="language-plaintext highlighter-rouge">UPDATE</code> naredbe.</li>
  <li>Korišćenjem JDBC metoda <code class="language-plaintext highlighter-rouge">updateXXX</code> i <code class="language-plaintext highlighter-rouge">updateRow</code>.</li>
</ul>

<p>Kao što znamo, možemo koristiti pozicionirajuću <code class="language-plaintext highlighter-rouge">UPDATE</code> naredbu za menjanje podataka u bazi podataka, na osnovu tekućeg reda kursora, tako što se na kursor referiše u <code class="language-plaintext highlighter-rouge">WHERE CURRENT OF</code> klauzi naredbe. Da bismo dohvatili naziv <code class="language-plaintext highlighter-rouge">ResultSet</code> kursora, možemo iskoristiti metod <code class="language-plaintext highlighter-rouge">ResultSet.getCursorName</code>, koji vraća nisku sa nazivom kursora koji je vezan za taj <code class="language-plaintext highlighter-rouge">ResultSet</code>. Na primer, naredni fragment koda ilustruje kako možemo ažurirati broj bodova za sve predmete iz tabele <code class="language-plaintext highlighter-rouge">PREDMET</code> korišćenjem pozicionirajuće <code class="language-plaintext highlighter-rouge">UPDATE</code> naredbe:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">upit</span> <span class="o">=</span>
    <span class="s">"SELECT OZNAKA, "</span> <span class="o">+</span>
    <span class="s">"       NAZIV, "</span> <span class="o">+</span> 
    <span class="s">"       ESPB "</span> <span class="o">+</span>
    <span class="s">"FROM   DA.PREDMET "</span> <span class="o">+</span>
    <span class="s">"FOR    UPDATE OF ESPB"</span><span class="o">;</span>

<span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>
<span class="nc">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">upit</span><span class="o">);</span>

<span class="nc">String</span> <span class="n">nazivKursora</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getCursorName</span><span class="o">();</span>
<span class="nc">String</span> <span class="n">azuriranje</span> <span class="o">=</span>
    <span class="s">"UPDATE DA.PREDMET "</span> <span class="o">+</span>
    <span class="s">"SET    ESPB = ? "</span> <span class="o">+</span>
    <span class="s">"WHERE  CURRENT OF "</span> <span class="o">+</span> <span class="n">nazivKursora</span><span class="o">;</span>
<span class="nc">PreparedStatement</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">nazivKursora</span><span class="o">);</span>

<span class="k">try</span> <span class="o">(</span><span class="nc">Scanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">))</span> <span class="o">{</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Unesite nove ESPB bodove za predmet "</span> <span class="o">+</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span>
        <span class="kt">int</span> <span class="n">newESPB</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>

        <span class="n">ps</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">newESPB</span><span class="o">);</span>
        <span class="n">ps</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Drugi pristup podrazumeva korišćenje specifičnih metoda radi ažuriranja podataka u kursoru, čime se efektivno vrši ažuriranje u bazi podataka.</p>

<div class="ui piled purple segment">
  <h4 class="ui header">Procedura: Ažuriranje slogova pomoću ažurirajućih kursora</h4>

  <p>Naredni koraci opisuju postupak ažuriranja postojećih slogova u <code class="language-plaintext highlighter-rouge">ResultSet</code>:</p>

  <ol>
    <li>Kreirati objekat interfejsa <code class="language-plaintext highlighter-rouge">Statement</code> pozivom metoda
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">(...,</span> <span class="nc">ResultSet</span><span class="o">.</span><span class="na">CONCUR_UPDATABLE</span><span class="o">,</span> <span class="o">...);</span>
</code></pre></div>      </div>
    </li>
    <li>Kreirati objekat interfejsa <code class="language-plaintext highlighter-rouge">ResultSet</code> pozivom metoda
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ResultSet</span> <span class="n">kursor</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
</code></pre></div>      </div>
    </li>
    <li>Pozicionirati se na slog koji je potrebno ažurirati metodima za prolazak kroz kursor. Na primer:
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="o">(</span><span class="n">kursor</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
 <span class="n">kursor</span><span class="o">.</span><span class="na">absolute</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span> <span class="c1">// Samo ako kursor nije tipa TYPE_FORWARD_ONLY</span>
 <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div>      </div>
    </li>
    <li>Pozvati odgovarajući metod iz familije metoda <code class="language-plaintext highlighter-rouge">ResultSet.updateXXX(int columnIndex, XXX x)</code> za ažuriranje vrednosti kolone tabele sa indeksom <code class="language-plaintext highlighter-rouge">columnIndex</code> novom vrednošću <code class="language-plaintext highlighter-rouge">x</code>.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kursor</span><span class="o">.</span><span class="na">updateInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
</code></pre></div>      </div>
      <ol>
        <li>Ako želimo da poništimo izmene, možemo pozvati metod <code class="language-plaintext highlighter-rouge">kursor.cancelRowUpdates()</code></li>
        <li>Ukoliko želimo da zapravo izvršimo izmene nad slogom u BP, potrebno je da pozovemo metod <code class="language-plaintext highlighter-rouge">ResultSet.updateRow()</code>. U suprotnom će, prelaskom na drugi red, sve izmene biti ignorisane.
          <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kursor</span><span class="o">.</span><span class="na">updateRow</span><span class="o">();</span>
</code></pre></div>          </div>
        </li>
      </ol>
    </li>
    <li>Nakon svih iteracija, zatvoriti kursor.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kursor</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</code></pre></div>      </div>
    </li>
    <li>Nakon zatvaranja kursora, zatvoriti naredbu.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stmt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</code></pre></div>      </div>
    </li>
  </ol>

</div>

<p>Pogledajmo primer upotrebe u narednom zadatku.</p>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.7</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički koji ispisuje sadržaj tabele
<code class="language-plaintext highlighter-rouge">PREDMET</code> i, u istoj iteraciji, ukoliko je broj bodova jednak X, postavlja se broj bodova na
Y i ispisuje se poruka da je promena izvršena, zajedno sa ispisom novih podataka o
tom predmetu. Brojevi X i Y se učitavaju sa standardnog ulaza.</p>
</div>

<p>Rešenje:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_8/src/zadatak_8_7/Main.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_8_7</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.sql.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.ibm.db2.jcc.DB2Driver"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argv</span><span class="o">[])</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:db2://localhost:50000/stud2020"</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">"student"</span><span class="o">,</span> <span class="s">"abcdef"</span><span class="o">))</span> <span class="o">{</span>

            <span class="kt">int</span><span class="o">[]</span> <span class="n">ucitaniESPB</span> <span class="o">=</span> <span class="n">ucitajStareINoveESPB</span><span class="o">();</span>
            <span class="n">ispisiIAzurirajPredmete</span><span class="o">(</span><span class="n">con</span><span class="o">,</span> <span class="n">ucitaniESPB</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">ucitaniESPB</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"SQLCODE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="s">"SQLSTATE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getSQLState</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span>
                    <span class="o">+</span> <span class="s">"PORUKA: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">ispisiIAzurirajPredmete</span><span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span><span class="o">,</span> <span class="kt">int</span> <span class="no">X</span><span class="o">,</span> <span class="kt">int</span> <span class="no">Y</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> 
            <span class="s">"SELECT * "</span> <span class="o">+</span> 
            <span class="s">"FROM   DA.PREDMET"</span><span class="o">;</span>
        <span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">(</span> 
                <span class="c1">// Dovoljan nam je kursor koji prolazi unapred kroz redove.</span>
                <span class="nc">ResultSet</span><span class="o">.</span><span class="na">TYPE_FORWARD_ONLY</span><span class="o">,</span>
                <span class="c1">// Definisemo da je kursor azurirajuci,</span>
                <span class="c1">// pa su nam dostupni metodi</span>
                <span class="c1">// ResultSet.updateXXX i ResultSet.updateRow</span>
                <span class="c1">// koje cemo koristiti za azuriranje tekuceg reda</span>
                <span class="nc">ResultSet</span><span class="o">.</span><span class="na">CONCUR_UPDATABLE</span><span class="o">);</span>
        <span class="nc">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>

        <span class="k">while</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Oznaka: "</span> <span class="o">+</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="na">trim</span><span class="o">()</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="s">"Naziv:"</span> <span class="o">+</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">3</span><span class="o">).</span><span class="na">trim</span><span class="o">()</span> <span class="o">+</span> <span class="s">", "</span>
                    <span class="o">+</span> <span class="s">"ESPB: "</span> <span class="o">+</span> <span class="n">rs</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">4</span><span class="o">));</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="o">==</span> <span class="no">X</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// Azuriramo vrednost u koloni broj 5 (ESPB) iz upita iznad.</span>
                <span class="n">rs</span><span class="o">.</span><span class="na">updateInt</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="no">Y</span><span class="o">);</span>
                <span class="c1">// Kada zavrsimo sa azuriranjem svih kolona,</span>
                <span class="c1">// pozivamo metod updateRow</span>
                <span class="c1">// da bi se sve promene odmah oslikale.</span>
                <span class="c1">// Ako zaboravimo da pozovemo ovaj metod,</span>
                <span class="c1">// izmene se nece propagirati i bice izgubljene.</span>
                <span class="n">rs</span><span class="o">.</span><span class="na">updateRow</span><span class="o">();</span>

                <span class="c1">// Sada kada zahtevamo vrednosti u kolonama,</span>
                <span class="c1">// dobicemo azurirane vrednosti:</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"------&gt; Izvrsena je naredna promena:"</span><span class="o">);</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"        Oznaka: "</span> <span class="o">+</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="na">trim</span><span class="o">()</span> <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="s">"Naziv:"</span> <span class="o">+</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">3</span><span class="o">).</span><span class="na">trim</span><span class="o">()</span>
                        <span class="o">+</span> <span class="s">", "</span> <span class="o">+</span> <span class="s">"ESPB: "</span>
                        <span class="o">+</span> <span class="n">rs</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span> <span class="cm">/* azurirana vrednost */</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="n">rs</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">stmt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span><span class="o">[]</span> <span class="nf">ucitajStareINoveESPB</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span><span class="o">[]</span> <span class="n">rezultat</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
        
        <span class="k">try</span> <span class="o">(</span><span class="nc">Scanner</span> <span class="n">ulaz</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">))</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Unesite stare ESPB:"</span><span class="o">);</span>
            <span class="n">rezultat</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="n">ulaz</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Unesite nove ESPB:"</span><span class="o">);</span>
            <span class="n">rezultat</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">ulaz</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
        <span class="o">}</span>
        
        <span class="k">return</span> <span class="n">rezultat</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="837-unos-redova-korišćenjem-resultset-kursora">8.3.7 Unos redova korišćenjem ResultSet kursora</h3>

<p>Ono što nismo imali prilike da vidimo jeste da se pomoću kursora mogu uneti novi slogovi u tabelu. Za unos novog sloga u tabelu koristi se specijalni “slog za unos”. Ovaj specijalni slog zapravo predstavlja bafer za konstruisanje novog sloga koji će biti unet u odgovarajuću tabelu.</p>

<p>Konstrukcija novog sloga se vrši u dva koraka:</p>
<ol>
  <li>Potrebno je postaviti vrednosti svih kolona rezultujuće tabele u “slogu za unos” pozivom odgovarajućih metoda iz familije metoda <code class="language-plaintext highlighter-rouge">ResultSet.updateXXX(int columnIndex, XXX x)</code></li>
  <li>Kada su svim kolonama u “slogu za unos” dodeljene odgovarajuće vrednosti, tada je potrebno izvršiti unos baferisanog “sloga za unos” u rezultujuću tabelu.</li>
</ol>

<p>Unos baferisanog “slogu za unos” se izvršava pozivom metoda <code class="language-plaintext highlighter-rouge">void ResultSet.insertRow()</code>. Međutim, da bismo zapravo uspeli da konstruišemo ovaj specijalni slog, neophodno je da signaliziramo kursoru da želimo da menjamo baš taj red, a ne tekući red kroz koji se iterira u kursoru. Ovo je moguće uraditi pozivom metoda <code class="language-plaintext highlighter-rouge">void ResultSet.moveToInsertRow()</code>. Prilikom poziva ovog metoda, kursor se pozicionira na “slog za unos” i ujedno se pamti redni broj tekućeg sloga koji se obrađuje u kursoru. Nakon što smo završili proceduru za unos opisanu prethodnim koracima, potrebno je pozvati metod <code class="language-plaintext highlighter-rouge">void ResultSet.moveToCurrentRow()</code> koji će ponovo pozicionirati kursor na prethodno zapamćeni tekući slog koji se obrađuje u kursoru.</p>

<div class="ui piled purple segment">
  <h4 class="ui header">Procedura: Unos slogova pomoću ažurirajućih kursora</h4>

  <p>Celokupna procedura za unos novog sloga je data narednim koracima:</p>

  <ol>
    <li>Kreirati objekat interfejsa <code class="language-plaintext highlighter-rouge">Statement</code> za rad sa ažurirajućim kursorima.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">(...,</span> <span class="nc">ResultSet</span><span class="o">.</span><span class="na">CONCUR_UPDATABLE</span><span class="o">,</span> <span class="o">...);</span>
</code></pre></div>      </div>
    </li>
    <li>Kreirati objekat interfejsa <code class="language-plaintext highlighter-rouge">ResultSet</code>.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ResultSet</span> <span class="n">kursor</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
</code></pre></div>      </div>
    </li>
    <li>Otvoriti kursor i pozicionirati se na “slog za unos”.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="o">(</span><span class="n">kursor</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
 <span class="n">kursor</span><span class="o">.</span><span class="na">moveToInsertRow</span><span class="o">();</span>
 <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div>      </div>
    </li>
    <li>Pozvati odgovarajući metod iz familije metoda <code class="language-plaintext highlighter-rouge">ResultSet.updateXXX(int columnIndex, XXX x)</code> za postavljanje vrednosti kolone “sloga za unos” sa indeksom <code class="language-plaintext highlighter-rouge">columnIndex</code> novom vrednošću <code class="language-plaintext highlighter-rouge">x</code>. Na primer:
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kursor</span><span class="o">.</span><span class="na">updateInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
</code></pre></div>      </div>
    </li>
    <li>Ukoliko želimo da zapravo unesemo novi slog u BP, potrebno je da pozovemo metod <code class="language-plaintext highlighter-rouge">ResultSet.insertRow()</code>. U suprotnom će, prelaskom na drugi red, sve izmene biti ignorisane.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kursor</span><span class="o">.</span><span class="na">insertRow</span><span class="o">();</span>
</code></pre></div>      </div>
    </li>
    <li>Pozicionirati se na tekući slog u rezultujućoj tabeli kursora pozivom metoda <code class="language-plaintext highlighter-rouge">ResultSet.moveToCurrentRow()</code>.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kursor</span><span class="o">.</span><span class="na">moveToCurrentRow</span><span class="o">();</span>
</code></pre></div>      </div>
    </li>
    <li>Nakon svih iteracija, pozvati metod <code class="language-plaintext highlighter-rouge">kursor.close()</code> radi zatvaranja kursora.</li>
    <li>Nakon zatvaranja kursora, pozvati metod <code class="language-plaintext highlighter-rouge">stmt.close()</code> radi zatvaranja objekta naredbe.</li>
  </ol>

</div>

<p>Naredni zadatak ilustruje upotrebu opisane procedure.</p>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.8</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički koji:</p>
  <ol>
    <li>Kreira tabelu <code class="language-plaintext highlighter-rouge">UNETIPREDMETI</code> čije su kolone: (1) identifikator predmeta i (2) broj položenih ispita za taj predmet. Postaviti odgovarajuće primarne i strane ključeve.</li>
    <li>Za svaki predmet koji nije prethodno obrađen (tj. koji se ne nalazi u tabeli <code class="language-plaintext highlighter-rouge">UNETIPREDMETI</code>) pronalazi statistiku koja se sastoji od njegovog identifikator i broj položenih ispita.</li>
    <li>Za svaku pronađenu statistiku ispisuje podatke na standardni izlaz i pita korisnika da li želi da unete statistiku u tabelu <code class="language-plaintext highlighter-rouge">UNETIPREDMETI</code>. Ukoliko korisnik potvrdi, potrebno je uneti statistiku u datu tabelu i ispisati poruku o uspehu. U suprotnom, ispisati poruku da je korisnik poništio unos.</li>
  </ol>
</div>

<p>Rešenje:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_8/src/zadatak_8_8/Main.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_8_8</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.sql.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.ibm.db2.jcc.DB2Driver"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">StatistikaPolaganja</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">idPredmeta</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">brojPolaganja</span><span class="o">;</span>
        
        <span class="kd">public</span> <span class="nf">StatistikaPolaganja</span><span class="o">(</span><span class="kt">int</span> <span class="n">idPredmeta</span><span class="o">,</span> <span class="kt">int</span> <span class="n">brojPolaganja</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">idPredmeta</span> <span class="o">=</span> <span class="n">idPredmeta</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">brojPolaganja</span> <span class="o">=</span> <span class="n">brojPolaganja</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argv</span><span class="o">[])</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:db2://localhost:50000/stud2020"</span><span class="o">;</span>
        <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">StatistikaPolaganja</span><span class="o">&gt;</span> <span class="n">statistike</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">"student"</span><span class="o">,</span> <span class="s">"abcdef"</span><span class="o">))</span> <span class="o">{</span>
            
            <span class="n">kreirajTabelu</span><span class="o">(</span><span class="n">con</span><span class="o">);</span>
            <span class="n">sakupiStatistiku</span><span class="o">(</span><span class="n">con</span><span class="o">,</span> <span class="n">statistike</span><span class="o">);</span>
            <span class="n">unesiPredmeteIzStatistike</span><span class="o">(</span><span class="n">con</span><span class="o">,</span> <span class="n">statistike</span><span class="o">);</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"SQLCODE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="s">"SQLSTATE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getSQLState</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span>
                    <span class="o">+</span> <span class="s">"PORUKA: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">kreirajTabelu</span><span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"CREATE TABLE DA.UNETIPREDMETI ( "</span>
                <span class="o">+</span> <span class="s">"IDPREDMETA INTEGER NOT NULL, "</span>
                <span class="o">+</span> <span class="s">"BROJPOLOZENIH INTEGER NOT NULL, "</span>
                <span class="o">+</span> <span class="s">"PRIMARY KEY (IDPREDMETA), "</span>
                <span class="o">+</span> <span class="s">"FOREIGN KEY (IDPREDMETA) REFERENCES DA.PREDMET "</span>
                <span class="o">+</span> <span class="s">")"</span><span class="o">;</span>
        <span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">stmt</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Ignorisemo gresku samo ako je u pitanju greska da tabela vec postoji (-601).</span>
            <span class="c1">// Sve ostale ispaljujemo main metodu.</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">()</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">601</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stmt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">sakupiStatistiku</span><span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span><span class="o">,</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">StatistikaPolaganja</span><span class="o">&gt;</span> <span class="n">statistike</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"SELECT  IDPREDMETA, COUNT(OCENA) "</span> <span class="o">+</span>
            <span class="s">"FROM    DA.ISPIT "</span> <span class="o">+</span>
            <span class="s">"WHERE   OCENA &gt; 5 AND "</span> <span class="o">+</span>
            <span class="s">"        STATUS = 'o' AND "</span> <span class="o">+</span>
            <span class="s">"        IDPREDMETA NOT IN (SELECT IDPREDMETA FROM DA.UNETIPREDMETI) "</span> <span class="o">+</span>
            <span class="s">"GROUP BY IDPREDMETA"</span><span class="o">;</span>
        <span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>
        <span class="nc">ResultSet</span> <span class="n">kursor</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">kursor</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">idPredmeta</span> <span class="o">=</span> <span class="n">kursor</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
            <span class="kt">int</span> <span class="n">brojPolaganja</span> <span class="o">=</span> <span class="n">kursor</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span> 
            <span class="n">statistike</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">StatistikaPolaganja</span><span class="o">(</span><span class="n">idPredmeta</span><span class="o">,</span> <span class="n">brojPolaganja</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">kursor</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">stmt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">unesiPredmeteIzStatistike</span><span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span><span class="o">,</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">StatistikaPolaganja</span><span class="o">&gt;</span> <span class="n">statistike</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> 
            <span class="s">"SELECT * "</span> <span class="o">+</span> 
            <span class="s">"FROM   DA.UNETIPREDMETI"</span><span class="o">;</span>
        <span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">(</span> 
                <span class="c1">// Dovoljan nam je kursor koji prolazi unapred kroz redove.</span>
                <span class="nc">ResultSet</span><span class="o">.</span><span class="na">TYPE_FORWARD_ONLY</span><span class="o">,</span>
                <span class="c1">// Definisemo da je kursor azurirajuci,</span>
                <span class="c1">// pa su nam dostupni metodi</span>
                <span class="c1">// ResultSet.updateXXX i ResultSet.insertRow</span>
                <span class="c1">// koje cemo koristiti za konstrukciju i unos novog reda</span>
                <span class="nc">ResultSet</span><span class="o">.</span><span class="na">CONCUR_UPDATABLE</span><span class="o">);</span>
        <span class="nc">ResultSet</span> <span class="n">kursor</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
        <span class="nc">Scanner</span> <span class="n">ulaz</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">);</span>
        
        <span class="k">for</span> <span class="o">(</span><span class="nc">StatistikaPolaganja</span> <span class="n">statistika</span> <span class="o">:</span> <span class="n">statistike</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Pozicioniramo kursor na "slog za unos"</span>
            <span class="n">kursor</span><span class="o">.</span><span class="na">moveToInsertRow</span><span class="o">();</span>
            <span class="c1">// Konstruisemo "slog za unos" navodjenjem vrednost za svaku kolonu</span>
            <span class="n">kursor</span><span class="o">.</span><span class="na">updateInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">statistika</span><span class="o">.</span><span class="na">idPredmeta</span><span class="o">);</span>
            <span class="n">kursor</span><span class="o">.</span><span class="na">updateInt</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">statistika</span><span class="o">.</span><span class="na">brojPolaganja</span><span class="o">);</span>
            <span class="c1">// Izvrsavamo ili ponistavamo unos u zavisnosti od korisnikovog odgovora</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Da li zelite da unete statistiku za predmet "</span> <span class="o">+</span> <span class="n">statistika</span><span class="o">.</span><span class="na">idPredmeta</span> <span class="o">+</span> <span class="s">"? [da/ne]"</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">odgovor</span> <span class="o">=</span> <span class="n">ulaz</span><span class="o">.</span><span class="na">nextLine</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">odgovor</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"da"</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">kursor</span><span class="o">.</span><span class="na">insertRow</span><span class="o">();</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\tUneta je statistika: "</span> <span class="o">+</span> <span class="n">statistika</span><span class="o">.</span><span class="na">idPredmeta</span> <span class="o">+</span> <span class="s">" ("</span> <span class="o">+</span> <span class="n">statistika</span><span class="o">.</span><span class="na">brojPolaganja</span> <span class="o">+</span> <span class="s">")"</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">else</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\tPonistili ste unos!"</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="c1">// Vracamo kursor na zapamceni tekuci red</span>
            <span class="n">kursor</span><span class="o">.</span><span class="na">moveToCurrentRow</span><span class="o">();</span>
        <span class="o">}</span>
        
        <span class="n">ulaz</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">kursor</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">stmt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="838-brisanje-redova-korišćenjem-resultset-kursora">8.3.8 Brisanje redova korišćenjem ResultSet kursora</h3>

<p>Poput ažuriranja podataka, i za brisanje podataka postoje dve procedure:</p>

<ul>
  <li>Korišćenjem pozicionirajuće <code class="language-plaintext highlighter-rouge">DELETE</code> naredbe.</li>
  <li>Korišćenjem JDBC metoda <code class="language-plaintext highlighter-rouge">deleteRow</code>.</li>
</ul>

<p>Kao što znamo, možemo koristiti pozicionirajuću DELETE naredbu za brisanje podataka iz
baze podataka, na osnovu tekućeg reda kursora, tako što se na kursor referiše u <code class="language-plaintext highlighter-rouge">WHERE CURRENT OF</code> klauzi naredbe. Procedura za dohvatanje naziva kursora i izvršavanje pozicionirajuće <code class="language-plaintext highlighter-rouge">DELETE</code> naredbe je ekvivalentna prethodno opisanoj proceduri za ažuriranje podataka korišćenjem pozicionirajuće <code class="language-plaintext highlighter-rouge">UPDATE</code> naredbe, te ćemo samo prikazati fragment koda koji ilustruje ovu proceduru:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">upit</span> <span class="o">=</span>
    <span class="s">"SELECT OZNAKA, "</span> <span class="o">+</span>
    <span class="s">"       NAZIV, "</span> <span class="o">+</span> 
    <span class="s">"       ESPB "</span> <span class="o">+</span>
    <span class="s">"FROM   DA.PREDMET"</span><span class="o">;</span>

<span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span>
<span class="nc">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">upit</span><span class="o">);</span>

<span class="nc">String</span> <span class="n">nazivKursora</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getCursorName</span><span class="o">();</span>
<span class="nc">String</span> <span class="n">brisanje</span> <span class="o">=</span>
    <span class="s">"DELETE FROM DA.PREDMET "</span> <span class="o">+</span>
    <span class="s">"WHERE  CURRENT OF "</span> <span class="o">+</span> <span class="n">nazivKursora</span><span class="o">;</span>
<span class="nc">Statement</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">();</span>

<span class="k">while</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">nazivPredmeta</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>

    <span class="n">ps</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span><span class="n">brisanje</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Obrisan je predmet "</span> <span class="o">+</span> <span class="n">nazivPredmeta</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Brisanje sloga iz objekta <code class="language-plaintext highlighter-rouge">ResultSet</code> je jednostavnije nego ažuriranje ili unos sloga.</p>

<div class="ui piled purple segment">
  <h4 class="ui header">Procedura: Brisanje slogova pomoću ažurirajućih kursora</h4>

  <p>Naredni koraci definišu operaciju brisanja sloga iz kursora:</p>

  <ol>
    <li>Kreirati objekat interfejsa <code class="language-plaintext highlighter-rouge">Statement</code> za rad sa brišućim kursorima.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">createStatement</span><span class="o">(...,</span> <span class="nc">ResultSet</span><span class="o">.</span><span class="na">CONCUR_UPDATABLE</span><span class="o">,</span> <span class="o">...);</span>
</code></pre></div>      </div>
    </li>
    <li>Kreirati objekat interfejsa <code class="language-plaintext highlighter-rouge">ResultSet</code>.
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ResultSet</span> <span class="n">kursor</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>
</code></pre></div>      </div>
    </li>
    <li>Pozicionirati se na slog koji je potrebno obrisati metodima za prolazak kroz kursor. Na primer:
      <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="o">(</span><span class="n">kursor</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
 <span class="n">kursor</span><span class="o">.</span><span class="na">absolute</span><span class="o">(</span><span class="mi">5</span><span class="o">);</span> <span class="c1">// Samo ako kursor nije tipa TYPE_FORWARD_ONLY</span>
 <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div>      </div>
    </li>
    <li>Pozvati metod <code class="language-plaintext highlighter-rouge">kursor.deleteRow()</code> koji će obrisati slog u bazi podataka</li>
    <li>Nakon svih iteracija, pozvati metod <code class="language-plaintext highlighter-rouge">kursor.close()</code> radi zatvaranja kursora</li>
    <li>Nakon zatvaranja kursora, pozvati metod <code class="language-plaintext highlighter-rouge">stmt.close()</code> radi zatvaranja objekta naredbe</li>
  </ol>

</div>

<p>Metod <code class="language-plaintext highlighter-rouge">deleteRow()</code> briše onaj red na koji je <code class="language-plaintext highlighter-rouge">ResultSet</code> pozicioniran. Ne postoji način
da se operacija brisanja poništi (osim poništavanjem transakcije, o čemu će biti 
više reči u narednom poglavlju).</p>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.9</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički koji briše sve nepoložene ispite u školskoj godini koja se zadaje sa standarnog ulaza. Nakon svakog brisanja ispita, ispisati naredne informacije o njemu na standardni izlaz: indeks, oznaku roka, školsku godinu i identifikator predmeta.</p>
</div>

<p>Rešenje:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_8/src/zadatak_8_9/Main.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_8_9</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.sql.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.ibm.db2.jcc.DB2Driver"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argv</span><span class="o">[])</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:db2://localhost:50000/stud2020"</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">"student"</span><span class="o">,</span> <span class="s">"abcdef"</span><span class="o">))</span> <span class="o">{</span>
            
            <span class="n">izbrisiNepolozeneIspite</span><span class="o">(</span><span class="n">con</span><span class="o">);</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"SQLCODE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="s">"SQLSTATE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getSQLState</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span>
                    <span class="o">+</span> <span class="s">"PORUKA: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">izbrisiNepolozeneIspite</span><span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">godina</span> <span class="o">=</span> <span class="n">ucitajGodinu</span><span class="o">();</span>
        
        <span class="nc">String</span> <span class="n">selectSql</span> <span class="o">=</span> 
            <span class="s">"SELECT INDEKS, "</span> <span class="o">+</span> 
            <span class="s">"       OZNAKAROKA, "</span> <span class="o">+</span> 
            <span class="s">"       IDPREDMETA "</span> <span class="o">+</span>
            <span class="s">"FROM   DA.ISPIT "</span> <span class="o">+</span>
            <span class="s">"WHERE  SKGODINA = ? AND "</span> <span class="o">+</span>   
            <span class="s">"       OCENA = 5 AND "</span> <span class="o">+</span>  
            <span class="s">"       STATUS = 'o'"</span><span class="o">;</span>    
        <span class="nc">PreparedStatement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">selectSql</span><span class="o">,</span>
            <span class="nc">ResultSet</span><span class="o">.</span><span class="na">TYPE_FORWARD_ONLY</span><span class="o">,</span>
            <span class="c1">// Podesavamo kursor da bude za menjanje,</span>
            <span class="c1">// da bi smo mogli da brisemo redove metodom deleteRow() .</span>
            <span class="nc">ResultSet</span><span class="o">.</span><span class="na">CONCUR_UPDATABLE</span><span class="o">);</span>
        <span class="n">stmt</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">godina</span><span class="o">);</span>
        <span class="nc">ResultSet</span> <span class="n">ispiti</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>
        
        <span class="k">while</span><span class="o">(</span><span class="n">ispiti</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">indeks</span> <span class="o">=</span> <span class="n">ispiti</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">oznakaRoka</span> <span class="o">=</span> <span class="n">ispiti</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">2</span><span class="o">).</span><span class="na">trim</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">idPredmeta</span> <span class="o">=</span> <span class="n">ispiti</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
            
            <span class="n">ispiti</span><span class="o">.</span><span class="na">deleteRow</span><span class="o">();</span>
            
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"Obrisan je ispit %-10d %-10s %-5d %-10d\n"</span><span class="o">,</span> 
                <span class="n">indeks</span><span class="o">,</span> <span class="n">oznakaRoka</span><span class="o">,</span> <span class="n">godina</span><span class="o">,</span> <span class="n">idPredmeta</span><span class="o">);</span>
        <span class="o">}</span>
        
        <span class="n">ispiti</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">stmt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">ucitajGodinu</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">godina</span><span class="o">;</span>
        
        <span class="k">try</span> <span class="o">(</span><span class="nc">Scanner</span> <span class="n">ulaz</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">))</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Unesite godinu roka za koju zelite da budu obrisani nepolozeni ispiti:"</span><span class="o">);</span>
            <span class="n">godina</span> <span class="o">=</span> <span class="n">ulaz</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
        <span class="o">}</span>
        
        <span class="k">return</span> <span class="n">godina</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="839-ugnežđeni-kursori">8.3.9 Ugnežđeni kursori</h3>

<p>U JDBC aplikacijama se kursori jednostavno ugnežđuju: potrebno je celokupnu obradu
unutrašnjeg kursora smestiti u okviru obrade jednog reda iz spoljašnjeg kursora. Naredni
primer ilustruje upotrebu ugnežđenih kursora.</p>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.10</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički koji izdvaja indeks, ime, prezime i naziv studijskog programa svih studenata koji su položili tačno N predmeta, kao i spisak tih predmeta (naziv i ocena). Broj N se učitava sa standardnog ulaza. Za svakog studenta napraviti posebnu sekciju izveštaja.</p>
</div>

<p>Rešenje:</p>

<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_8/src/zadatak_8_10/ispiti.sql</code></strong>:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>      <span class="n">D</span><span class="p">.</span><span class="n">INDEKS</span><span class="p">,</span> 
            <span class="k">TRIM</span><span class="p">(</span><span class="n">IME</span><span class="p">),</span>
            <span class="k">TRIM</span><span class="p">(</span><span class="n">PREZIME</span><span class="p">),</span> 
            <span class="k">TRIM</span><span class="p">(</span><span class="n">NAZIV</span><span class="p">)</span>
<span class="k">FROM</span>        <span class="n">DA</span><span class="p">.</span><span class="n">DOSIJE</span> <span class="n">D</span> <span class="k">JOIN</span> 
            <span class="n">DA</span><span class="p">.</span><span class="n">STUDIJSKIPROGRAM</span> <span class="n">S</span> <span class="k">ON</span> <span class="n">D</span><span class="p">.</span><span class="n">IDPROGRAMA</span> <span class="o">=</span> <span class="n">S</span><span class="p">.</span><span class="n">ID</span> <span class="k">JOIN</span> 
            <span class="n">DA</span><span class="p">.</span><span class="n">ISPIT</span> <span class="n">I</span> <span class="k">ON</span> <span class="n">D</span><span class="p">.</span><span class="n">INDEKS</span> <span class="o">=</span> <span class="n">I</span><span class="p">.</span><span class="n">INDEKS</span>
<span class="k">WHERE</span>       <span class="n">OCENA</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="k">AND</span> 
            <span class="n">STATUS</span> <span class="o">=</span> <span class="s1">'o'</span>
<span class="k">GROUP</span> <span class="k">BY</span>    <span class="n">D</span><span class="p">.</span><span class="n">INDEKS</span><span class="p">,</span> 
            <span class="n">IME</span><span class="p">,</span> 
            <span class="n">PREZIME</span><span class="p">,</span> 
            <span class="n">NAZIV</span>
<span class="k">HAVING</span>      <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">=</span> <span class="o">?</span>
</code></pre></div></div>
<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_8/src/zadatak_8_10/predmeti.sql</code></strong>:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>      <span class="k">TRIM</span><span class="p">(</span><span class="n">NAZIV</span><span class="p">),</span> 
            <span class="n">OCENA</span> 
<span class="k">FROM</span>        <span class="n">DA</span><span class="p">.</span><span class="n">ISPIT</span> <span class="n">I</span> <span class="k">JOIN</span> 
            <span class="n">DA</span><span class="p">.</span><span class="n">PREDMET</span> <span class="n">P</span> <span class="k">ON</span> <span class="n">I</span><span class="p">.</span><span class="n">IDPREDMETA</span> <span class="o">=</span> <span class="n">P</span><span class="p">.</span><span class="n">ID</span> 
<span class="k">WHERE</span>       <span class="n">I</span><span class="p">.</span><span class="n">INDEKS</span> <span class="o">=</span> <span class="o">?</span> <span class="k">AND</span> 
            <span class="n">OCENA</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="k">AND</span> 
            <span class="n">STATUS</span> <span class="o">=</span> <span class="s1">'o'</span>
<span class="k">ORDER</span> <span class="k">BY</span>    <span class="n">NAZIV</span>
</code></pre></div></div>
<p><strong>Datoteka: <code class="language-plaintext highlighter-rouge">vezbe/primeri/poglavlje_8/src/zadatak_8_10/Main.java</code></strong>:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">zadatak_8_10</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileNotFoundException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"com.ibm.db2.jcc.DB2Driver"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">argv</span><span class="o">[])</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">"jdbc:db2://localhost:50000/stud2020"</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="s">"student"</span><span class="o">,</span> <span class="s">"abcdef"</span><span class="o">))</span> <span class="o">{</span>
            
            <span class="n">prodjiKrozSpoljasnjiKursor</span><span class="o">(</span><span class="n">con</span><span class="o">);</span>
            
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"SQLCODE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getErrorCode</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span> <span class="o">+</span> <span class="s">"SQLSTATE: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getSQLState</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span>
                    <span class="o">+</span> <span class="s">"PORUKA: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>

            <span class="nc">System</span><span class="o">.</span><span class="na">exit</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">prodjiKrozSpoljasnjiKursor</span><span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span><span class="o">,</span> <span class="nc">FileNotFoundException</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">ukupnoPredmeta</span> <span class="o">=</span> <span class="n">ucitajBrojPredmeta</span><span class="o">();</span>

        <span class="nc">PreparedStatement</span> <span class="n">pstmt</span><span class="o">;</span>

        <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="n">ucitajSqlIzDatoteke</span><span class="o">(</span><span class="s">"ispiti.sql"</span><span class="o">);</span>
        <span class="n">pstmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>

        <span class="n">pstmt</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">ukupnoPredmeta</span><span class="o">);</span>
        <span class="nc">ResultSet</span> <span class="n">ispiti</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>

        <span class="k">while</span> <span class="o">(</span><span class="n">ispiti</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"\n\nIndeks: %-10d\nIme: %-10s\nPrezime: %-20s\nNaziv smera: %-30s\n\n"</span><span class="o">,</span> <span class="n">ispiti</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span>
                    <span class="n">ispiti</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="n">ispiti</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">3</span><span class="o">),</span> <span class="n">ispiti</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">4</span><span class="o">));</span>

            <span class="kt">int</span> <span class="n">indeks</span> <span class="o">=</span> <span class="n">ispiti</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
            <span class="n">prodjiKrozUnutrasnjiKursor</span><span class="o">(</span><span class="n">con</span><span class="o">,</span> <span class="n">indeks</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">ispiti</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">pstmt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">prodjiKrozUnutrasnjiKursor</span><span class="o">(</span><span class="nc">Connection</span> <span class="n">con</span><span class="o">,</span> <span class="kt">int</span> <span class="n">indeks</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span><span class="o">,</span> <span class="nc">FileNotFoundException</span> <span class="o">{</span>
        <span class="nc">PreparedStatement</span> <span class="n">pstmt</span><span class="o">;</span>

        <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="n">ucitajSqlIzDatoteke</span><span class="o">(</span><span class="s">"predmeti.sql"</span><span class="o">);</span>
        <span class="n">pstmt</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="n">sql</span><span class="o">);</span>

        <span class="n">pstmt</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">indeks</span><span class="o">);</span>
        <span class="nc">ResultSet</span> <span class="n">predmeti</span> <span class="o">=</span> <span class="n">pstmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">();</span>

        <span class="kt">int</span> <span class="n">redniBr</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

        <span class="k">while</span> <span class="o">(</span><span class="n">predmeti</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"\t%d. predmet: %s\n\t\tOcena: %d\n"</span><span class="o">,</span> <span class="n">redniBr</span><span class="o">,</span> <span class="n">predmeti</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span>
                    <span class="n">predmeti</span><span class="o">.</span><span class="na">getShort</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span>

            <span class="o">++</span><span class="n">redniBr</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">predmeti</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">pstmt</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">ucitajBrojPredmeta</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">godina</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">(</span><span class="nc">Scanner</span> <span class="n">ulaz</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">in</span><span class="o">))</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Unesite broj predmeta N:"</span><span class="o">);</span>
            <span class="n">godina</span> <span class="o">=</span> <span class="n">ulaz</span><span class="o">.</span><span class="na">nextInt</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">godina</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">ucitajSqlIzDatoteke</span><span class="o">(</span><span class="nc">String</span> <span class="n">nazivDatoteke</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">FileNotFoundException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">putanja</span> <span class="o">=</span> <span class="s">"./bin/zadatak_8_10/"</span> <span class="o">+</span> <span class="n">nazivDatoteke</span><span class="o">;</span>
        <span class="nc">StringBuilder</span> <span class="n">sql</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">linija</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        
        <span class="k">try</span> <span class="o">(</span><span class="nc">Scanner</span> <span class="n">skenerFajla</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">putanja</span><span class="o">),</span> <span class="s">"utf-8"</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">skenerFajla</span><span class="o">.</span><span class="na">hasNextLine</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">linija</span> <span class="o">=</span> <span class="n">skenerFajla</span><span class="o">.</span><span class="na">nextLine</span><span class="o">();</span>
                <span class="n">sql</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">linija</span><span class="o">);</span>
                <span class="n">sql</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="84-zadaci-za-vežbu">8.4 Zadaci za vežbu</h2>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.11</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički koji ispisuje podatke za predmet čiji je identifikator <code class="language-plaintext highlighter-rouge">2027</code>.</p>
</div>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.12</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički koji ispisuje broj studenata koji su upisali studije u školskoj godini koja se unosi sa standardnog ulaza.</p>
</div>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.13</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički koji za svaku ocenu od 6 do 10 ispisuje ime i prezime studenta koji je poslednji položio neki ispit sa tom ocenom. U slučaju da ima više takvih studenata, klauzom <code class="language-plaintext highlighter-rouge">LIMIT 1</code> naredbe <code class="language-plaintext highlighter-rouge">SELECT INTO</code> se osigurati da bude vraćen najviše 1 red. (Pomoć: Koristiti <code class="language-plaintext highlighter-rouge">for</code> petlju za menjanje vrednosti matične promenljive koja sadrži ocenu, pa u svakoj iteraciji dohvatiti informaciju za tekuću vrednost te matične promenljive.)</p>
</div>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.14</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički kojim se dodaje da je za polaganje predmeta čiji je identifikator <code class="language-plaintext highlighter-rouge">2327</code> uslov da se položi predmet čiji je identifikator <code class="language-plaintext highlighter-rouge">1588</code>.</p>
</div>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.15</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički kojim se u tabelu <code class="language-plaintext highlighter-rouge">NIVOKVALIFIKACIJE</code> dodaje novi nivo čiji se identifikator i naziv.</p>
</div>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.16</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički kojim se, za sve položene ispite čiji se naziv predmeta unosi sa standardnog ulaza, ocena uvećava za 1.</p>
</div>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.17</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički kojim se u tabeli <code class="language-plaintext highlighter-rouge">USLOVNIPREDMET</code> brišu sve uslovnosti za predmet čiji se identifikator unosi sa standardnog ulaza.</p>
</div>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.18</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički kojim se brišu svi podaci o ispitima za studenta čiji se indeks unosi sa standardnog ulaza.</p>
</div>

<div class="ui stacked segment">
  <p><strong>Zadatak 8.19</strong>: Napisati Java program u kojem se naredbe izvršavaju dinamički koji iz tabele <code class="language-plaintext highlighter-rouge">PREDMET</code> briše podatak o predmetu čija se oznaka unosi sa standardnog ulaza.</p>
</div>

        </div>
    </div>

    <script>
        $('#pageSticky').sticky({
            context: '#pageContent'
        });

        $('#pageSticky').click(function () {
            $('#sideMenu').sidebar('toggle');
        });
    </script>
</body>

</html>